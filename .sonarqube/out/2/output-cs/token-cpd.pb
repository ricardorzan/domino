แ
DC:\Users\ricar\Documents\GitHub\domino\DominoServer\DominoService.cs
	namespace 	
DominoServer
 
{ 
[ 
ServiceBehavior 
( 
ConcurrencyMode $
=% &
ConcurrencyMode' 6
.6 7
Single7 =
,= >
InstanceContextMode? R
=S T
InstanceContextModeU h
.h i
Singlei o
)o p
]p q
public 

partial 
class 
DominoService &
:' (
ILoginService) 6
,6 7
IMenuService8 D
,D E
IChatServiceF R
,R S
ILobbyServiceT a
,a b
IGameServicec o
{ 
readonly 

Dictionary 
< 
int 
,  

Dictionary! +
<+ ,
IGameClient, 7
,7 8
string9 ?
>? @
>@ A
_currentGamesB O
=P Q
newR U

DictionaryV `
<` a
inta d
,d e

Dictionaryf p
<p q
IGameClientq |
,| }
string	~ 
>
 
>
 
(
 
)
 
;
 
readonly 

Dictionary 
< 
int 
,  
string! '
[' (
]( )
>) *
	_dominoes+ 4
=5 6
new7 :

Dictionary; E
<E F
intF I
,I J
stringK Q
[Q R
]R S
>S T
(T U
)U V
;V W
public 
void 
JoinCurrentGame #
(# $
int$ '
idGame( .
,. /
string0 6
username7 ?
)? @
{ 	
var 

connection 
= 
OperationContext -
.- .
Current. 5
.5 6
GetCallbackChannel6 H
<H I
IGameClientI T
>T U
(U V
)V W
;W X
if 
( 
! 
_currentGames 
. 
TryGetValue *
(* +
idGame+ 1
,1 2
out3 6

Dictionary7 A
<A B
IGameClientB M
,M N
stringO U
>U V
_membersW _
)_ `
)` a
return 
; 
int 

nextMember 
= 
$num 
; 
string 
[ 
] 
members 
= 
new "
string# )
[) *
_members* 2
.2 3
Count3 8
]8 9
;9 :
foreach 
( 
var 
other 
in !
_members" *
)* +
{ 
if 
( 
other 
. 
Key 
==  

connection! +
)+ ,
{ 

nextMember   
++    
;    !
continue!! 
;!! 
}"" 
members## 
[## 

nextMember## "
]##" #
=##$ %
other##& +
.##+ ,
Value##, 1
;##1 2

nextMember$$ 
++$$ 
;$$ 
other%% 
.%% 
Key%% 
.%% 
ReciveNewMember%% )
(%%) *
username%%* 2
)%%2 3
;%%3 4
}&& 
('' 
('' 

Dictionary'' 
<'' 
IGameClient'' $
,''$ %
string''& ,
>'', -
)''- .
_currentGames''. ;
[''; <
idGame''< B
]''B C
)''C D
.''D E
Add''E H
(''H I

connection''I S
,''S T
username''U ]
)''] ^
;''^ _
try(( 
{)) 

connection** 
.** 
ReciveMembersInGame** .
(**. /
members**/ 6
)**6 7
;**7 8
}++ 
catch,, 
(,, 
	Exception,, 
ex,, 
),,  
{-- 
throw.. 
new.. 
FaultException.. (
(..( )
ex..) +
...+ ,
Message.., 3
)..3 4
;..4 5
}// 
}00 	
public22 
void22 
GetFirstSevenTiles22 &
(22& '
int22' *
idGame22+ 1
)221 2
{33 	
var44 

connection44 
=44 
OperationContext44 -
.44- .
Current44. 5
.445 6
GetCallbackChannel446 H
<44H I
IGameClient44I T
>44T U
(44U V
)44V W
;44W X
string66 
[66 
]66 
dominoesPerPlayer66 &
=66' (
new66) ,
string66- 3
[663 4
$num664 6
]666 7
;667 8
if77 
(77 
!77 
	_dominoes77 
.77 
TryGetValue77 &
(77& '
idGame77' -
,77- .
out77/ 2
string773 9
[779 :
]77: ;
dominoesInGame77< J
)77J K
)77K L
return88 
;88 
Array:: 
.:: 
Copy:: 
(:: 
dominoesInGame:: %
,::% &
$num::' (
,::( )
dominoesPerPlayer::* ;
,::; <
$num::= >
,::> ?
$num::@ A
)::A B
;::B C
var<< 
myList<< 
=<< 
dominoesInGame<< '
.<<' (
ToList<<( .
(<<. /
)<</ 0
;<<0 1
myList== 
.== 
RemoveRange== 
(== 
$num==  
,==  !
$num==" #
)==# $
;==$ %
dominoesInGame>> 
=>> 
myList>> #
.>># $
ToArray>>$ +
(>>+ ,
)>>, -
;>>- .
Shuffle@@ 
(@@ 
dominoesInGame@@ "
)@@" #
;@@# $
	_dominoesBB 
.BB 
RemoveBB 
(BB 
idGameBB #
)BB# $
;BB$ %
	_dominoesCC 
.CC 
AddCC 
(CC 
idGameCC  
,CC  !
dominoesInGameCC" 0
)CC0 1
;CC1 2
tryEE 
{FF 

connectionGG 
.GG 
GetDominoesGG &
(GG& '
dominoesPerPlayerGG' 8
)GG8 9
;GG9 :
}HH 
catchII 
(II 
	ExceptionII 
exII 
)II  
{JJ 
throwKK 
newKK 
FaultExceptionKK (
(KK( )
exKK) +
.KK+ ,
MessageKK, 3
)KK3 4
;KK4 5
}LL 
}MM 	
publicOO 
voidOO 
GetPlayersNameOO "
(OO" #
intOO# &
idGameOO' -
)OO- .
{PP 	
varQQ 

connectionQQ 
=QQ 
OperationContextQQ -
.QQ- .
CurrentQQ. 5
.QQ5 6
GetCallbackChannelQQ6 H
<QQH I
IGameClientQQI T
>QQT U
(QQU V
)QQV W
;QQW X
ifSS 
(SS 
!SS 
_currentGamesSS 
.SS 
TryGetValueSS *
(SS* +
idGameSS+ 1
,SS1 2
outSS3 6

DictionarySS7 A
<SSA B
IGameClientSSB M
,SSM N
stringSSO U
>SSU V
_membersSSW _
)SS_ `
)SS` a
returnTT 
;TT 
intVV 

nextMemberVV 
=VV 
$numVV 
;VV 
stringWW 
[WW 
]WW 
membersWW 
=WW 
newWW "
stringWW# )
[WW) *
_membersWW* 2
.WW2 3
CountWW3 8
-WW9 :
$numWW; <
]WW< =
;WW= >
foreachXX 
(XX 
varXX 
otherXX 
inXX !
_membersXX" *
)XX* +
{YY 
ifZZ 
(ZZ 
otherZZ 
.ZZ 
KeyZZ 
==ZZ  

connectionZZ! +
)ZZ+ ,
continue[[ 
;[[ 
members\\ 
[\\ 

nextMember\\ "
]\\" #
=\\$ %
other\\& +
.\\+ ,
Value\\, 1
;\\1 2

nextMember]] 
++]] 
;]] 
}^^ 
try__ 
{`` 

connectionaa 
.aa 
ReciveMembersInGameaa .
(aa. /
membersaa/ 6
)aa6 7
;aa7 8
}bb 
catchcc 
(cc 
	Exceptioncc 
excc 
)cc  
{dd 
throwee 
newee 
FaultExceptionee (
(ee( )
exee) +
.ee+ ,
Messageee, 3
)ee3 4
;ee4 5
}ff 
}gg 	
publicii 
voidii 
GetHighestTileii "
(ii" #
intii# &
idGameii' -
,ii- .
stringii/ 5
hostHighestTileii6 E
)iiE F
{jj 	
varkk 

connectionkk 
=kk 
OperationContextkk -
.kk- .
Currentkk. 5
.kk5 6
GetCallbackChannelkk6 H
<kkH I
IGameClientkkI T
>kkT U
(kkU V
)kkV W
;kkW X
ifll 
(ll 
!ll 
_currentGamesll 
.ll 
TryGetValuell *
(ll* +
idGamell+ 1
,ll1 2
outll3 6

Dictionaryll7 A
<llA B
IGameClientllB M
,llM N
stringllO U
>llU V
_membersllW _
)ll_ `
)ll` a
returnmm 
;mm 
stringnn 
highestTilenn 
=nn  
nullnn! %
;nn% &
stringoo 
[oo 
]oo 
highestOfEachPlayeroo (
=oo) *
newoo+ .
stringoo/ 5
[oo5 6
$numoo6 7
]oo7 8
;oo8 9
intpp 
countpp 
=pp 
$numpp 
;pp 
intqq 
whoIsGonnaStartqq 
=qq  !
$numqq" #
;qq# $
foreachrr 
(rr 
varrr 
otherrr 
inrr !
_membersrr" *
.rr* +
Keysrr+ /
)rr/ 0
{ss 
iftt 
(tt 
othertt 
==tt 

connectiontt '
)tt' (
{uu 
highestOfEachPlayervv '
[vv' (
countvv( -
]vv- .
=vv/ 0
hostHighestTilevv1 @
;vv@ A
countww 
++ww 
;ww 
continuexx 
;xx 
}yy 
highestOfEachPlayerzz #
[zz# $
countzz$ )
]zz) *
=zz+ ,
otherzz- 2
.zz2 3
SendHighestTilezz3 B
(zzB C
)zzC D
;zzD E
count{{ 
++{{ 
;{{ 
}|| 
for}} 
(}} 
int}} 
i}} 
=}} 
$num}} 
;}} 
i}} 
<}} 
_members}}  (
.}}( )
Count}}) .
;}}. /
i}}0 1
++}}1 3
)}}3 4
{~~ 
if 
( 
highestTile 
==  "
null# '
)' (
{
 
highestTile
 
=
  !!
highestOfEachPlayer
" 5
[
5 6
i
6 7
]
7 8
;
8 9
whoIsGonnaStart
 #
=
$ %
i
& '
;
' (
}
 
else
 
{
 
int
 
highestNumberOne
 (
=
) *
int
+ .
.
. /
Parse
/ 4
(
4 5
highestTile
5 @
.
@ A
	Substring
A J
(
J K
$num
K L
,
L M
$num
N O
)
O P
)
P Q
;
Q R
int
 
highestNumberTwo
 (
=
) *
int
+ .
.
. /
Parse
/ 4
(
4 5
highestTile
5 @
.
@ A
	Substring
A J
(
J K
$num
K L
,
L M
$num
N O
)
O P
)
P Q
;
Q R
bool
 
highestIsMule
 &
=
' (
highestNumberOne
) 9
==
: <
highestNumberTwo
= M
;
M N
int
 
	numberOne
 !
=
" #
int
$ '
.
' (
Parse
( -
(
- .!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
.
D E
	Substring
E N
(
N O
$num
O P
,
P Q
$num
R S
)
S T
)
T U
;
U V
int
 
	numberTwo
 !
=
" #
int
$ '
.
' (
Parse
( -
(
- .!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
.
D E
	Substring
E N
(
N O
$num
O P
,
P Q
$num
R S
)
S T
)
T U
;
U V
bool
 
isMule
 
=
  !
	numberOne
" +
==
, .
	numberTwo
/ 8
;
8 9
if
 
(
 
highestIsMule
 %
)
% &
{
 
if
 
(
 
isMule
 "
)
" #
{
 
if
 
(
  
	numberOne
  )
>
* +
highestNumberOne
, <
)
< =
{
 
highestTile
  +
=
, -!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
;
D E
whoIsGonnaStart
  /
=
0 1
i
2 3
;
3 4
}
 
}
 
}
 
else
 
{
 
if
 
(
 
isMule
 "
)
" #
{
 
highestTile
 '
=
( )!
highestOfEachPlayer
* =
[
= >
i
> ?
]
? @
;
@ A
whoIsGonnaStart
 +
=
, -
i
. /
;
/ 0
}
 
else
 
{
กก 
int
ขข 
weight
ขข  &
=
ขข' (
	numberOne
ขข) 2
+
ขข3 4
	numberTwo
ขข5 >
;
ขข> ?
int
ฃฃ 
highestWeight
ฃฃ  -
=
ฃฃ. /
highestNumberOne
ฃฃ0 @
+
ฃฃA B
highestNumberTwo
ฃฃC S
;
ฃฃS T
if
คค 
(
คค  
weight
คค  &
>
คค' (
highestWeight
คค) 6
)
คค6 7
{
ฅฅ 
highestTile
ฆฆ  +
=
ฆฆ, -!
highestOfEachPlayer
ฆฆ. A
[
ฆฆA B
i
ฆฆB C
]
ฆฆC D
;
ฆฆD E
whoIsGonnaStart
งง  /
=
งง0 1
i
งง2 3
;
งง3 4
}
จจ 
}
ฉฉ 
}
ชช 
}
ซซ 
}
ฌฌ 
count
ญญ 
=
ญญ 
$num
ญญ 
;
ญญ 
foreach
ฎฎ 
(
ฎฎ 
var
ฎฎ 
other
ฎฎ 
in
ฎฎ !
_members
ฎฎ" *
.
ฎฎ* +
Keys
ฎฎ+ /
)
ฎฎ/ 0
{
ฏฏ 
if
ฐฐ 
(
ฐฐ 
count
ฐฐ 
==
ฐฐ 
whoIsGonnaStart
ฐฐ ,
)
ฐฐ, -
{
ฑฑ 
other
ฒฒ 
.
ฒฒ 

IsYourTurn
ฒฒ $
(
ฒฒ$ %
isFirstTurn
ฒฒ% 0
:
ฒฒ0 1
true
ฒฒ2 6
)
ฒฒ6 7
;
ฒฒ7 8
break
ณณ 
;
ณณ 
}
ดด 
count
ตต 
++
ตต 
;
ตต 
}
ถถ 
}
ทท 	
public
นน 
void
นน 
PutATile
นน 
(
นน 
int
นน  
idGame
นน! '
,
นน' (
string
นน) /
tile
นน0 4
)
นน4 5
{
บบ 	
var
ปป 

connection
ปป 
=
ปป 
OperationContext
ปป -
.
ปป- .
Current
ปป. 5
.
ปป5 6 
GetCallbackChannel
ปป6 H
<
ปปH I
IGameClient
ปปI T
>
ปปT U
(
ปปU V
)
ปปV W
;
ปปW X
if
ผผ 
(
ผผ 
!
ผผ 
_currentGames
ผผ 
.
ผผ 
TryGetValue
ผผ *
(
ผผ* +
idGame
ผผ+ 1
,
ผผ1 2
out
ผผ3 6

Dictionary
ผผ7 A
<
ผผA B
IGameClient
ผผB M
,
ผผM N
string
ผผO U
>
ผผU V
_members
ผผW _
)
ผผ_ `
)
ผผ` a
return
ฝฝ 
;
ฝฝ 
if
พพ 
(
พพ 
!
พพ 
_members
พพ 
.
พพ 
TryGetValue
พพ %
(
พพ% &

connection
พพ& 0
,
พพ0 1
out
พพ2 5
string
พพ6 <
whoPutTheTile
พพ= J
)
พพJ K
)
พพK L
return
ฟฟ 
;
ฟฟ 
foreach
ภภ 
(
ภภ 
var
ภภ 
other
ภภ 
in
ภภ !
_members
ภภ" *
.
ภภ* +
Keys
ภภ+ /
)
ภภ/ 0
{
มม 
if
รร 
(
รร 
other
รร 
==
รร 

connection
รร '
)
รร' (
continue
ฤฤ 
;
ฤฤ 
other
ลล 
.
ลล 
SomeonePutATile
ลล %
(
ลล% &
whoPutTheTile
ลล& 3
,
ลล3 4
tile
ลล5 9
)
ลล9 :
;
ลล: ;
}
ฦฦ 
}
วว 	
public
ษษ 
void
ษษ 
PassTurn
ษษ 
(
ษษ 
int
ษษ  
idGame
ษษ! '
)
ษษ' (
{
สส 	
var
หห 

connection
หห 
=
หห 
OperationContext
หห -
.
หห- .
Current
หห. 5
.
หห5 6 
GetCallbackChannel
หห6 H
<
หหH I
IGameClient
หหI T
>
หหT U
(
หหU V
)
หหV W
;
หหW X
if
ฬฬ 
(
ฬฬ 
!
ฬฬ 
_currentGames
ฬฬ 
.
ฬฬ 
TryGetValue
ฬฬ *
(
ฬฬ* +
idGame
ฬฬ+ 1
,
ฬฬ1 2
out
ฬฬ3 6

Dictionary
ฬฬ7 A
<
ฬฬA B
IGameClient
ฬฬB M
,
ฬฬM N
string
ฬฬO U
>
ฬฬU V
_members
ฬฬW _
)
ฬฬ_ `
)
ฬฬ` a
return
ออ 
;
ออ 
bool
ฮฮ 
nextTurn
ฮฮ 
=
ฮฮ 
false
ฮฮ !
;
ฮฮ! "
foreach
ฯฯ 
(
ฯฯ 
var
ฯฯ 
other
ฯฯ 
in
ฯฯ !
_members
ฯฯ" *
.
ฯฯ* +
Keys
ฯฯ+ /
)
ฯฯ/ 0
{
ะะ 
if
ัั 
(
ัั 
other
ัั 
==
ัั 

connection
ัั '
)
ัั' (
{
าา 
nextTurn
ำำ 
=
ำำ 
true
ำำ #
;
ำำ# $
continue
ิิ 
;
ิิ 
}
ีี 
if
ึึ 
(
ึึ 
nextTurn
ึึ 
)
ึึ 
{
ืื 
other
ุุ 
.
ุุ 

IsYourTurn
ุุ $
(
ุุ$ %
isFirstTurn
ุุ% 0
:
ุุ0 1
false
ุุ2 7
)
ุุ7 8
;
ุุ8 9
nextTurn
ูู 
=
ูู 
false
ูู $
;
ูู$ %
}
ฺฺ 
}
 
if
 
(
 
nextTurn
 
)
 
_members
 
.
 
First
 
(
 
)
  
.
  !
Key
! $
.
$ %

IsYourTurn
% /
(
/ 0
isFirstTurn
0 ;
:
; <
false
= B
)
B C
;
C D
}
 	
public
เเ 
void
เเ 
TakeFromTheBank
เเ #
(
เเ# $
int
เเ$ '
idGame
เเ( .
)
เเ. /
{
แแ 	
var
โโ 

connection
โโ 
=
โโ 
OperationContext
โโ -
.
โโ- .
Current
โโ. 5
.
โโ5 6 
GetCallbackChannel
โโ6 H
<
โโH I
IGameClient
โโI T
>
โโT U
(
โโU V
)
โโV W
;
โโW X
if
ใใ 
(
ใใ 
!
ใใ 
	_dominoes
ใใ 
.
ใใ 
TryGetValue
ใใ &
(
ใใ& '
idGame
ใใ' -
,
ใใ- .
out
ใใ/ 2
string
ใใ3 9
[
ใใ9 :
]
ใใ: ;
dominoesInGame
ใใ< J
)
ใใJ K
)
ใใK L
return
ไไ 
;
ไไ 
string
ๆๆ 
newTile
ๆๆ 
=
ๆๆ 
dominoesInGame
ๆๆ +
[
ๆๆ+ ,
$num
ๆๆ, -
]
ๆๆ- .
;
ๆๆ. /
var
่่ 
myList
่่ 
=
่่ 
dominoesInGame
่่ '
.
่่' (
ToList
่่( .
(
่่. /
)
่่/ 0
;
่่0 1
myList
้้ 
.
้้ 
RemoveRange
้้ 
(
้้ 
$num
้้  
,
้้  !
$num
้้" #
)
้้# $
;
้้$ %
dominoesInGame
๊๊ 
=
๊๊ 
myList
๊๊ #
.
๊๊# $
ToArray
๊๊$ +
(
๊๊+ ,
)
๊๊, -
;
๊๊- .
Shuffle
์์ 
(
์์ 
dominoesInGame
์์ "
)
์์" #
;
์์# $
	_dominoes
๎๎ 
.
๎๎ 
Remove
๎๎ 
(
๎๎ 
idGame
๎๎ #
)
๎๎# $
;
๎๎$ %
	_dominoes
๏๏ 
.
๏๏ 
Add
๏๏ 
(
๏๏ 
idGame
๏๏  
,
๏๏  !
dominoesInGame
๏๏" 0
)
๏๏0 1
;
๏๏1 2
if
๑๑ 
(
๑๑ 
!
๑๑ 
_currentGames
๑๑ 
.
๑๑ 
TryGetValue
๑๑ *
(
๑๑* +
idGame
๑๑+ 1
,
๑๑1 2
out
๑๑3 6

Dictionary
๑๑7 A
<
๑๑A B
IGameClient
๑๑B M
,
๑๑M N
string
๑๑O U
>
๑๑U V
_members
๑๑W _
)
๑๑_ `
)
๑๑` a
return
๒๒ 
;
๒๒ 
if
๓๓ 
(
๓๓ 
!
๓๓ 
_members
๓๓ 
.
๓๓ 
TryGetValue
๓๓ %
(
๓๓% &

connection
๓๓& 0
,
๓๓0 1
out
๓๓2 5
string
๓๓6 <
whoTookTheTile
๓๓= K
)
๓๓K L
)
๓๓L M
return
๔๔ 
;
๔๔ 
foreach
๕๕ 
(
๕๕ 
var
๕๕ 
other
๕๕ 
in
๕๕ !
_members
๕๕" *
)
๕๕* +
{
๖๖ 
if
๗๗ 
(
๗๗ 
other
๗๗ 
.
๗๗ 
Key
๗๗ 
==
๗๗  

connection
๗๗! +
)
๗๗+ ,
continue
๘๘ 
;
๘๘ 
other
๙๙ 
.
๙๙ 
Key
๙๙ 
.
๙๙ 
SomeoneTookATile
๙๙ *
(
๙๙* +
whoTookTheTile
๙๙+ 9
)
๙๙9 :
;
๙๙: ;
}
๚๚ 
try
 
{
 

connection
 
.
 

GetTheTile
 %
(
% &
newTile
& -
)
- .
;
. /
}
 
catch
 
(
 &
IndexOutOfRangeException
 +
ex
, .
)
. /
{
 
throw
 
new
 
FaultException
 (
(
( )
ex
) +
.
+ ,
Message
, 3
)
3 4
;
4 5
}
 
}
 	
public
 
void
 
Win
 
(
 
int
 
idGame
 "
)
" #
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
IGameClient
I T
>
T U
(
U V
)
V W
;
W X
if
 
(
 
!
 
_currentGames
 
.
 
TryGetValue
 *
(
* +
idGame
+ 1
,
1 2
out
3 6

Dictionary
7 A
<
A B
IGameClient
B M
,
M N
string
O U
>
U V
_members
W _
)
_ `
)
` a
return
 
;
 
if
 
(
 
!
 
_members
 
.
 
TryGetValue
 %
(
% &

connection
& 0
,
0 1
out
2 5
string
6 <
	theWinner
= F
)
F G
)
G H
return
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
)
* +
{
 
if
 
(
 
other
 
.
 
Key
 
==
  

connection
! +
)
+ ,
continue
 
;
 
other
 
.
 
Key
 
.
  
SomeoneWonTheRound
 ,
(
, -
	theWinner
- 6
)
6 7
;
7 8
}
 
try
 
{
 
using
 
(
 
DominoContext
 $
context
% ,
=
- .
new
/ 2
DominoContext
3 @
(
@ A
)
A B
)
B C
{
 
var
 
round
 
=
 
context
  '
.
' (
Ronda
( -
.
- .
FirstOrDefault
. <
(
< =
r
= >
=>
? A
r
B C
.
C D
RondaID
D K
==
L N
idGame
O U
)
U V
;
V W
round
 
.
 
Ganador
 !
=
" #
	theWinner
$ -
;
- .
var
 
game
 
=
 
round
 $
.
$ %
Juego
% *
;
* +
game
 
.
 
Ganador
  
=
! "
	theWinner
# ,
;
, -
context
 
.
 
SaveChanges
 '
(
' (
)
( )
;
) *
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
กก 
new
กก 
	Exception
กก #
(
กก# $
ex
กก$ &
.
กก& '
Message
กก' .
)
กก. /
;
กก/ 0
}
ขข 
}
ฃฃ 	
public
ฅฅ 
void
ฅฅ 
UploadPoints
ฅฅ  
(
ฅฅ  !
int
ฅฅ! $
idGame
ฅฅ% +
,
ฅฅ+ ,
int
ฅฅ- 0
points
ฅฅ1 7
)
ฅฅ7 8
{
ฆฆ 	
var
งง 

connection
งง 
=
งง 
OperationContext
งง -
.
งง- .
Current
งง. 5
.
งง5 6 
GetCallbackChannel
งง6 H
<
งงH I
IGameClient
งงI T
>
งงT U
(
งงU V
)
งงV W
;
งงW X
if
จจ 
(
จจ 
!
จจ 
_currentGames
จจ 
.
จจ 
TryGetValue
จจ *
(
จจ* +
idGame
จจ+ 1
,
จจ1 2
out
จจ3 6

Dictionary
จจ7 A
<
จจA B
IGameClient
จจB M
,
จจM N
string
จจO U
>
จจU V
_members
จจW _
)
จจ_ `
)
จจ` a
return
ฉฉ 
;
ฉฉ 
if
ชช 
(
ชช 
!
ชช 
_members
ชช 
.
ชช 
TryGetValue
ชช %
(
ชช% &

connection
ชช& 0
,
ชช0 1
out
ชช2 5
string
ชช6 <
username
ชช= E
)
ชชE F
)
ชชF G
return
ซซ 
;
ซซ 
try
ฌฌ 
{
ญญ 
using
ฎฎ 
(
ฎฎ 
DominoContext
ฎฎ $
context
ฎฎ% ,
=
ฎฎ- .
new
ฎฎ/ 2
DominoContext
ฎฎ3 @
(
ฎฎ@ A
)
ฎฎA B
)
ฎฎB C
{
ฏฏ 
var
ฐฐ 
player
ฐฐ 
=
ฐฐ  
context
ฐฐ! (
.
ฐฐ( )
Jugador
ฐฐ) 0
.
ฐฐ0 1
FirstOrDefault
ฐฐ1 ?
(
ฐฐ? @
p
ฐฐ@ A
=>
ฐฐB D
p
ฐฐE F
.
ฐฐF G
RondaID
ฐฐG N
==
ฐฐO Q
idGame
ฐฐR X
&&
ฐฐY [
p
ฐฐ\ ]
.
ฐฐ] ^
Usuario
ฐฐ^ e
.
ฐฐe f
Nombreusuario
ฐฐf s
==
ฐฐt v
username
ฐฐw 
)ฐฐ 
;ฐฐ 
player
ฑฑ 
.
ฑฑ 
Puntaje
ฑฑ "
=
ฑฑ# $
points
ฑฑ% +
;
ฑฑ+ ,
var
ฒฒ 
user
ฒฒ 
=
ฒฒ 
player
ฒฒ %
.
ฒฒ% &
Usuario
ฒฒ& -
;
ฒฒ- .
user
ณณ 
.
ณณ 
Puntajeacumulado
ณณ )
=
ณณ* +
user
ณณ, 0
.
ณณ0 1
Puntajeacumulado
ณณ1 A
+
ณณB C
points
ณณD J
;
ณณJ K
context
ดด 
.
ดด 
SaveChanges
ดด '
(
ดด' (
)
ดด( )
;
ดด) *
}
ตต 
_members
ถถ 
.
ถถ 
Remove
ถถ 
(
ถถ  

connection
ถถ  *
)
ถถ* +
;
ถถ+ ,
if
ทท 
(
ทท 
_members
ทท 
.
ทท 
Count
ทท "
==
ทท# %
$num
ทท& '
)
ทท' (
{
ธธ 
_rooms
นน 
.
นน 
Remove
นน !
(
นน! "
idGame
นน" (
)
นน( )
;
นน) *
_currentGames
บบ !
.
บบ! "
Remove
บบ" (
(
บบ( )
idGame
บบ) /
)
บบ/ 0
;
บบ0 1
	_dominoes
ปป 
.
ปป 
Remove
ปป $
(
ปป$ %
idGame
ปป% +
)
ปป+ ,
;
ปป, -
}
ผผ 
}
ฝฝ 
catch
พพ 
(
พพ 
	Exception
พพ 
ex
พพ 
)
พพ  
{
ฟฟ 
throw
ภภ 
new
ภภ 
	Exception
ภภ #
(
ภภ# $
ex
ภภ$ &
.
ภภ& '
Message
ภภ' .
)
ภภ. /
;
ภภ/ 0
}
มม 
}
ยย 	
readonly
ฤฤ 

Dictionary
ฤฤ 
<
ฤฤ 
ILobbyClient
ฤฤ (
,
ฤฤ( )
string
ฤฤ* 0
>
ฤฤ0 1
_lobbies
ฤฤ2 :
=
ฤฤ; <
new
ฤฤ= @

Dictionary
ฤฤA K
<
ฤฤK L
ILobbyClient
ฤฤL X
,
ฤฤX Y
string
ฤฤZ `
>
ฤฤ` a
(
ฤฤa b
)
ฤฤb c
;
ฤฤc d
public
ลล 
void
ลล 
	JoinLobby
ลล 
(
ลล 
string
ลล $
username
ลล% -
)
ลล- .
{
ฦฦ 	
var
วว 

connection
วว 
=
วว 
OperationContext
วว -
.
วว- .
Current
วว. 5
.
วว5 6 
GetCallbackChannel
วว6 H
<
ววH I
ILobbyClient
ววI U
>
ววU V
(
ววV W
)
ววW X
;
ววX Y
_lobbies
ศศ 
[
ศศ 

connection
ศศ 
]
ศศ  
=
ศศ! "
username
ศศ# +
;
ศศ+ ,
}
ษษ 	
public
หห 
void
หห 
GetGames
หห 
(
หห 
)
หห 
{
ฬฬ 	
var
ออ 

connection
ออ 
=
ออ 
OperationContext
ออ -
.
ออ- .
Current
ออ. 5
.
ออ5 6 
GetCallbackChannel
ออ6 H
<
ออH I
ILobbyClient
ออI U
>
ออU V
(
ออV W
)
ออW X
;
ออX Y
foreach
ฮฮ 
(
ฮฮ 
var
ฮฮ 
other
ฮฮ 
in
ฮฮ !
_games
ฮฮ" (
.
ฮฮ( )
Keys
ฮฮ) -
)
ฮฮ- .
{
ฯฯ 

connection
ะะ 
.
ะะ 

ReciveGame
ะะ %
(
ะะ% &
other
ะะ& +
)
ะะ+ ,
;
ะะ, -
}
ัั 
}
าา 	
readonly
ิิ 

Dictionary
ิิ 
<
ิิ 
string
ิิ "
,
ิิ" #

Dictionary
ิิ$ .
<
ิิ. /
ILobbyClient
ิิ/ ;
,
ิิ; <
string
ิิ= C
>
ิิC D
>
ิิD E
_games
ิิF L
=
ิิM N
new
ิิO R

Dictionary
ิิS ]
<
ิิ] ^
string
ิิ^ d
,
ิิd e

Dictionary
ิิf p
<
ิิp q
ILobbyClient
ิิq }
,
ิิ} ~
stringิิ 
>ิิ 
>ิิ 
(ิิ 
)ิิ 
;ิิ 
public
ีี 
void
ีี 

CreateGame
ีี 
(
ีี 
string
ีี %
gameName
ีี& .
)
ีี. /
{
ึึ 	
var
ืื 

connection
ืื 
=
ืื 
OperationContext
ืื -
.
ืื- .
Current
ืื. 5
.
ืื5 6 
GetCallbackChannel
ืื6 H
<
ืืH I
ILobbyClient
ืืI U
>
ืืU V
(
ืืV W
)
ืืW X
;
ืืX Y

Dictionary
ุุ 
<
ุุ 
ILobbyClient
ุุ #
,
ุุ# $
string
ุุ% +
>
ุุ+ ,
_members
ุุ- 5
=
ุุ6 7
new
ุุ8 ;

Dictionary
ุุ< F
<
ุุF G
ILobbyClient
ุุG S
,
ุุS T
string
ุุU [
>
ุุ[ \
(
ุุ\ ]
)
ุุ] ^
;
ุุ^ _
_games
ูู 
.
ูู 
Add
ูู 
(
ูู 
gameName
ูู 
,
ูู  
_members
ูู! )
)
ูู) *
;
ูู* +
if
 
(
 
!
 
_lobbies
 
.
 
TryGetValue
 %
(
% &

connection
& 0
,
0 1
out
2 5
string
6 <
host
= A
)
A B
)
B C
return
 
;
 
(
 
(
 

Dictionary
 
<
 
ILobbyClient
 %
,
% &
string
' -
>
- .
)
. /
_games
/ 5
[
5 6
gameName
6 >
]
> ?
)
? @
.
@ A
Add
A D
(
D E

connection
E O
,
O P
host
Q U
)
U V
;
V W
foreach
เเ 
(
เเ 
var
เเ 
other
เเ 
in
เเ !
_lobbies
เเ" *
.
เเ* +
Keys
เเ+ /
)
เเ/ 0
{
แแ 
if
โโ 
(
โโ 
other
โโ 
==
โโ 

connection
โโ '
)
โโ' (
continue
ใใ 
;
ใใ 
other
ไไ 
.
ไไ 

ReciveGame
ไไ  
(
ไไ  !
gameName
ไไ! )
)
ไไ) *
;
ไไ* +
}
ๅๅ 
}
ๆๆ 	
public
่่ 
void
่่ 
JoinGame
่่ 
(
่่ 
string
่่ #
gameName
่่$ ,
)
่่, -
{
้้ 	
var
๊๊ 

connection
๊๊ 
=
๊๊ 
OperationContext
๊๊ -
.
๊๊- .
Current
๊๊. 5
.
๊๊5 6 
GetCallbackChannel
๊๊6 H
<
๊๊H I
ILobbyClient
๊๊I U
>
๊๊U V
(
๊๊V W
)
๊๊W X
;
๊๊X Y
if
๋๋ 
(
๋๋ 
!
๋๋ 
_lobbies
๋๋ 
.
๋๋ 
TryGetValue
๋๋ %
(
๋๋% &

connection
๋๋& 0
,
๋๋0 1
out
๋๋2 5
string
๋๋6 <
	newMember
๋๋= F
)
๋๋F G
)
๋๋G H
return
์์ 
;
์์ 
if
๎๎ 
(
๎๎ 
!
๎๎ 
_games
๎๎ 
.
๎๎ 
TryGetValue
๎๎ #
(
๎๎# $
gameName
๎๎$ ,
,
๎๎, -
out
๎๎. 1

Dictionary
๎๎2 <
<
๎๎< =
ILobbyClient
๎๎= I
,
๎๎I J
string
๎๎K Q
>
๎๎Q R
_members
๎๎S [
)
๎๎[ \
)
๎๎\ ]
return
๏๏ 
;
๏๏ 
int
๑๑ 
numberOfPlayers
๑๑ 
=
๑๑  !
$num
๑๑" #
;
๑๑# $
bool
๒๒ 
canEnter
๒๒ 
=
๒๒ 
false
๒๒ !
;
๒๒! "
foreach
๔๔ 
(
๔๔ 
var
๔๔ 
other
๔๔ 
in
๔๔ !
_members
๔๔" *
.
๔๔* +
Keys
๔๔+ /
)
๔๔/ 0
{
๕๕ 
other
๖๖ 
.
๖๖ !
SendNumberOfPlayers
๖๖ )
(
๖๖) *
out
๖๖* -
numberOfPlayers
๖๖. =
)
๖๖= >
;
๖๖> ?
if
๗๗ 
(
๗๗ 
numberOfPlayers
๗๗ #
!=
๗๗$ &
$num
๗๗' (
)
๗๗( )
break
๘๘ 
;
๘๘ 
}
๙๙ 
if
๛๛ 
(
๛๛ 
numberOfPlayers
๛๛ 
>
๛๛  !
_members
๛๛" *
.
๛๛* +
Count
๛๛+ 0
)
๛๛0 1
canEnter
 
=
 
true
 
;
  
if
 
(
 
canEnter
 
)
 
{
 
int
 

nextMember
 
=
  
$num
! "
;
" #
string
 
[
 
]
 
members
  
=
! "
new
# &
string
' -
[
- .
_members
. 6
.
6 7
Count
7 <
]
< =
;
= >
foreach
 
(
 
var
 
other
 "
in
# %
_members
& .
.
. /
Keys
/ 3
)
3 4
{
 
if
 
(
 
other
 
==
  

connection
! +
)
+ ,
continue
  
;
  !
members
 
[
 

nextMember
 &
]
& '
=
( )
other
* /
.
/ 0
SendUsername
0 <
(
< =
)
= >
;
> ?

nextMember
 
++
  
;
  !
other
 
.
 
ReciveMember
 &
(
& '
	newMember
' 0
)
0 1
;
1 2
}
 
(
 
(
 

Dictionary
 
<
 
ILobbyClient
 )
,
) *
string
+ 1
>
1 2
)
2 3
_games
3 9
[
9 :
gameName
: B
]
B C
)
C D
.
D E
Add
E H
(
H I

connection
I S
,
S T
	newMember
U ^
)
^ _
;
_ `

connection
 
.
 
ReciveMembers
 (
(
( )
members
) 0
)
0 1
;
1 2
}
 
else
 

connection
 
.
 
GameFull
 #
(
# $
)
$ %
;
% &
}
 	
public
 
void
 
	BreakGame
 
(
 
string
 $
gameName
% -
)
- .
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
ILobbyClient
I U
>
U V
(
V W
)
W X
;
X Y
if
 
(
 
!
 
_games
 
.
 
TryGetValue
 #
(
# $
gameName
$ ,
,
, -
out
. 1

Dictionary
2 <
<
< =
ILobbyClient
= I
,
I J
string
K Q
>
Q R
_members
S [
)
[ \
)
\ ]
return
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
.
* +
Keys
+ /
)
/ 0
{
 
if
 
(
 
other
 
==
 

connection
 '
)
' (
continue
 
;
 
bool
 
	kickedOut
 
=
  
false
! &
;
& '
other
 
.
 
	LeaveGame
 
(
  
	kickedOut
  )
)
) *
;
* +
}
 
_games
 
.
 
Remove
 
(
 
gameName
 "
)
" #
;
# $
foreach
ขข 
(
ขข 
var
ขข 
other
ขข 
in
ขข !
_lobbies
ขข" *
.
ขข* +
Keys
ขข+ /
)
ขข/ 0
{
ฃฃ 
if
คค 
(
คค 
other
คค 
==
คค 

connection
คค '
)
คค' (
continue
ฅฅ 
;
ฅฅ 
other
ฆฆ 
.
ฆฆ 
UpdateGames
ฆฆ !
(
ฆฆ! "
)
ฆฆ" #
;
ฆฆ# $
}
งง 
}
จจ 	
public
ชช 
void
ชช 
MemberLeftGame
ชช "
(
ชช" #
string
ชช# )
gameName
ชช* 2
)
ชช2 3
{
ซซ 	
var
ฌฌ 

connection
ฌฌ 
=
ฌฌ 
OperationContext
ฌฌ -
.
ฌฌ- .
Current
ฌฌ. 5
.
ฌฌ5 6 
GetCallbackChannel
ฌฌ6 H
<
ฌฌH I
ILobbyClient
ฌฌI U
>
ฌฌU V
(
ฌฌV W
)
ฌฌW X
;
ฌฌX Y
if
ญญ 
(
ญญ 
!
ญญ 
_lobbies
ญญ 
.
ญญ 
TryGetValue
ญญ %
(
ญญ% &

connection
ญญ& 0
,
ญญ0 1
out
ญญ2 5
string
ญญ6 <
memberWhoLeft
ญญ= J
)
ญญJ K
)
ญญK L
return
ฎฎ 
;
ฎฎ 
(
ฐฐ 
(
ฐฐ 

Dictionary
ฐฐ 
<
ฐฐ 
ILobbyClient
ฐฐ %
,
ฐฐ% &
string
ฐฐ' -
>
ฐฐ- .
)
ฐฐ. /
_games
ฐฐ/ 5
[
ฐฐ5 6
gameName
ฐฐ6 >
]
ฐฐ> ?
)
ฐฐ? @
.
ฐฐ@ A
Remove
ฐฐA G
(
ฐฐG H

connection
ฐฐH R
)
ฐฐR S
;
ฐฐS T
if
ฒฒ 
(
ฒฒ 
!
ฒฒ 
_games
ฒฒ 
.
ฒฒ 
TryGetValue
ฒฒ #
(
ฒฒ# $
gameName
ฒฒ$ ,
,
ฒฒ, -
out
ฒฒ. 1

Dictionary
ฒฒ2 <
<
ฒฒ< =
ILobbyClient
ฒฒ= I
,
ฒฒI J
string
ฒฒK Q
>
ฒฒQ R
_members
ฒฒS [
)
ฒฒ[ \
)
ฒฒ\ ]
return
ณณ 
;
ณณ 
foreach
ตต 
(
ตต 
var
ตต 
other
ตต 
in
ตต !
_members
ตต" *
.
ตต* +
Keys
ตต+ /
)
ตต/ 0
{
ถถ 
if
ทท 
(
ทท 
other
ทท 
==
ทท 

connection
ทท '
)
ทท' (
continue
ธธ 
;
ธธ 
other
นน 
.
นน 
SomeoneLeftGame
นน %
(
นน% &
memberWhoLeft
นน& 3
)
นน3 4
;
นน4 5
}
บบ 
}
ปป 	
public
ฝฝ 
void
ฝฝ 

KickPlayer
ฝฝ 
(
ฝฝ 
string
ฝฝ %
username
ฝฝ& .
,
ฝฝ. /
string
ฝฝ0 6
gameName
ฝฝ7 ?
)
ฝฝ? @
{
พพ 	
var
ฟฟ 

connection
ฟฟ 
=
ฟฟ 
OperationContext
ฟฟ -
.
ฟฟ- .
Current
ฟฟ. 5
.
ฟฟ5 6 
GetCallbackChannel
ฟฟ6 H
<
ฟฟH I
ILobbyClient
ฟฟI U
>
ฟฟU V
(
ฟฟV W
)
ฟฟW X
;
ฟฟX Y
if
ภภ 
(
ภภ 
!
ภภ 
_games
ภภ 
.
ภภ 
TryGetValue
ภภ #
(
ภภ# $
gameName
ภภ$ ,
,
ภภ, -
out
ภภ. 1

Dictionary
ภภ2 <
<
ภภ< =
ILobbyClient
ภภ= I
,
ภภI J
string
ภภK Q
>
ภภQ R
_members
ภภS [
)
ภภ[ \
)
ภภ\ ]
return
มม 
;
มม 
bool
ยย 
	kickedOut
ยย 
=
ยย 
true
ยย !
;
ยย! "
foreach
รร 
(
รร 
var
รร 
other
รร 
in
รร !
_members
รร" *
.
รร* +
Keys
รร+ /
)
รร/ 0
{
ฤฤ 
if
ลล 
(
ลล 
other
ลล 
==
ลล 

connection
ลล '
)
ลล' (
continue
ฦฦ 
;
ฦฦ 
if
วว 
(
วว 
!
วว 
_members
วว 
.
วว 
TryGetValue
วว )
(
วว) *
other
วว* /
,
วว/ 0
out
วว1 4
string
วว5 ;
member
วว< B
)
ววB C
)
ววC D
return
ศศ 
;
ศศ 
if
ษษ 
(
ษษ 
member
ษษ 
==
ษษ 
username
ษษ &
)
ษษ& '
{
สส 
other
หห 
.
หห 
	LeaveGame
หห #
(
หห# $
	kickedOut
หห$ -
)
หห- .
;
หห. /
break
ฬฬ 
;
ฬฬ 
}
ออ 
}
ฮฮ 
}
ฯฯ 	
public
ัั 
void
ัั 
	StartGame
ัั 
(
ัั 
string
ัั $
gameName
ัั% -
)
ัั- .
{
าา 	
try
ำำ 
{
ิิ 
using
ีี 
(
ีี 
DominoContext
ีี $
context
ีี% ,
=
ีี- .
new
ีี/ 2
DominoContext
ีี3 @
(
ีี@ A
)
ีีA B
)
ีีB C
{
ึึ 
if
ืื 
(
ืื 
!
ืื 
_games
ืื 
.
ืื  
TryGetValue
ืื  +
(
ืื+ ,
gameName
ืื, 4
,
ืื4 5
out
ืื6 9

Dictionary
ืื: D
<
ืืD E
ILobbyClient
ืืE Q
,
ืืQ R
string
ืืS Y
>
ืืY Z
_members
ืื[ c
)
ืืc d
)
ืืd e
return
ุุ 
;
ุุ 
var
ฺฺ 
game
ฺฺ 
=
ฺฺ 
new
ฺฺ "
Juego
ฺฺ# (
{
 "
Condiciรณndevictoria
 +
=
, -
$str
. :
,
: ;
	Duraciรณn
  
=
! "
null
# '
,
' (
Ganador
 
=
  !
null
" &
,
& '
}
฿฿ 
;
฿฿ 
context
เเ 
.
เเ 
Juego
เเ !
.
เเ! "
Add
เเ" %
(
เเ% &
game
เเ& *
)
เเ* +
;
เเ+ ,
context
แแ 
.
แแ 
SaveChanges
แแ '
(
แแ' (
)
แแ( )
;
แแ) *
var
ไไ 
round
ไไ 
=
ไไ 
new
ไไ  #
Ronda
ไไ$ )
{
ๅๅ 
Ganador
ๆๆ 
=
ๆๆ  !
null
ๆๆ" &
,
ๆๆ& '
Valorfichaderecha
็็ )
=
็็* +
null
็็, 0
,
็็0 1!
Valorfichaizquierda
่่ +
=
่่, -
null
่่. 2
,
่่2 3
Juego
้้ 
=
้้ 
game
้้  $
,
้้$ %
}
๊๊ 
;
๊๊ 
context
๋๋ 
.
๋๋ 
Ronda
๋๋ !
.
๋๋! "
Add
๋๋" %
(
๋๋% &
round
๋๋& +
)
๋๋+ ,
;
๋๋, -
context
์์ 
.
์์ 
SaveChanges
์์ '
(
์์' (
)
์์( )
;
์์) *
foreach
๏๏ 
(
๏๏ 
var
๏๏  
other
๏๏! &
in
๏๏' )
_members
๏๏* 2
.
๏๏2 3
Keys
๏๏3 7
)
๏๏7 8
{
๐๐ 
if
๑๑ 
(
๑๑ 
!
๑๑ 
_members
๑๑ %
.
๑๑% &
TryGetValue
๑๑& 1
(
๑๑1 2
other
๑๑2 7
,
๑๑7 8
out
๑๑9 <
string
๑๑= C
username
๑๑D L
)
๑๑L M
)
๑๑M N
return
๒๒ "
;
๒๒" #
var
๓๓ 
user
๓๓  
=
๓๓! "
context
๓๓# *
.
๓๓* +
Usuario
๓๓+ 2
.
๓๓2 3
FirstOrDefault
๓๓3 A
(
๓๓A B
u
๓๓B C
=>
๓๓D F
u
๓๓G H
.
๓๓H I
Nombreusuario
๓๓I V
==
๓๓W Y
username
๓๓Z b
)
๓๓b c
;
๓๓c d
var
๔๔ 
player
๔๔ "
=
๔๔# $
new
๔๔% (
Jugador
๔๔) 0
{
๕๕ 
Enturno
๖๖ #
=
๖๖$ %
$num
๖๖& '
,
๖๖' (
Fichasenmano
๗๗ (
=
๗๗) *
$num
๗๗+ ,
,
๗๗, -
Puntaje
๘๘ #
=
๘๘$ %
$num
๘๘& '
,
๘๘' (
Usuario
๙๙ #
=
๙๙$ %
user
๙๙& *
,
๙๙* +
Ronda
๚๚ !
=
๚๚" #
round
๚๚$ )
,
๚๚) *
}
๛๛ 
;
๛๛ 
context
 
.
  
Jugador
  '
.
' (
Add
( +
(
+ ,
player
, 2
)
2 3
;
3 4
context
 
.
  
SaveChanges
  +
(
+ ,
)
, -
;
- .
other
 
.
 

StartRound
 (
(
( )
round
) .
.
. /
RondaID
/ 6
)
6 7
;
7 8
}
 

Dictionary
 
<
 
IGameClient
 *
,
* +
string
, 2
>
2 3
_membersGame
4 @
=
A B
new
C F

Dictionary
G Q
<
Q R
IGameClient
R ]
,
] ^
string
_ e
>
e f
(
f g
)
g h
;
h i
_currentGames
 !
.
! "
Add
" %
(
% &
round
& +
.
+ ,
RondaID
, 3
,
3 4
_membersGame
5 A
)
A B
;
B C
string
 
[
 
]
 
dominoes
 %
=
& '
new
( +
string
, 2
[
2 3
]
3 4
{
5 6
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
U Y
,
Y Z
$str
[ _
,
_ `
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
U Y
,
Y Z
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
7 ;
,
; <
$str
= A
,
A B
$str
7 ;
,
; <
}
= >
;
> ?
Shuffle
 
(
 
dominoes
 $
)
$ %
;
% &
	_dominoes
 
.
 
Add
 !
(
! "
round
" '
.
' (
RondaID
( /
,
/ 0
dominoes
1 9
)
9 :
;
: ;

Dictionary
 
<
 
IChatClient
 *
,
* +
string
, 2
>
2 3
_membersRoomGame
4 D
=
E F
new
G J

Dictionary
K U
<
U V
IChatClient
V a
,
a b
string
c i
>
i j
(
j k
)
k l
;
l m
_rooms
 
.
 
Add
 
(
 
round
 $
.
$ %
RondaID
% ,
,
, -
_membersRoomGame
. >
)
> ?
;
? @
_games
 
.
 
Remove
 !
(
! "
gameName
" *
)
* +
;
+ ,
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
readonly
 

Dictionary
 
<
 
int
 
,
  

Dictionary
! +
<
+ ,
IChatClient
, 7
,
7 8
string
9 ?
>
? @
>
@ A
_rooms
B H
=
I J
new
K N

Dictionary
O Y
<
Y Z
int
Z ]
,
] ^

Dictionary
_ i
<
i j
IChatClient
j u
,
u v
string
w }
>
} ~
>
~ 
( 
) 
; 
public
 
void
 
JoinChat
 
(
 
int
  
room
! %
,
% &
string
' -
username
. 6
)
6 7
{
 	
var
กก 

connection
กก 
=
กก 
OperationContext
กก -
.
กก- .
Current
กก. 5
.
กก5 6 
GetCallbackChannel
กก6 H
<
กกH I
IChatClient
กกI T
>
กกT U
(
กกU V
)
กกV W
;
กกW X
if
ขข 
(
ขข 
!
ขข 
_rooms
ขข 
.
ขข 
TryGetValue
ขข #
(
ขข# $
room
ขข$ (
,
ขข( )
out
ขข* -

Dictionary
ขข. 8
<
ขข8 9
IChatClient
ขข9 D
,
ขขD E
string
ขขF L
>
ขขL M
_membersRoom
ขขN Z
)
ขขZ [
)
ขข[ \
{
ฃฃ 
_membersRoom
คค 
=
คค 
new
คค "

Dictionary
คค# -
<
คค- .
IChatClient
คค. 9
,
คค9 :
string
คค; A
>
คคA B
(
คคB C
)
คคC D
;
คคD E
_rooms
ฅฅ 
.
ฅฅ 
Add
ฅฅ 
(
ฅฅ 
$num
ฅฅ 
,
ฅฅ 
_membersRoom
ฅฅ *
)
ฅฅ* +
;
ฅฅ+ ,
}
ฆฆ 
(
งง 
(
งง 

Dictionary
งง 
<
งง 
IChatClient
งง $
,
งง$ %
string
งง& ,
>
งง, -
)
งง- .
_rooms
งง. 4
[
งง4 5
room
งง5 9
]
งง9 :
)
งง: ;
.
งง; <
Add
งง< ?
(
งง? @

connection
งง@ J
,
งงJ K
username
งงL T
)
งงT U
;
งงU V
}
จจ 	
public
ชช 
void
ชช 
SendMessage
ชช 
(
ชช  
int
ชช  #
room
ชช$ (
,
ชช( )
string
ชช* 0
message
ชช1 8
)
ชช8 9
{
ซซ 	
var
ฌฌ 

connection
ฌฌ 
=
ฌฌ 
OperationContext
ฌฌ -
.
ฌฌ- .
Current
ฌฌ. 5
.
ฌฌ5 6 
GetCallbackChannel
ฌฌ6 H
<
ฌฌH I
IChatClient
ฌฌI T
>
ฌฌT U
(
ฌฌU V
)
ฌฌV W
;
ฌฌW X
if
ญญ 
(
ญญ 
!
ญญ 
_rooms
ญญ 
.
ญญ 
TryGetValue
ญญ #
(
ญญ# $
room
ญญ$ (
,
ญญ( )
out
ญญ* -

Dictionary
ญญ. 8
<
ญญ8 9
IChatClient
ญญ9 D
,
ญญD E
string
ญญF L
>
ญญL M
_membersRoom
ญญN Z
)
ญญZ [
)
ญญ[ \
return
ฎฎ 
;
ฎฎ 
if
ฏฏ 
(
ฏฏ 
!
ฏฏ 
_membersRoom
ฏฏ 
.
ฏฏ 
TryGetValue
ฏฏ )
(
ฏฏ) *

connection
ฏฏ* 4
,
ฏฏ4 5
out
ฏฏ6 9
string
ฏฏ: @
user
ฏฏA E
)
ฏฏE F
)
ฏฏF G
return
ฐฐ 
;
ฐฐ 
foreach
ฒฒ 
(
ฒฒ 
var
ฒฒ 
other
ฒฒ 
in
ฒฒ !
_membersRoom
ฒฒ" .
.
ฒฒ. /
Keys
ฒฒ/ 3
)
ฒฒ3 4
{
ณณ 
if
ดด 
(
ดด 
other
ดด 
==
ดด 

connection
ดด '
)
ดด' (
continue
ตต 
;
ตต 
other
ถถ 
.
ถถ 
ReciveMessage
ถถ #
(
ถถ# $
user
ถถ$ (
,
ถถ( )
message
ถถ* 1
)
ถถ1 2
;
ถถ2 3
}
ทท 
}
ธธ 	
public
บบ 
bool
บบ 
ChangePassword
บบ "
(
บบ" #
string
บบ# )
username
บบ* 2
,
บบ2 3
string
บบ4 :
currentPassword
บบ; J
,
บบJ K
string
บบL R
newPassword
บบS ^
)
บบ^ _
{
ปป 	
try
ผผ 
{
ฝฝ 
using
พพ 
(
พพ 
DominoContext
พพ $
context
พพ% ,
=
พพ- .
new
พพ/ 2
DominoContext
พพ3 @
(
พพ@ A
)
พพA B
)
พพB C
{
ฟฟ 
var
ภภ 
user
ภภ 
=
ภภ 
context
ภภ &
.
ภภ& '
Usuario
ภภ' .
.
ภภ. /
FirstOrDefault
ภภ/ =
(
ภภ= >
u
ภภ> ?
=>
ภภ@ B
u
ภภC D
.
ภภD E
Nombreusuario
ภภE R
==
ภภS U
username
ภภV ^
)
ภภ^ _
;
ภภ_ `
if
มม 
(
มม 
user
มม 
!=
มม 
null
มม  $
)
มม$ %
{
ยย 
if
รร 
(
รร 
user
รร  
.
รร  !
Contraseรฑa
รร! +
.
รร+ ,
Equals
รร, 2
(
รร2 3
currentPassword
รร3 B
)
รรB C
)
รรC D
{
ฤฤ 
user
ลล  
.
ลล  !
Contraseรฑa
ลล! +
=
ลล, -
newPassword
ลล. 9
;
ลล9 :
context
ฦฦ #
.
ฦฦ# $
SaveChanges
ฦฦ$ /
(
ฦฦ/ 0
)
ฦฦ0 1
;
ฦฦ1 2
return
วว "
true
วว# '
;
วว' (
}
ศศ 
}
ษษ 
}
สส 
}
หห 
catch
ฬฬ 
{
ออ 
}
ฯฯ 
return
ะะ 
false
ะะ 
;
ะะ 
}
ัั 	
public
ำำ "
ObservableCollection
ำำ #
<
ำำ# $
UsuarioPuntajes
ำำ$ 3
>
ำำ3 4
	GetScores
ำำ5 >
(
ำำ> ?
)
ำำ? @
{
ิิ 	"
ObservableCollection
ีี  
<
ีี  !
UsuarioPuntajes
ีี! 0
>
ีี0 1
scores
ีี2 8
=
ีี9 :
new
ีี; >"
ObservableCollection
ีี? S
<
ีีS T
UsuarioPuntajes
ีีT c
>
ีีc d
(
ีีd e
)
ีีe f
;
ีีf g
try
ึึ 
{
ืื 
using
ุุ 
(
ุุ 
DominoContext
ุุ $
context
ุุ% ,
=
ุุ- .
new
ุุ/ 2
DominoContext
ุุ3 @
(
ุุ@ A
)
ุุA B
)
ุุB C
{
ูู 
var
ฺฺ 
usersByScore
ฺฺ $
=
ฺฺ% &
context
ฺฺ' .
.
ฺฺ. /
Usuario
ฺฺ/ 6
.
ฺฺ6 7
OrderByDescending
ฺฺ7 H
(
ฺฺH I
p
ฺฺI J
=>
ฺฺK M
p
ฺฺN O
.
ฺฺO P
Puntajeacumulado
ฺฺP `
)
ฺฺ` a
;
ฺฺa b
int
 
lugar
 
=
 
$num
  !
;
! "
foreach
 
(
 
Usuario
 $
user
% )
in
* ,
usersByScore
- 9
)
9 :
{
 
if
 
(
 
user
  
!=
! #
null
$ (
)
( )
{
฿฿ 
scores
เเ "
.
เเ" #
Add
เเ# &
(
เเ& '
new
เเ' *
UsuarioPuntajes
เเ+ :
(
เเ: ;
lugar
เเ; @
,
เเ@ A
user
เเB F
.
เเF G
Nombreusuario
เเG T
,
เเT U
(
เเV W
int
เเW Z
)
เเZ [
user
เเ[ _
.
เเ_ `
Puntajeacumulado
เเ` p
)
เเp q
)
เเq r
;
เเr s
}
แแ 
else
โโ 
return
ใใ "
scores
ใใ# )
;
ใใ) *
lugar
ไไ 
++
ไไ 
;
ไไ  
if
ๆๆ 
(
ๆๆ 
lugar
ๆๆ !
==
ๆๆ" $
$num
ๆๆ% &
)
ๆๆ& '
return
็็ "
scores
็็# )
;
็็) *
}
่่ 
}
้้ 
}
๊๊ 
catch
๋๋ 
(
๋๋ 
	Exception
๋๋ 
ex
๋๋ 
)
๋๋  
{
์์ 
throw
ํํ 
new
ํํ 
	Exception
ํํ #
(
ํํ# $
ex
ํํ$ &
.
ํํ& '
Message
ํํ' .
)
ํํ. /
;
ํํ/ 0
}
๎๎ 
return
๏๏ 
scores
๏๏ 
;
๏๏ 
}
๐๐ 	
public
๒๒ 
bool
๒๒ 
RecoverPassword
๒๒ #
(
๒๒# $
string
๒๒$ *
email
๒๒+ 0
)
๒๒0 1
{
๓๓ 	
try
๔๔ 
{
๕๕ 
using
๖๖ 
(
๖๖ 
DominoContext
๖๖ $
context
๖๖% ,
=
๖๖- .
new
๖๖/ 2
DominoContext
๖๖3 @
(
๖๖@ A
)
๖๖A B
)
๖๖B C
{
๗๗ 
var
๘๘ 
user
๘๘ 
=
๘๘ 
context
๘๘ &
.
๘๘& '
Usuario
๘๘' .
.
๘๘. /
FirstOrDefault
๘๘/ =
(
๘๘= >
u
๘๘> ?
=>
๘๘@ B
u
๘๘C D
.
๘๘D E
Correo
๘๘E K
==
๘๘L N
email
๘๘O T
)
๘๘T U
;
๘๘U V
if
๙๙ 
(
๙๙ 
user
๙๙ 
!=
๙๙ 
null
๙๙  $
)
๙๙$ %
{
๚๚ 
	SendEmail
๛๛ !
(
๛๛! "
user
๛๛" &
,
๛๛& '
false
๛๛( -
)
๛๛- .
;
๛๛. /
return
 
true
 #
;
# $
}
 
else
 
return
 
false
 $
;
$ %
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
[
 	
Obsolete
	 
]
 
public
 
bool
 
SignUp
 
(
 
string
 !
username
" *
,
* +
string
, 2
email
3 8
,
8 9
string
: @
password
A I
)
I J
{
 	
try
 
{
 
using
 
(
 
DominoContext
 $
context
% ,
=
- .
new
/ 2
DominoContext
3 @
(
@ A
)
A B
)
B C
{
 
var
 
existingUser
 $
=
% &
context
' .
.
. /
Usuario
/ 6
.
6 7
FirstOrDefault
7 E
(
E F
u
F G
=>
H J
u
K L
.
L M
Correo
M S
==
T V
email
W \
)
\ ]
;
] ^
if
 
(
 
existingUser
 $
==
% '
null
( ,
)
, -
{
 
existingUser
 $
=
% &
context
' .
.
. /
Usuario
/ 6
.
6 7
FirstOrDefault
7 E
(
E F
u
F G
=>
H J
u
K L
.
L M
Nombreusuario
M Z
==
[ ]
username
^ f
)
f g
;
g h
if
 
(
 
existingUser
 (
==
) +
null
, 0
)
0 1
{
 
var
 
user
  $
=
% &
new
' *
Usuario
+ 2
{
 
Nombreusuario
  -
=
. /
username
0 8
,
8 9
Correo
  &
=
' (
email
) .
,
. /
Contraseรฑa
  *
=
+ ,
password
- 5
,
5 6
Puntajeacumulado
  0
=
1 2
$num
3 4
,
4 5
Estatus
  '
=
( )
$num
* +
,
+ ,
Token
  %
=
& '
ShortId
( /
.
/ 0
Generate
0 8
(
8 9
)
9 :
.
: ;
Trim
; ?
(
? @
)
@ A
}
 
;
 
context
 #
.
# $
Usuario
$ +
.
+ ,
Add
, /
(
/ 0
user
0 4
)
4 5
;
5 6
context
 #
.
# $
SaveChanges
$ /
(
/ 0
)
0 1
;
1 2
	SendEmail
กก %
(
กก% &
user
กก& *
,
กก* +
true
กก, 0
)
กก0 1
;
กก1 2
Console
ฃฃ #
.
ฃฃ# $
	WriteLine
ฃฃ$ -
(
ฃฃ- .
$str
ฃฃ. 9
+
ฃฃ: ;
username
ฃฃ< D
+
ฃฃE F
$str
ฃฃG t
+
ฃฃu v
email
ฃฃw |
)
ฃฃ| }
;
ฃฃ} ~
return
คค "
true
คค# '
;
คค' (
}
ฅฅ 
}
ฆฆ 
}
งง 
}
จจ 
catch
ฉฉ 
(
ฉฉ 
	Exception
ฉฉ 
ex
ฉฉ 
)
ฉฉ  
{
ชช 
throw
ซซ 
new
ซซ 
	Exception
ซซ #
(
ซซ# $
ex
ซซ$ &
.
ซซ& '
Message
ซซ' .
)
ซซ. /
;
ซซ/ 0
}
ฌฌ 
return
ญญ 
false
ญญ 
;
ญญ 
}
ฎฎ 	
public
ฐฐ 
bool
ฐฐ 
VerificateUser
ฐฐ "
(
ฐฐ" #
string
ฐฐ# )
username
ฐฐ* 2
,
ฐฐ2 3
string
ฐฐ4 :
token
ฐฐ; @
)
ฐฐ@ A
{
ฑฑ 	
try
ฒฒ 
{
ณณ 
using
ดด 
(
ดด 
DominoContext
ดด $
context
ดด% ,
=
ดด- .
new
ดด/ 2
DominoContext
ดด3 @
(
ดด@ A
)
ดดA B
)
ดดB C
{
ตต 
var
ถถ 
user
ถถ 
=
ถถ 
context
ถถ &
.
ถถ& '
Usuario
ถถ' .
.
ถถ. /
FirstOrDefault
ถถ/ =
(
ถถ= >
u
ถถ> ?
=>
ถถ@ B
u
ถถC D
.
ถถD E
Nombreusuario
ถถE R
==
ถถS U
username
ถถV ^
)
ถถ^ _
;
ถถ_ `
if
ทท 
(
ทท 
user
ทท 
!=
ทท 
null
ทท  $
)
ทท$ %
{
ธธ 
if
นน 
(
นน 
!
นน 

IsVerified
นน '
(
นน' (
user
นน( ,
.
นน, -
Nombreusuario
นน- :
)
นน: ;
)
นน; <
{
บบ 
if
ปป 
(
ปป  
user
ปป  $
.
ปป$ %
Token
ปป% *
==
ปป+ -
token
ปป. 3
)
ปป3 4
{
ผผ 
user
ฝฝ  $
.
ฝฝ$ %
Estatus
ฝฝ% ,
=
ฝฝ- .
$num
ฝฝ/ 0
;
ฝฝ0 1
context
พพ  '
.
พพ' (
SaveChanges
พพ( 3
(
พพ3 4
)
พพ4 5
;
พพ5 6
return
ฟฟ  &
true
ฟฟ' +
;
ฟฟ+ ,
}
ภภ 
else
มม  
return
ยย  &
false
ยย' ,
;
ยย, -
}
รร 
else
ฤฤ 
return
ลล "
true
ลล# '
;
ลล' (
}
ฦฦ 
}
วว 
}
ศศ 
catch
ษษ 
(
ษษ 
	Exception
ษษ 
ex
ษษ 
)
ษษ  
{
สส 
throw
หห 
new
หห 
	Exception
หห #
(
หห# $
ex
หห$ &
.
หห& '
Message
หห' .
)
หห. /
;
หห/ 0
}
ฬฬ 
return
ออ 
false
ออ 
;
ออ 
}
ฮฮ 	
public
ะะ 
bool
ะะ 

IsVerified
ะะ 
(
ะะ 
string
ะะ %
username
ะะ& .
)
ะะ. /
{
ัั 	
try
าา 
{
ำำ 
using
ิิ 
(
ิิ 
DominoContext
ิิ $
context
ิิ% ,
=
ิิ- .
new
ิิ/ 2
DominoContext
ิิ3 @
(
ิิ@ A
)
ิิA B
)
ิิB C
{
ีี 
var
ึึ 
user
ึึ 
=
ึึ 
context
ึึ &
.
ึึ& '
Usuario
ึึ' .
.
ึึ. /
FirstOrDefault
ึึ/ =
(
ึึ= >
u
ึึ> ?
=>
ึึ@ B
u
ึึC D
.
ึึD E
Nombreusuario
ึึE R
==
ึึS U
username
ึึV ^
)
ึึ^ _
;
ึึ_ `
if
ืื 
(
ืื 
user
ืื 
!=
ืื 
null
ืื  $
)
ืื$ %
{
ุุ 
if
ูู 
(
ูู 
user
ูู  
.
ูู  !
Estatus
ูู! (
==
ูู) +
$num
ูู, -
)
ูู- .
return
ฺฺ "
true
ฺฺ# '
;
ฺฺ' (
else
 
return
 "
false
# (
;
( )
}
 
}
 
}
฿฿ 
catch
เเ 
(
เเ 
	Exception
เเ 
ex
เเ 
)
เเ  
{
แแ 
throw
โโ 
new
โโ 
	Exception
โโ #
(
โโ# $
ex
โโ$ &
.
โโ& '
Message
โโ' .
)
โโ. /
;
โโ/ 0
}
ใใ 
return
ไไ 
false
ไไ 
;
ไไ 
}
ๅๅ 	
public
็็ 
string
็็ 
LogIn
็็ 
(
็็ 
string
็็ "
email
็็# (
,
็็( )
string
็็* 0
password
็็1 9
)
็็9 :
{
่่ 	
try
้้ 
{
๊๊ 
using
๋๋ 
(
๋๋ 
DominoContext
๋๋ $
context
๋๋% ,
=
๋๋- .
new
๋๋/ 2
DominoContext
๋๋3 @
(
๋๋@ A
)
๋๋A B
)
๋๋B C
{
์์ 
var
ํํ 
user
ํํ 
=
ํํ 
context
ํํ &
.
ํํ& '
Usuario
ํํ' .
.
ํํ. /
FirstOrDefault
ํํ/ =
(
ํํ= >
u
ํํ> ?
=>
ํํ@ B
u
ํํC D
.
ํํD E
Correo
ํํE K
==
ํํL N
email
ํํO T
)
ํํT U
;
ํํU V
if
๎๎ 
(
๎๎ 
user
๎๎ 
!=
๎๎ 
null
๎๎  $
)
๎๎$ %
{
๏๏ 
if
๐๐ 
(
๐๐ 
user
๐๐  
.
๐๐  !
Contraseรฑa
๐๐! +
==
๐๐, .
password
๐๐/ 7
)
๐๐7 8
{
๑๑ 
Console
๒๒ #
.
๒๒# $
	WriteLine
๒๒$ -
(
๒๒- .
$str
๒๒. 9
+
๒๒: ;
user
๒๒< @
.
๒๒@ A
Nombreusuario
๒๒A N
+
๒๒O P
$str
๒๒Q f
)
๒๒f g
;
๒๒g h
return
๓๓ "
user
๓๓# '
.
๓๓' (
Nombreusuario
๓๓( 5
;
๓๓5 6
}
๔๔ 
}
๕๕ 
return
๖๖ 
(
๖๖ 
$str
๖๖ 
)
๖๖ 
;
๖๖  
}
๗๗ 
}
๘๘ 
catch
๙๙ 
(
๙๙ 
	Exception
๙๙ 
ex
๙๙ 
)
๙๙  
{
๚๚ 
throw
๛๛ 
new
๛๛ 
	Exception
๛๛ #
(
๛๛# $
ex
๛๛$ &
.
๛๛& '
Message
๛๛' .
)
๛๛. /
;
๛๛/ 0
}
 
}
 	
private
 
bool
 
	SendEmail
 
(
 
Usuario
 &
user
' +
,
+ ,
bool
- 1
isSignUp
2 :
)
: ;
{
 	
try
 
{
 
MailMessage
 
mail
  
=
! "
new
# &
MailMessage
' 2
(
2 3
)
3 4
;
4 5

SmtpClient
 

SmtpServer
 %
=
& '
new
( +

SmtpClient
, 6
(
6 7
$str
7 G
)
G H
;
H I
mail
 
.
 
From
 
=
 
new
 
MailAddress
  +
(
+ ,
$str
, G
,
G H
$str
I W
,
W X
System
Y _
.
_ `
Text
` d
.
d e
Encoding
e m
.
m n
UTF8
n r
)
r s
;
s t
mail
 
.
 
To
 
.
 
Add
 
(
 
user
  
.
  !
Correo
! '
)
' (
;
( )
if
 
(
 
isSignUp
 
)
 
{
 
mail
 
.
 
Subject
  
=
! "
$str
# C
;
C D
mail
 
.
 
Body
 
=
 
$str
  (
+
) *
user
+ /
.
/ 0
Nombreusuario
0 =
+
> ?
$str
@ z
+
{ |
user
 
.
 
Token
 "
;
" #
}
 
else
 
{
 
mail
 
.
 
Subject
  
=
! "
$str
# G
;
G H
mail
 
.
 
Body
 
=
 
$str
  (
+
) *
user
+ /
.
/ 0
Nombreusuario
0 =
+
> ?
$str@ 
+ 
user
 
.
 
Contraseรฑa
 '
+
( )
$str
* k
;
k l
}
 

SmtpServer
 
.
 
Port
 
=
  !
$num
" %
;
% &

SmtpServer
 
.
 
Credentials
 &
=
' (
new
) ,
System
- 3
.
3 4
Net
4 7
.
7 8
NetworkCredential
8 I
(
I J
$str
J e
,
e f
$str
g v
)
v w
;
w x

SmtpServer
 
.
 
	EnableSsl
 $
=
% &
true
' +
;
+ ,

SmtpServer
 
.
 
Send
 
(
  
mail
  $
)
$ %
;
% &
return
 
true
 
;
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
public
กก 
static
กก 
void
กก 
Shuffle
กก "
<
กก" #
T
กก# $
>
กก$ %
(
กก% &
IList
กก& +
<
กก+ ,
T
กก, -
>
กก- .
values
กก/ 5
)
กก5 6
{
ขข 	
var
ฃฃ 
n
ฃฃ 
=
ฃฃ 
values
ฃฃ 
.
ฃฃ 
Count
ฃฃ  
;
ฃฃ  !
var
คค 
rnd
คค 
=
คค 
new
คค 
Random
คค  
(
คค  !
)
คค! "
;
คค" #
for
ฅฅ 
(
ฅฅ 
int
ฅฅ 
i
ฅฅ 
=
ฅฅ 
n
ฅฅ 
-
ฅฅ 
$num
ฅฅ 
;
ฅฅ 
i
ฅฅ  !
>
ฅฅ" #
$num
ฅฅ$ %
;
ฅฅ% &
i
ฅฅ' (
--
ฅฅ( *
)
ฅฅ* +
{
ฆฆ 
var
งง 
j
งง 
=
งง 
rnd
งง 
.
งง 
Next
งง  
(
งง  !
$num
งง! "
,
งง" #
i
งง$ %
)
งง% &
;
งง& '
var
จจ 
temp
จจ 
=
จจ 
values
จจ !
[
จจ! "
i
จจ" #
]
จจ# $
;
จจ$ %
values
ฉฉ 
[
ฉฉ 
i
ฉฉ 
]
ฉฉ 
=
ฉฉ 
values
ฉฉ "
[
ฉฉ" #
j
ฉฉ# $
]
ฉฉ$ %
;
ฉฉ% &
values
ชช 
[
ชช 
j
ชช 
]
ชช 
=
ชช 
temp
ชช  
;
ชช  !
}
ซซ 
}
ฌฌ 	
}
ญญ 
}ฎฎ ร
>C:\Users\ricar\Documents\GitHub\domino\DominoServer\Program.cs
	namespace 	
DominoServer
 
{ 
class 	
Program
 
{ 
static 
void 
Main 
( 
) 
{		 	
ServiceHost

 
host

 
=

 
new

 "
ServiceHost

# .
(

. /
typeof

/ 5
(

5 6
DominoService

6 C
)

C D
)

D E
;

E F
host 
. 
Open 
( 
) 
; 
Console 
. 
	WriteLine 
( 
$str 9
)9 :
;: ;
Console 
. 
ReadLine 
( 
) 
; 
host 
. 
Close 
( 
) 
; 
} 	
} 
} 