ท่
DC:\Users\ricar\Documents\GitHub\domino\DominoServer\DominoService.cs
	namespace 	
DominoServer
 
{ 
[ 
ServiceBehavior 
( 
ConcurrencyMode $
=% &
ConcurrencyMode' 6
.6 7
Single7 =
,= >
InstanceContextMode? R
=S T
InstanceContextModeU h
.h i
Singlei o
)o p
]p q
public 

partial 
class 
DominoService &
:' (
ILoginService) 6
,6 7
IMenuService8 D
,D E
IChatServiceF R
,R S
ILobbyServiceT a
,a b
IGameServicec o
{ 
readonly 

Dictionary 
< 
int 
,  

Dictionary! +
<+ ,
IGameClient, 7
,7 8
string9 ?
>? @
>@ A
_currentGamesB O
=P Q
newR U

DictionaryV `
<` a
inta d
,d e

Dictionaryf p
<p q
IGameClientq |
,| }
string	~ 
>
 
>
 
(
 
)
 
;
 
readonly 

Dictionary 
< 
int 
,  
string! '
[' (
]( )
>) *
	_dominoes+ 4
=5 6
new7 :

Dictionary; E
<E F
intF I
,I J
stringK Q
[Q R
]R S
>S T
(T U
)U V
;V W
public 
void 
JoinCurrentGame #
(# $
int$ '
idGame( .
,. /
string0 6
username7 ?
)? @
{ 	
var 

connection 
= 
OperationContext -
.- .
Current. 5
.5 6
GetCallbackChannel6 H
<H I
IGameClientI T
>T U
(U V
)V W
;W X
if 
( 
! 
_currentGames 
. 
TryGetValue *
(* +
idGame+ 1
,1 2
out3 6

Dictionary7 A
<A B
IGameClientB M
,M N
stringO U
>U V
_membersW _
)_ `
)` a
return 
; 
int 

nextMember 
= 
$num 
; 
string 
[ 
] 
members 
= 
new "
string# )
[) *
_members* 2
.2 3
Count3 8
]8 9
;9 :
foreach 
( 
var 
other 
in !
_members" *
)* +
{ 
if 
( 
other 
. 
Key 
==  

connection! +
)+ ,
{   

nextMember!! 
++!!  
;!!  !
continue"" 
;"" 
}## 
members$$ 
[$$ 

nextMember$$ "
]$$" #
=$$$ %
other$$& +
.$$+ ,
Value$$, 1
;$$1 2

nextMember%% 
++%% 
;%% 
other&& 
.&& 
Key&& 
.&& 
ReciveNewMember&& )
(&&) *
username&&* 2
)&&2 3
;&&3 4
}'' 
_currentGames(( 
[(( 
idGame((  
]((  !
.((! "
Add((" %
(((% &

connection((& 0
,((0 1
username((2 :
)((: ;
;((; <
try)) 
{** 

connection++ 
.++ 
ReciveMembersInGame++ .
(++. /
members++/ 6
)++6 7
;++7 8
},, 
catch-- 
(-- 
	Exception-- 
ex-- 
)--  
{.. 
throw// 
new// 
FaultException// (
(//( )
ex//) +
.//+ ,
Message//, 3
)//3 4
;//4 5
}00 
}11 	
public33 
void33 
GetFirstSevenTiles33 &
(33& '
int33' *
idGame33+ 1
)331 2
{44 	
var55 

connection55 
=55 
OperationContext55 -
.55- .
Current55. 5
.555 6
GetCallbackChannel556 H
<55H I
IGameClient55I T
>55T U
(55U V
)55V W
;55W X
string77 
[77 
]77 
dominoesPerPlayer77 &
=77' (
new77) ,
string77- 3
[773 4
$num774 6
]776 7
;777 8
if88 
(88 
!88 
	_dominoes88 
.88 
TryGetValue88 &
(88& '
idGame88' -
,88- .
out88/ 2
string883 9
[889 :
]88: ;
dominoesInGame88< J
)88J K
)88K L
return99 
;99 
Array;; 
.;; 
Copy;; 
(;; 
dominoesInGame;; %
,;;% &
$num;;' (
,;;( )
dominoesPerPlayer;;* ;
,;;; <
$num;;= >
,;;> ?
$num;;@ A
);;A B
;;;B C
var== 
myList== 
=== 
dominoesInGame== '
.==' (
ToList==( .
(==. /
)==/ 0
;==0 1
myList>> 
.>> 
RemoveRange>> 
(>> 
$num>>  
,>>  !
$num>>" #
)>># $
;>>$ %
dominoesInGame?? 
=?? 
myList?? #
.??# $
ToArray??$ +
(??+ ,
)??, -
;??- .
ShuffleAA 
(AA 
dominoesInGameAA "
)AA" #
;AA# $
	_dominoesCC 
.CC 
RemoveCC 
(CC 
idGameCC #
)CC# $
;CC$ %
	_dominoesDD 
.DD 
AddDD 
(DD 
idGameDD  
,DD  !
dominoesInGameDD" 0
)DD0 1
;DD1 2
tryFF 
{GG 

connectionHH 
.HH 
GetDominoesHH &
(HH& '
dominoesPerPlayerHH' 8
)HH8 9
;HH9 :
}II 
catchJJ 
(JJ 
	ExceptionJJ 
exJJ 
)JJ  
{KK 
throwLL 
newLL 
FaultExceptionLL (
(LL( )
exLL) +
.LL+ ,
MessageLL, 3
)LL3 4
;LL4 5
}MM 
}NN 	
publicPP 
voidPP 
GetPlayersNamePP "
(PP" #
intPP# &
idGamePP' -
)PP- .
{QQ 	
varRR 

connectionRR 
=RR 
OperationContextRR -
.RR- .
CurrentRR. 5
.RR5 6
GetCallbackChannelRR6 H
<RRH I
IGameClientRRI T
>RRT U
(RRU V
)RRV W
;RRW X
ifTT 
(TT 
!TT 
_currentGamesTT 
.TT 
TryGetValueTT *
(TT* +
idGameTT+ 1
,TT1 2
outTT3 6

DictionaryTT7 A
<TTA B
IGameClientTTB M
,TTM N
stringTTO U
>TTU V
_membersTTW _
)TT_ `
)TT` a
returnUU 
;UU 
intWW 

nextMemberWW 
=WW 
$numWW 
;WW 
stringXX 
[XX 
]XX 
membersXX 
=XX 
newXX "
stringXX# )
[XX) *
_membersXX* 2
.XX2 3
CountXX3 8
-XX9 :
$numXX; <
]XX< =
;XX= >
foreachYY 
(YY 
varYY 
otherYY 
inYY !
_membersYY" *
)YY* +
{ZZ 
if[[ 
([[ 
other[[ 
.[[ 
Key[[ 
==[[  

connection[[! +
)[[+ ,
continue\\ 
;\\ 
members]] 
[]] 

nextMember]] "
]]]" #
=]]$ %
other]]& +
.]]+ ,
Value]], 1
;]]1 2

nextMember^^ 
++^^ 
;^^ 
}__ 
try`` 
{aa 

connectionbb 
.bb 
ReciveMembersInGamebb .
(bb. /
membersbb/ 6
)bb6 7
;bb7 8
}cc 
catchdd 
(dd 
	Exceptiondd 
exdd 
)dd  
{ee 
throwff 
newff 
FaultExceptionff (
(ff( )
exff) +
.ff+ ,
Messageff, 3
)ff3 4
;ff4 5
}gg 
}hh 	
publicjj 
voidjj 
GetHighestTilejj "
(jj" #
intjj# &
idGamejj' -
,jj- .
stringjj/ 5
hostHighestTilejj6 E
)jjE F
{kk 	
varll 

connectionll 
=ll 
OperationContextll -
.ll- .
Currentll. 5
.ll5 6
GetCallbackChannelll6 H
<llH I
IGameClientllI T
>llT U
(llU V
)llV W
;llW X
ifmm 
(mm 
!mm 
_currentGamesmm 
.mm 
TryGetValuemm *
(mm* +
idGamemm+ 1
,mm1 2
outmm3 6

Dictionarymm7 A
<mmA B
IGameClientmmB M
,mmM N
stringmmO U
>mmU V
_membersmmW _
)mm_ `
)mm` a
returnnn 
;nn 
stringoo 
highestTileoo 
=oo  
nulloo! %
;oo% &
stringpp 
[pp 
]pp 
highestOfEachPlayerpp (
=pp) *
newpp+ .
stringpp/ 5
[pp5 6
$numpp6 7
]pp7 8
;pp8 9
intqq 
countqq 
=qq 
$numqq 
;qq 
intrr 
whoIsGonnaStartrr 
=rr  !
$numrr" #
;rr# $
foreachss 
(ss 
varss 
otherss 
inss !
_membersss" *
.ss* +
Keysss+ /
)ss/ 0
{tt 
ifuu 
(uu 
otheruu 
==uu 

connectionuu '
)uu' (
{vv 
highestOfEachPlayerww '
[ww' (
countww( -
]ww- .
=ww/ 0
hostHighestTileww1 @
;ww@ A
countxx 
++xx 
;xx 
continueyy 
;yy 
}zz 
highestOfEachPlayer{{ #
[{{# $
count{{$ )
]{{) *
={{+ ,
other{{- 2
.{{2 3
SendHighestTile{{3 B
({{B C
){{C D
;{{D E
count|| 
++|| 
;|| 
}}} 
for~~ 
(~~ 
int~~ 
i~~ 
=~~ 
$num~~ 
;~~ 
i~~ 
<~~ 
_members~~  (
.~~( )
Count~~) .
;~~. /
i~~0 1
++~~1 3
)~~3 4
{ 
bool
 
replace
 
;
 
if
 
(
 
highestTile
 
==
  "
null
# '
)
' (
replace
 
=
 
true
 "
;
" #
else
 
{
 
int
 
highestNumberOne
 (
=
) *
int
+ .
.
. /
Parse
/ 4
(
4 5
highestTile
5 @
.
@ A
	Substring
A J
(
J K
$num
K L
,
L M
$num
N O
)
O P
)
P Q
;
Q R
int
 
highestNumberTwo
 (
=
) *
int
+ .
.
. /
Parse
/ 4
(
4 5
highestTile
5 @
.
@ A
	Substring
A J
(
J K
$num
K L
,
L M
$num
N O
)
O P
)
P Q
;
Q R
bool
 
highestIsMule
 &
=
' (
highestNumberOne
) 9
==
: <
highestNumberTwo
= M
;
M N
int
 
	numberOne
 !
=
" #
int
$ '
.
' (
Parse
( -
(
- .!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
.
D E
	Substring
E N
(
N O
$num
O P
,
P Q
$num
R S
)
S T
)
T U
;
U V
int
 
	numberTwo
 !
=
" #
int
$ '
.
' (
Parse
( -
(
- .!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
.
D E
	Substring
E N
(
N O
$num
O P
,
P Q
$num
R S
)
S T
)
T U
;
U V
bool
 
isMule
 
=
  !
	numberOne
" +
==
, .
	numberTwo
/ 8
;
8 9
if
 
(
 
highestIsMule
 %
)
% &
{
 
replace
 
=
  !
HighestIsMule
" /
(
/ 0
isMule
0 6
,
6 7
	numberOne
8 A
,
A B
highestNumberOne
C S
)
S T
;
T U
}
 
else
 
{
 
int
 
weight
 "
=
# $
	numberOne
% .
+
/ 0
	numberTwo
1 :
;
: ;
int
 
highestWeight
 )
=
* +
highestNumberOne
, <
+
= >
highestNumberTwo
? O
;
O P
replace
 
=
  !
HighestIsNotMule
" 2
(
2 3
isMule
3 9
,
9 :
weight
; A
,
A B
highestWeight
C P
)
P Q
;
Q R
}
 
}
 
if
 
(
 
replace
 
)
 
{
 
highestTile
 
=
  !!
highestOfEachPlayer
" 5
[
5 6
i
6 7
]
7 8
;
8 9
whoIsGonnaStart
 #
=
$ %
i
& '
;
' (
}
 
}
 
count
 
=
 
$num
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
.
* +
Keys
+ /
)
/ 0
{
 
if
กก 
(
กก 
count
กก 
==
กก 
whoIsGonnaStart
กก ,
)
กก, -
{
ขข 
other
ฃฃ 
.
ฃฃ 

IsYourTurn
ฃฃ $
(
ฃฃ$ %
isFirstTurn
ฃฃ% 0
:
ฃฃ0 1
true
ฃฃ2 6
)
ฃฃ6 7
;
ฃฃ7 8
break
คค 
;
คค 
}
ฅฅ 
count
ฆฆ 
++
ฆฆ 
;
ฆฆ 
}
งง 
}
ฉฉ 	
private
ซซ 
bool
ซซ 
HighestIsNotMule
ซซ %
(
ซซ% &
bool
ซซ& *
isMule
ซซ+ 1
,
ซซ1 2
int
ซซ3 6
weight
ซซ7 =
,
ซซ= >
int
ซซ? B
highestWeight
ซซC P
)
ซซP Q
{
ฌฌ 	
if
ญญ 
(
ญญ 
isMule
ญญ 
)
ญญ 
return
ฎฎ 
true
ฎฎ 
;
ฎฎ 
else
ฏฏ 
{
ฐฐ 
if
ฑฑ 
(
ฑฑ 
weight
ฑฑ 
>
ฑฑ 
highestWeight
ฑฑ *
)
ฑฑ* +
return
ฒฒ 
true
ฒฒ 
;
ฒฒ  
}
ณณ 
return
ดด 
false
ดด 
;
ดด 
}
ตต 	
private
ทท 
bool
ทท 
HighestIsMule
ทท "
(
ทท" #
bool
ทท# '
isMule
ทท( .
,
ทท. /
int
ทท0 3
	numberOne
ทท4 =
,
ทท= >
int
ทท? B
highestNumberOne
ททC S
)
ททS T
{
ธธ 	
if
นน 
(
นน 
isMule
นน 
&&
นน 
	numberOne
นน #
>
นน$ %
highestNumberOne
นน& 6
)
นน6 7
return
บบ 
true
บบ 
;
บบ 
return
ปป 
false
ปป 
;
ปป 
}
ผผ 	
public
พพ 
void
พพ 
PutATile
พพ 
(
พพ 
int
พพ  
idGame
พพ! '
,
พพ' (
string
พพ) /
tile
พพ0 4
,
พพ4 5
bool
พพ6 :
decision
พพ; C
)
พพC D
{
ฟฟ 	
var
ภภ 

connection
ภภ 
=
ภภ 
OperationContext
ภภ -
.
ภภ- .
Current
ภภ. 5
.
ภภ5 6 
GetCallbackChannel
ภภ6 H
<
ภภH I
IGameClient
ภภI T
>
ภภT U
(
ภภU V
)
ภภV W
;
ภภW X
if
มม 
(
มม 
!
มม 
_currentGames
มม 
.
มม 
TryGetValue
มม *
(
มม* +
idGame
มม+ 1
,
มม1 2
out
มม3 6

Dictionary
มม7 A
<
มมA B
IGameClient
มมB M
,
มมM N
string
มมO U
>
มมU V
_members
มมW _
)
มม_ `
)
มม` a
return
ยย 
;
ยย 
if
รร 
(
รร 
!
รร 
_members
รร 
.
รร 
TryGetValue
รร %
(
รร% &

connection
รร& 0
,
รร0 1
out
รร2 5
string
รร6 <
whoPutTheTile
รร= J
)
รรJ K
)
รรK L
return
ฤฤ 
;
ฤฤ 
foreach
ลล 
(
ลล 
var
ลล 
other
ลล 
in
ลล !
_members
ลล" *
.
ลล* +
Keys
ลล+ /
)
ลล/ 0
{
ฦฦ 
if
ศศ 
(
ศศ 
other
ศศ 
==
ศศ 

connection
ศศ '
)
ศศ' (
continue
ษษ 
;
ษษ 
other
สส 
.
สส 
SomeonePutATile
สส %
(
สส% &
whoPutTheTile
สส& 3
,
สส3 4
tile
สส5 9
,
สส9 :
decision
สส; C
)
สสC D
;
สสD E
}
หห 
}
ฬฬ 	
public
ฮฮ 
void
ฮฮ 
PassTurn
ฮฮ 
(
ฮฮ 
int
ฮฮ  
idGame
ฮฮ! '
)
ฮฮ' (
{
ฯฯ 	
var
ะะ 

connection
ะะ 
=
ะะ 
OperationContext
ะะ -
.
ะะ- .
Current
ะะ. 5
.
ะะ5 6 
GetCallbackChannel
ะะ6 H
<
ะะH I
IGameClient
ะะI T
>
ะะT U
(
ะะU V
)
ะะV W
;
ะะW X
if
ัั 
(
ัั 
!
ัั 
_currentGames
ัั 
.
ัั 
TryGetValue
ัั *
(
ัั* +
idGame
ัั+ 1
,
ัั1 2
out
ัั3 6

Dictionary
ัั7 A
<
ััA B
IGameClient
ััB M
,
ััM N
string
ััO U
>
ััU V
_members
ััW _
)
ัั_ `
)
ัั` a
return
าา 
;
าา 
bool
ำำ 
nextTurn
ำำ 
=
ำำ 
false
ำำ !
;
ำำ! "
foreach
ิิ 
(
ิิ 
var
ิิ 
other
ิิ 
in
ิิ !
_members
ิิ" *
.
ิิ* +
Keys
ิิ+ /
)
ิิ/ 0
{
ีี 
if
ึึ 
(
ึึ 
other
ึึ 
==
ึึ 

connection
ึึ '
)
ึึ' (
{
ืื 
nextTurn
ุุ 
=
ุุ 
true
ุุ #
;
ุุ# $
continue
ูู 
;
ูู 
}
ฺฺ 
if
 
(
 
nextTurn
 
)
 
{
 
other
 
.
 

IsYourTurn
 $
(
$ %
isFirstTurn
% 0
:
0 1
false
2 7
)
7 8
;
8 9
nextTurn
 
=
 
false
 $
;
$ %
}
฿฿ 
}
เเ 
if
แแ 
(
แแ 
nextTurn
แแ 
)
แแ 
_members
โโ 
.
โโ 
First
โโ 
(
โโ 
)
โโ  
.
โโ  !
Key
โโ! $
.
โโ$ %

IsYourTurn
โโ% /
(
โโ/ 0
isFirstTurn
โโ0 ;
:
โโ; <
false
โโ= B
)
โโB C
;
โโC D
}
ใใ 	
public
ๅๅ 
void
ๅๅ 
TakeFromTheBank
ๅๅ #
(
ๅๅ# $
int
ๅๅ$ '
idGame
ๅๅ( .
)
ๅๅ. /
{
ๆๆ 	
var
็็ 

connection
็็ 
=
็็ 
OperationContext
็็ -
.
็็- .
Current
็็. 5
.
็็5 6 
GetCallbackChannel
็็6 H
<
็็H I
IGameClient
็็I T
>
็็T U
(
็็U V
)
็็V W
;
็็W X
if
่่ 
(
่่ 
!
่่ 
	_dominoes
่่ 
.
่่ 
TryGetValue
่่ &
(
่่& '
idGame
่่' -
,
่่- .
out
่่/ 2
string
่่3 9
[
่่9 :
]
่่: ;
dominoesInGame
่่< J
)
่่J K
)
่่K L
return
้้ 
;
้้ 
string
๋๋ 
newTile
๋๋ 
=
๋๋ 
dominoesInGame
๋๋ +
[
๋๋+ ,
$num
๋๋, -
]
๋๋- .
;
๋๋. /
var
ํํ 
myList
ํํ 
=
ํํ 
dominoesInGame
ํํ '
.
ํํ' (
ToList
ํํ( .
(
ํํ. /
)
ํํ/ 0
;
ํํ0 1
myList
๎๎ 
.
๎๎ 
RemoveRange
๎๎ 
(
๎๎ 
$num
๎๎  
,
๎๎  !
$num
๎๎" #
)
๎๎# $
;
๎๎$ %
dominoesInGame
๏๏ 
=
๏๏ 
myList
๏๏ #
.
๏๏# $
ToArray
๏๏$ +
(
๏๏+ ,
)
๏๏, -
;
๏๏- .
Shuffle
๑๑ 
(
๑๑ 
dominoesInGame
๑๑ "
)
๑๑" #
;
๑๑# $
	_dominoes
๓๓ 
.
๓๓ 
Remove
๓๓ 
(
๓๓ 
idGame
๓๓ #
)
๓๓# $
;
๓๓$ %
	_dominoes
๔๔ 
.
๔๔ 
Add
๔๔ 
(
๔๔ 
idGame
๔๔  
,
๔๔  !
dominoesInGame
๔๔" 0
)
๔๔0 1
;
๔๔1 2
if
๖๖ 
(
๖๖ 
!
๖๖ 
_currentGames
๖๖ 
.
๖๖ 
TryGetValue
๖๖ *
(
๖๖* +
idGame
๖๖+ 1
,
๖๖1 2
out
๖๖3 6

Dictionary
๖๖7 A
<
๖๖A B
IGameClient
๖๖B M
,
๖๖M N
string
๖๖O U
>
๖๖U V
_members
๖๖W _
)
๖๖_ `
)
๖๖` a
return
๗๗ 
;
๗๗ 
if
๘๘ 
(
๘๘ 
!
๘๘ 
_members
๘๘ 
.
๘๘ 
TryGetValue
๘๘ %
(
๘๘% &

connection
๘๘& 0
,
๘๘0 1
out
๘๘2 5
string
๘๘6 <
whoTookTheTile
๘๘= K
)
๘๘K L
)
๘๘L M
return
๙๙ 
;
๙๙ 
foreach
๚๚ 
(
๚๚ 
var
๚๚ 
other
๚๚ 
in
๚๚ !
_members
๚๚" *
)
๚๚* +
{
๛๛ 
if
 
(
 
other
 
.
 
Key
 
==
  

connection
! +
)
+ ,
continue
 
;
 
other
 
.
 
Key
 
.
 
SomeoneTookATile
 *
(
* +
whoTookTheTile
+ 9
)
9 :
;
: ;
}
 
try
 
{
 

connection
 
.
 

GetTheTile
 %
(
% &
newTile
& -
)
- .
;
. /
}
 
catch
 
(
 &
IndexOutOfRangeException
 +
ex
, .
)
. /
{
 
throw
 
new
 
FaultException
 (
(
( )
ex
) +
.
+ ,
Message
, 3
)
3 4
;
4 5
}
 
}
 	
public
 
void
 
Win
 
(
 
int
 
idGame
 "
)
" #
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
IGameClient
I T
>
T U
(
U V
)
V W
;
W X
if
 
(
 
!
 
_currentGames
 
.
 
TryGetValue
 *
(
* +
idGame
+ 1
,
1 2
out
3 6

Dictionary
7 A
<
A B
IGameClient
B M
,
M N
string
O U
>
U V
_members
W _
)
_ `
)
` a
return
 
;
 
if
 
(
 
!
 
_members
 
.
 
TryGetValue
 %
(
% &

connection
& 0
,
0 1
out
2 5
string
6 <
	theWinner
= F
)
F G
)
G H
return
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
)
* +
{
 
if
 
(
 
other
 
.
 
Key
 
==
  

connection
! +
)
+ ,
continue
 
;
 
other
 
.
 
Key
 
.
  
SomeoneWonTheRound
 ,
(
, -
	theWinner
- 6
)
6 7
;
7 8
}
 
try
 
{
 
using
 
(
 
DominoContext
 $
context
% ,
=
- .
new
/ 2
DominoContext
3 @
(
@ A
)
A B
)
B C
{
 
var
 
round
 
=
 
context
  '
.
' (
Ronda
( -
.
- .
FirstOrDefault
. <
(
< =
r
= >
=>
? A
r
B C
.
C D
RondaID
D K
==
L N
idGame
O U
)
U V
;
V W
round
 
.
 
Ganador
 !
=
" #
	theWinner
$ -
;
- .
var
 
game
 
=
 
round
 $
.
$ %
Juego
% *
;
* +
game
 
.
 
Ganador
  
=
! "
	theWinner
# ,
;
, -
context
กก 
.
กก 
SaveChanges
กก '
(
กก' (
)
กก( )
;
กก) *
}
ขข 
}
ฃฃ 
catch
คค 
(
คค 
	Exception
คค 
ex
คค 
)
คค  
{
ฅฅ 
throw
ฆฆ 
new
ฆฆ 
	Exception
ฆฆ #
(
ฆฆ# $
ex
ฆฆ$ &
.
ฆฆ& '
Message
ฆฆ' .
)
ฆฆ. /
;
ฆฆ/ 0
}
งง 
}
จจ 	
public
ชช 
void
ชช 
UploadPoints
ชช  
(
ชช  !
int
ชช! $
idGame
ชช% +
,
ชช+ ,
int
ชช- 0
points
ชช1 7
)
ชช7 8
{
ซซ 	
var
ฌฌ 

connection
ฌฌ 
=
ฌฌ 
OperationContext
ฌฌ -
.
ฌฌ- .
Current
ฌฌ. 5
.
ฌฌ5 6 
GetCallbackChannel
ฌฌ6 H
<
ฌฌH I
IGameClient
ฌฌI T
>
ฌฌT U
(
ฌฌU V
)
ฌฌV W
;
ฌฌW X
if
ญญ 
(
ญญ 
!
ญญ 
_currentGames
ญญ 
.
ญญ 
TryGetValue
ญญ *
(
ญญ* +
idGame
ญญ+ 1
,
ญญ1 2
out
ญญ3 6

Dictionary
ญญ7 A
<
ญญA B
IGameClient
ญญB M
,
ญญM N
string
ญญO U
>
ญญU V
_members
ญญW _
)
ญญ_ `
)
ญญ` a
return
ฎฎ 
;
ฎฎ 
if
ฏฏ 
(
ฏฏ 
!
ฏฏ 
_members
ฏฏ 
.
ฏฏ 
TryGetValue
ฏฏ %
(
ฏฏ% &

connection
ฏฏ& 0
,
ฏฏ0 1
out
ฏฏ2 5
string
ฏฏ6 <
username
ฏฏ= E
)
ฏฏE F
)
ฏฏF G
return
ฐฐ 
;
ฐฐ 
try
ฑฑ 
{
ฒฒ 
using
ณณ 
(
ณณ 
DominoContext
ณณ $
context
ณณ% ,
=
ณณ- .
new
ณณ/ 2
DominoContext
ณณ3 @
(
ณณ@ A
)
ณณA B
)
ณณB C
{
ดด 
var
ตต 
player
ตต 
=
ตต  
context
ตต! (
.
ตต( )
Jugador
ตต) 0
.
ตต0 1
FirstOrDefault
ตต1 ?
(
ตต? @
p
ตต@ A
=>
ตตB D
p
ตตE F
.
ตตF G
RondaID
ตตG N
==
ตตO Q
idGame
ตตR X
&&
ตตY [
p
ตต\ ]
.
ตต] ^
Usuario
ตต^ e
.
ตตe f
Nombreusuario
ตตf s
==
ตตt v
username
ตตw 
)ตต 
;ตต 
player
ถถ 
.
ถถ 
Puntaje
ถถ "
=
ถถ# $
points
ถถ% +
;
ถถ+ ,
var
ทท 
user
ทท 
=
ทท 
player
ทท %
.
ทท% &
Usuario
ทท& -
;
ทท- .
user
ธธ 
.
ธธ 
Puntajeacumulado
ธธ )
+=
ธธ* ,
points
ธธ- 3
;
ธธ3 4
context
นน 
.
นน 
SaveChanges
นน '
(
นน' (
)
นน( )
;
นน) *
}
บบ 
_members
ปป 
.
ปป 
Remove
ปป 
(
ปป  

connection
ปป  *
)
ปป* +
;
ปป+ ,
if
ผผ 
(
ผผ 
_members
ผผ 
.
ผผ 
Count
ผผ "
==
ผผ# %
$num
ผผ& '
)
ผผ' (
{
ฝฝ 
_rooms
พพ 
.
พพ 
Remove
พพ !
(
พพ! "
idGame
พพ" (
)
พพ( )
;
พพ) *
_currentGames
ฟฟ !
.
ฟฟ! "
Remove
ฟฟ" (
(
ฟฟ( )
idGame
ฟฟ) /
)
ฟฟ/ 0
;
ฟฟ0 1
	_dominoes
ภภ 
.
ภภ 
Remove
ภภ $
(
ภภ$ %
idGame
ภภ% +
)
ภภ+ ,
;
ภภ, -
}
มม 
}
ยย 
catch
รร 
(
รร 
	Exception
รร 
ex
รร 
)
รร  
{
ฤฤ 
throw
ลล 
new
ลล 
	Exception
ลล #
(
ลล# $
ex
ลล$ &
.
ลล& '
Message
ลล' .
)
ลล. /
;
ลล/ 0
}
ฦฦ 
}
วว 	
readonly
ษษ 

Dictionary
ษษ 
<
ษษ 
ILobbyClient
ษษ (
,
ษษ( )
string
ษษ* 0
>
ษษ0 1
_lobbies
ษษ2 :
=
ษษ; <
new
ษษ= @

Dictionary
ษษA K
<
ษษK L
ILobbyClient
ษษL X
,
ษษX Y
string
ษษZ `
>
ษษ` a
(
ษษa b
)
ษษb c
;
ษษc d
public
สส 
void
สส 
	JoinLobby
สส 
(
สส 
string
สส $
username
สส% -
)
สส- .
{
หห 	
var
ฬฬ 

connection
ฬฬ 
=
ฬฬ 
OperationContext
ฬฬ -
.
ฬฬ- .
Current
ฬฬ. 5
.
ฬฬ5 6 
GetCallbackChannel
ฬฬ6 H
<
ฬฬH I
ILobbyClient
ฬฬI U
>
ฬฬU V
(
ฬฬV W
)
ฬฬW X
;
ฬฬX Y
_lobbies
ออ 
[
ออ 

connection
ออ 
]
ออ  
=
ออ! "
username
ออ# +
;
ออ+ ,
}
ฮฮ 	
public
ะะ 
void
ะะ 
GetGames
ะะ 
(
ะะ 
)
ะะ 
{
ัั 	
var
าา 

connection
าา 
=
าา 
OperationContext
าา -
.
าา- .
Current
าา. 5
.
าา5 6 
GetCallbackChannel
าา6 H
<
าาH I
ILobbyClient
าาI U
>
าาU V
(
าาV W
)
าาW X
;
าาX Y
foreach
ำำ 
(
ำำ 
var
ำำ 
other
ำำ 
in
ำำ !
_games
ำำ" (
.
ำำ( )
Keys
ำำ) -
)
ำำ- .
{
ิิ 

connection
ีี 
.
ีี 

ReciveGame
ีี %
(
ีี% &
other
ีี& +
)
ีี+ ,
;
ีี, -
}
ึึ 
}
ืื 	
readonly
ูู 

Dictionary
ูู 
<
ูู 
string
ูู "
,
ูู" #

Dictionary
ูู$ .
<
ูู. /
ILobbyClient
ูู/ ;
,
ูู; <
string
ูู= C
>
ููC D
>
ููD E
_games
ููF L
=
ููM N
new
ููO R

Dictionary
ููS ]
<
ูู] ^
string
ูู^ d
,
ููd e

Dictionary
ููf p
<
ููp q
ILobbyClient
ููq }
,
ูู} ~
stringูู 
>ูู 
>ูู 
(ูู 
)ูู 
;ูู 
public
ฺฺ 
void
ฺฺ 

CreateGame
ฺฺ 
(
ฺฺ 
string
ฺฺ %
gameName
ฺฺ& .
)
ฺฺ. /
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
ILobbyClient
I U
>
U V
(
V W
)
W X
;
X Y

Dictionary
 
<
 
ILobbyClient
 #
,
# $
string
% +
>
+ ,
_members
- 5
=
6 7
new
8 ;

Dictionary
< F
<
F G
ILobbyClient
G S
,
S T
string
U [
>
[ \
(
\ ]
)
] ^
;
^ _
_games
 
.
 
Add
 
(
 
gameName
 
,
  
_members
! )
)
) *
;
* +
if
เเ 
(
เเ 
!
เเ 
_lobbies
เเ 
.
เเ 
TryGetValue
เเ %
(
เเ% &

connection
เเ& 0
,
เเ0 1
out
เเ2 5
string
เเ6 <
host
เเ= A
)
เเA B
)
เเB C
return
แแ 
;
แแ 
_games
ใใ 
[
ใใ 
gameName
ใใ 
]
ใใ 
.
ใใ 
Add
ใใ  
(
ใใ  !

connection
ใใ! +
,
ใใ+ ,
host
ใใ- 1
)
ใใ1 2
;
ใใ2 3
foreach
ๅๅ 
(
ๅๅ 
var
ๅๅ 
other
ๅๅ 
in
ๅๅ !
_lobbies
ๅๅ" *
.
ๅๅ* +
Keys
ๅๅ+ /
)
ๅๅ/ 0
{
ๆๆ 
if
็็ 
(
็็ 
other
็็ 
==
็็ 

connection
็็ '
)
็็' (
continue
่่ 
;
่่ 
other
้้ 
.
้้ 

ReciveGame
้้  
(
้้  !
gameName
้้! )
)
้้) *
;
้้* +
}
๊๊ 
}
๋๋ 	
public
ํํ 
void
ํํ 
JoinGame
ํํ 
(
ํํ 
string
ํํ #
gameName
ํํ$ ,
)
ํํ, -
{
๎๎ 	
var
๏๏ 

connection
๏๏ 
=
๏๏ 
OperationContext
๏๏ -
.
๏๏- .
Current
๏๏. 5
.
๏๏5 6 
GetCallbackChannel
๏๏6 H
<
๏๏H I
ILobbyClient
๏๏I U
>
๏๏U V
(
๏๏V W
)
๏๏W X
;
๏๏X Y
if
๐๐ 
(
๐๐ 
!
๐๐ 
_lobbies
๐๐ 
.
๐๐ 
TryGetValue
๐๐ %
(
๐๐% &

connection
๐๐& 0
,
๐๐0 1
out
๐๐2 5
string
๐๐6 <
	newMember
๐๐= F
)
๐๐F G
)
๐๐G H
return
๑๑ 
;
๑๑ 
if
๓๓ 
(
๓๓ 
!
๓๓ 
_games
๓๓ 
.
๓๓ 
TryGetValue
๓๓ #
(
๓๓# $
gameName
๓๓$ ,
,
๓๓, -
out
๓๓. 1

Dictionary
๓๓2 <
<
๓๓< =
ILobbyClient
๓๓= I
,
๓๓I J
string
๓๓K Q
>
๓๓Q R
_members
๓๓S [
)
๓๓[ \
)
๓๓\ ]
return
๔๔ 
;
๔๔ 
int
๖๖ 
numberOfPlayers
๖๖ 
=
๖๖  !
$num
๖๖" #
;
๖๖# $
bool
๗๗ 
canEnter
๗๗ 
=
๗๗ 
false
๗๗ !
;
๗๗! "
foreach
๙๙ 
(
๙๙ 
var
๙๙ 
other
๙๙ 
in
๙๙ !
_members
๙๙" *
.
๙๙* +
Keys
๙๙+ /
)
๙๙/ 0
{
๚๚ 
other
๛๛ 
.
๛๛ !
SendNumberOfPlayers
๛๛ )
(
๛๛) *
out
๛๛* -
numberOfPlayers
๛๛. =
)
๛๛= >
;
๛๛> ?
if
 
(
 
numberOfPlayers
 #
!=
$ &
$num
' (
)
( )
break
 
;
 
}
 
if
 
(
 
numberOfPlayers
 
>
  !
_members
" *
.
* +
Count
+ 0
)
0 1
canEnter
 
=
 
true
 
;
  
if
 
(
 
canEnter
 
)
 
{
 
int
 

nextMember
 
=
  
$num
! "
;
" #
string
 
[
 
]
 
members
  
=
! "
new
# &
string
' -
[
- .
_members
. 6
.
6 7
Count
7 <
]
< =
;
= >
foreach
 
(
 
var
 
other
 "
in
# %
_members
& .
.
. /
Keys
/ 3
)
3 4
{
 
if
 
(
 
other
 
==
  

connection
! +
)
+ ,
continue
  
;
  !
members
 
[
 

nextMember
 &
]
& '
=
( )
other
* /
.
/ 0
SendUsername
0 <
(
< =
)
= >
;
> ?

nextMember
 
++
  
;
  !
other
 
.
 
ReciveMember
 &
(
& '
	newMember
' 0
)
0 1
;
1 2
}
 
_games
 
[
 
gameName
 
]
  
.
  !
Add
! $
(
$ %

connection
% /
,
/ 0
	newMember
1 :
)
: ;
;
; <

connection
 
.
 
ReciveMembers
 (
(
( )
members
) 0
)
0 1
;
1 2
}
 
else
 

connection
 
.
 
GameFull
 #
(
# $
)
$ %
;
% &
}
 	
public
 
void
 
	BreakGame
 
(
 
string
 $
gameName
% -
)
- .
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
ILobbyClient
I U
>
U V
(
V W
)
W X
;
X Y
if
 
(
 
!
 
_games
 
.
 
TryGetValue
 #
(
# $
gameName
$ ,
,
, -
out
. 1

Dictionary
2 <
<
< =
ILobbyClient
= I
,
I J
string
K Q
>
Q R
_members
S [
)
[ \
)
\ ]
return
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
.
* +
Keys
+ /
)
/ 0
{
 
if
 
(
 
other
 
==
 

connection
 '
)
' (
continue
 
;
 
bool
กก 
	kickedOut
กก 
=
กก  
false
กก! &
;
กก& '
other
ขข 
.
ขข 
	LeaveGame
ขข 
(
ขข  
	kickedOut
ขข  )
)
ขข) *
;
ขข* +
}
ฃฃ 
_games
ฅฅ 
.
ฅฅ 
Remove
ฅฅ 
(
ฅฅ 
gameName
ฅฅ "
)
ฅฅ" #
;
ฅฅ# $
foreach
งง 
(
งง 
var
งง 
other
งง 
in
งง !
_lobbies
งง" *
.
งง* +
Keys
งง+ /
)
งง/ 0
{
จจ 
if
ฉฉ 
(
ฉฉ 
other
ฉฉ 
==
ฉฉ 

connection
ฉฉ '
)
ฉฉ' (
continue
ชช 
;
ชช 
other
ซซ 
.
ซซ 
UpdateGames
ซซ !
(
ซซ! "
)
ซซ" #
;
ซซ# $
}
ฌฌ 
}
ญญ 	
public
ฏฏ 
void
ฏฏ 
MemberLeftGame
ฏฏ "
(
ฏฏ" #
string
ฏฏ# )
gameName
ฏฏ* 2
)
ฏฏ2 3
{
ฐฐ 	
var
ฑฑ 

connection
ฑฑ 
=
ฑฑ 
OperationContext
ฑฑ -
.
ฑฑ- .
Current
ฑฑ. 5
.
ฑฑ5 6 
GetCallbackChannel
ฑฑ6 H
<
ฑฑH I
ILobbyClient
ฑฑI U
>
ฑฑU V
(
ฑฑV W
)
ฑฑW X
;
ฑฑX Y
if
ฒฒ 
(
ฒฒ 
!
ฒฒ 
_lobbies
ฒฒ 
.
ฒฒ 
TryGetValue
ฒฒ %
(
ฒฒ% &

connection
ฒฒ& 0
,
ฒฒ0 1
out
ฒฒ2 5
string
ฒฒ6 <
memberWhoLeft
ฒฒ= J
)
ฒฒJ K
)
ฒฒK L
return
ณณ 
;
ณณ 
_games
ตต 
[
ตต 
gameName
ตต 
]
ตต 
.
ตต 
Remove
ตต #
(
ตต# $

connection
ตต$ .
)
ตต. /
;
ตต/ 0
if
ทท 
(
ทท 
!
ทท 
_games
ทท 
.
ทท 
TryGetValue
ทท #
(
ทท# $
gameName
ทท$ ,
,
ทท, -
out
ทท. 1

Dictionary
ทท2 <
<
ทท< =
ILobbyClient
ทท= I
,
ททI J
string
ททK Q
>
ททQ R
_members
ททS [
)
ทท[ \
)
ทท\ ]
return
ธธ 
;
ธธ 
foreach
บบ 
(
บบ 
var
บบ 
other
บบ 
in
บบ !
_members
บบ" *
.
บบ* +
Keys
บบ+ /
)
บบ/ 0
{
ปป 
if
ผผ 
(
ผผ 
other
ผผ 
==
ผผ 

connection
ผผ '
)
ผผ' (
continue
ฝฝ 
;
ฝฝ 
other
พพ 
.
พพ 
SomeoneLeftGame
พพ %
(
พพ% &
memberWhoLeft
พพ& 3
)
พพ3 4
;
พพ4 5
}
ฟฟ 
}
ภภ 	
public
ยย 
void
ยย 

KickPlayer
ยย 
(
ยย 
string
ยย %
username
ยย& .
,
ยย. /
string
ยย0 6
gameName
ยย7 ?
)
ยย? @
{
รร 	
var
ฤฤ 

connection
ฤฤ 
=
ฤฤ 
OperationContext
ฤฤ -
.
ฤฤ- .
Current
ฤฤ. 5
.
ฤฤ5 6 
GetCallbackChannel
ฤฤ6 H
<
ฤฤH I
ILobbyClient
ฤฤI U
>
ฤฤU V
(
ฤฤV W
)
ฤฤW X
;
ฤฤX Y
if
ลล 
(
ลล 
!
ลล 
_games
ลล 
.
ลล 
TryGetValue
ลล #
(
ลล# $
gameName
ลล$ ,
,
ลล, -
out
ลล. 1

Dictionary
ลล2 <
<
ลล< =
ILobbyClient
ลล= I
,
ลลI J
string
ลลK Q
>
ลลQ R
_members
ลลS [
)
ลล[ \
)
ลล\ ]
return
ฦฦ 
;
ฦฦ 
bool
วว 
	kickedOut
วว 
=
วว 
true
วว !
;
วว! "
foreach
ศศ 
(
ศศ 
var
ศศ 
other
ศศ 
in
ศศ !
_members
ศศ" *
.
ศศ* +
Keys
ศศ+ /
)
ศศ/ 0
{
ษษ 
if
สส 
(
สส 
other
สส 
==
สส 

connection
สส '
)
สส' (
continue
หห 
;
หห 
if
ฬฬ 
(
ฬฬ 
!
ฬฬ 
_members
ฬฬ 
.
ฬฬ 
TryGetValue
ฬฬ )
(
ฬฬ) *
other
ฬฬ* /
,
ฬฬ/ 0
out
ฬฬ1 4
string
ฬฬ5 ;
member
ฬฬ< B
)
ฬฬB C
)
ฬฬC D
return
ออ 
;
ออ 
if
ฮฮ 
(
ฮฮ 
member
ฮฮ 
==
ฮฮ 
username
ฮฮ &
)
ฮฮ& '
{
ฯฯ 
other
ะะ 
.
ะะ 
	LeaveGame
ะะ #
(
ะะ# $
	kickedOut
ะะ$ -
)
ะะ- .
;
ะะ. /
break
ัั 
;
ัั 
}
าา 
}
ำำ 
}
ิิ 	
public
ึึ 
void
ึึ 
	StartGame
ึึ 
(
ึึ 
string
ึึ $
gameName
ึึ% -
)
ึึ- .
{
ืื 	
try
ุุ 
{
ูู 
using
ฺฺ 
(
ฺฺ 
DominoContext
ฺฺ $
context
ฺฺ% ,
=
ฺฺ- .
new
ฺฺ/ 2
DominoContext
ฺฺ3 @
(
ฺฺ@ A
)
ฺฺA B
)
ฺฺB C
{
 
if
 
(
 
!
 
_games
 
.
  
TryGetValue
  +
(
+ ,
gameName
, 4
,
4 5
out
6 9

Dictionary
: D
<
D E
ILobbyClient
E Q
,
Q R
string
S Y
>
Y Z
_members
[ c
)
c d
)
d e
return
 
;
 
var
฿฿ 
game
฿฿ 
=
฿฿ 
new
฿฿ "
Juego
฿฿# (
{
เเ "
Condiciรณndevictoria
แแ +
=
แแ, -
$str
แแ. :
,
แแ: ;
	Duraciรณn
โโ  
=
โโ! "
null
โโ# '
,
โโ' (
Ganador
ใใ 
=
ใใ  !
null
ใใ" &
,
ใใ& '
}
ไไ 
;
ไไ 
context
ๅๅ 
.
ๅๅ 
Juego
ๅๅ !
.
ๅๅ! "
Add
ๅๅ" %
(
ๅๅ% &
game
ๅๅ& *
)
ๅๅ* +
;
ๅๅ+ ,
context
ๆๆ 
.
ๆๆ 
SaveChanges
ๆๆ '
(
ๆๆ' (
)
ๆๆ( )
;
ๆๆ) *
var
่่ 
round
่่ 
=
่่ 
new
่่  #
Ronda
่่$ )
{
้้ 
Ganador
๊๊ 
=
๊๊  !
null
๊๊" &
,
๊๊& '
Juego
๋๋ 
=
๋๋ 
game
๋๋  $
}
์์ 
;
์์ 
context
ํํ 
.
ํํ 
Ronda
ํํ !
.
ํํ! "
Add
ํํ" %
(
ํํ% &
round
ํํ& +
)
ํํ+ ,
;
ํํ, -
context
๎๎ 
.
๎๎ 
SaveChanges
๎๎ '
(
๎๎' (
)
๎๎( )
;
๎๎) *
foreach
๐๐ 
(
๐๐ 
var
๐๐  
other
๐๐! &
in
๐๐' )
_members
๐๐* 2
.
๐๐2 3
Keys
๐๐3 7
)
๐๐7 8
{
๑๑ 
if
๒๒ 
(
๒๒ 
!
๒๒ 
_members
๒๒ %
.
๒๒% &
TryGetValue
๒๒& 1
(
๒๒1 2
other
๒๒2 7
,
๒๒7 8
out
๒๒9 <
string
๒๒= C
username
๒๒D L
)
๒๒L M
)
๒๒M N
return
๓๓ "
;
๓๓" #
var
๔๔ 
user
๔๔  
=
๔๔! "
context
๔๔# *
.
๔๔* +
Usuario
๔๔+ 2
.
๔๔2 3
FirstOrDefault
๔๔3 A
(
๔๔A B
u
๔๔B C
=>
๔๔D F
u
๔๔G H
.
๔๔H I
Nombreusuario
๔๔I V
==
๔๔W Y
username
๔๔Z b
)
๔๔b c
;
๔๔c d
var
๕๕ 
player
๕๕ "
=
๕๕# $
new
๕๕% (
Jugador
๕๕) 0
{
๖๖ 
Puntaje
๗๗ #
=
๗๗$ %
$num
๗๗& '
,
๗๗' (
Usuario
๘๘ #
=
๘๘$ %
user
๘๘& *
,
๘๘* +
Ronda
๙๙ !
=
๙๙" #
round
๙๙$ )
,
๙๙) *
}
๚๚ 
;
๚๚ 
context
๛๛ 
.
๛๛  
Jugador
๛๛  '
.
๛๛' (
Add
๛๛( +
(
๛๛+ ,
player
๛๛, 2
)
๛๛2 3
;
๛๛3 4
context
 
.
  
SaveChanges
  +
(
+ ,
)
, -
;
- .
other
 
.
 

StartRound
 (
(
( )
round
) .
.
. /
RondaID
/ 6
)
6 7
;
7 8
}
 

Dictionary
 
<
 
IGameClient
 *
,
* +
string
, 2
>
2 3
_membersGame
4 @
=
A B
new
C F

Dictionary
G Q
<
Q R
IGameClient
R ]
,
] ^
string
_ e
>
e f
(
f g
)
g h
;
h i
_currentGames
 !
.
! "
Add
" %
(
% &
round
& +
.
+ ,
RondaID
, 3
,
3 4
_membersGame
5 A
)
A B
;
B C
string
 
[
 
]
 
dominoes
 %
=
& '
new
( +
string
, 2
[
2 3
]
3 4
{
5 6
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
U Y
,
Y Z
$str
[ _
,
_ `
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
U Y
,
Y Z
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
7 ;
,
; <
$str
= A
,
A B
$str
7 ;
,
; <
}
= >
;
> ?
Shuffle
 
(
 
dominoes
 $
)
$ %
;
% &
	_dominoes
 
.
 
Add
 !
(
! "
round
" '
.
' (
RondaID
( /
,
/ 0
dominoes
1 9
)
9 :
;
: ;

Dictionary
 
<
 
IChatClient
 *
,
* +
string
, 2
>
2 3
_membersRoomGame
4 D
=
E F
new
G J

Dictionary
K U
<
U V
IChatClient
V a
,
a b
string
c i
>
i j
(
j k
)
k l
;
l m
_rooms
 
.
 
Add
 
(
 
round
 $
.
$ %
RondaID
% ,
,
, -
_membersRoomGame
. >
)
> ?
;
? @
_games
 
.
 
Remove
 !
(
! "
gameName
" *
)
* +
;
+ ,
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
readonly
 

Dictionary
 
<
 
int
 
,
  

Dictionary
! +
<
+ ,
IChatClient
, 7
,
7 8
string
9 ?
>
? @
>
@ A
_rooms
B H
=
I J
new
K N

Dictionary
O Y
<
Y Z
int
Z ]
,
] ^

Dictionary
_ i
<
i j
IChatClient
j u
,
u v
string
w }
>
} ~
>
~ 
( 
) 
; 
public
 
void
 
JoinChat
 
(
 
int
  
room
! %
,
% &
string
' -
username
. 6
)
6 7
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
IChatClient
I T
>
T U
(
U V
)
V W
;
W X
if
 
(
 
!
 
_rooms
 
.
 
TryGetValue
 #
(
# $
room
$ (
,
( )
out
* -
_
. /
)
/ 0
)
0 1
{
 

Dictionary
 
<
 
IChatClient
 &
,
& '
string
( .
>
. /
_membersRoom
0 <
=
= >
new
? B

Dictionary
C M
<
M N
IChatClient
N Y
,
Y Z
string
[ a
>
a b
(
b c
)
c d
;
d e
_rooms
 
.
 
Add
 
(
 
$num
 
,
 
_membersRoom
 *
)
* +
;
+ ,
}
กก 
_rooms
ขข 
[
ขข 
room
ขข 
]
ขข 
.
ขข 
Add
ขข 
(
ขข 

connection
ขข '
,
ขข' (
username
ขข) 1
)
ขข1 2
;
ขข2 3
}
ฃฃ 	
public
ฅฅ 
void
ฅฅ 
SendMessage
ฅฅ 
(
ฅฅ  
int
ฅฅ  #
room
ฅฅ$ (
,
ฅฅ( )
string
ฅฅ* 0
message
ฅฅ1 8
)
ฅฅ8 9
{
ฆฆ 	
var
งง 

connection
งง 
=
งง 
OperationContext
งง -
.
งง- .
Current
งง. 5
.
งง5 6 
GetCallbackChannel
งง6 H
<
งงH I
IChatClient
งงI T
>
งงT U
(
งงU V
)
งงV W
;
งงW X
if
จจ 
(
จจ 
!
จจ 
_rooms
จจ 
.
จจ 
TryGetValue
จจ #
(
จจ# $
room
จจ$ (
,
จจ( )
out
จจ* -

Dictionary
จจ. 8
<
จจ8 9
IChatClient
จจ9 D
,
จจD E
string
จจF L
>
จจL M
_membersRoom
จจN Z
)
จจZ [
)
จจ[ \
return
ฉฉ 
;
ฉฉ 
if
ชช 
(
ชช 
!
ชช 
_membersRoom
ชช 
.
ชช 
TryGetValue
ชช )
(
ชช) *

connection
ชช* 4
,
ชช4 5
out
ชช6 9
string
ชช: @
user
ชชA E
)
ชชE F
)
ชชF G
return
ซซ 
;
ซซ 
foreach
ญญ 
(
ญญ 
var
ญญ 
other
ญญ 
in
ญญ !
_membersRoom
ญญ" .
.
ญญ. /
Keys
ญญ/ 3
)
ญญ3 4
{
ฎฎ 
if
ฏฏ 
(
ฏฏ 
other
ฏฏ 
==
ฏฏ 

connection
ฏฏ '
)
ฏฏ' (
continue
ฐฐ 
;
ฐฐ 
other
ฑฑ 
.
ฑฑ 
ReciveMessage
ฑฑ #
(
ฑฑ# $
user
ฑฑ$ (
,
ฑฑ( )
message
ฑฑ* 1
)
ฑฑ1 2
;
ฑฑ2 3
}
ฒฒ 
}
ณณ 	
public
ตต 
bool
ตต 
ChangePassword
ตต "
(
ตต" #
string
ตต# )
username
ตต* 2
,
ตต2 3
string
ตต4 :
currentPassword
ตต; J
,
ตตJ K
string
ตตL R
newPassword
ตตS ^
)
ตต^ _
{
ถถ 	
try
ทท 
{
ธธ 
using
นน 
(
นน 
DominoContext
นน $
context
นน% ,
=
นน- .
new
นน/ 2
DominoContext
นน3 @
(
นน@ A
)
นนA B
)
นนB C
{
บบ 
var
ปป 
user
ปป 
=
ปป 
context
ปป &
.
ปป& '
Usuario
ปป' .
.
ปป. /
FirstOrDefault
ปป/ =
(
ปป= >
u
ปป> ?
=>
ปป@ B
u
ปปC D
.
ปปD E
Nombreusuario
ปปE R
==
ปปS U
username
ปปV ^
)
ปป^ _
;
ปป_ `
if
ผผ 
(
ผผ 
user
ผผ 
!=
ผผ 
null
ผผ  $
&&
ผผ% '
(
ผผ( )
user
ผผ) -
.
ผผ- .
Contraseรฑa
ผผ. 8
.
ผผ8 9
Equals
ผผ9 ?
(
ผผ? @
currentPassword
ผผ@ O
)
ผผO P
)
ผผP Q
)
ผผQ R
{
ฝฝ 
user
พพ 
.
พพ 
Contraseรฑa
พพ '
=
พพ( )
newPassword
พพ* 5
;
พพ5 6
context
ฟฟ 
.
ฟฟ  
SaveChanges
ฟฟ  +
(
ฟฟ+ ,
)
ฟฟ, -
;
ฟฟ- .
return
ภภ 
true
ภภ #
;
ภภ# $
}
มม 
}
ยย 
}
รร 
catch
ฤฤ 
{
ลล 
}
วว 
return
ศศ 
false
ศศ 
;
ศศ 
}
ษษ 	
public
หห "
ObservableCollection
หห #
<
หห# $
UsuarioPuntajes
หห$ 3
>
หห3 4
	GetScores
หห5 >
(
หห> ?
)
หห? @
{
ฬฬ 	"
ObservableCollection
ออ  
<
ออ  !
UsuarioPuntajes
ออ! 0
>
ออ0 1
scores
ออ2 8
=
ออ9 :
new
ออ; >"
ObservableCollection
ออ? S
<
ออS T
UsuarioPuntajes
ออT c
>
ออc d
(
ออd e
)
ออe f
;
ออf g
try
ฮฮ 
{
ฯฯ 
using
ะะ 
(
ะะ 
DominoContext
ะะ $
context
ะะ% ,
=
ะะ- .
new
ะะ/ 2
DominoContext
ะะ3 @
(
ะะ@ A
)
ะะA B
)
ะะB C
{
ัั 
var
าา 
usersByScore
าา $
=
าา% &
context
าา' .
.
าา. /
Usuario
าา/ 6
.
าา6 7
OrderByDescending
าา7 H
(
าาH I
p
าาI J
=>
าาK M
p
าาN O
.
าาO P
Puntajeacumulado
าาP `
)
าา` a
;
าาa b
int
ำำ 
lugar
ำำ 
=
ำำ 
$num
ำำ  !
;
ำำ! "
foreach
ิิ 
(
ิิ 
Usuario
ิิ $
user
ิิ% )
in
ิิ* ,
usersByScore
ิิ- 9
)
ิิ9 :
{
ีี 
if
ึึ 
(
ึึ 
user
ึึ  
!=
ึึ! #
null
ึึ$ (
)
ึึ( )
{
ืื 
scores
ุุ "
.
ุุ" #
Add
ุุ# &
(
ุุ& '
new
ุุ' *
UsuarioPuntajes
ุุ+ :
(
ุุ: ;
lugar
ุุ; @
,
ุุ@ A
user
ุุB F
.
ุุF G
Nombreusuario
ุุG T
,
ุุT U
user
ุุV Z
.
ุุZ [
Puntajeacumulado
ุุ[ k
)
ุุk l
)
ุุl m
;
ุุm n
}
ูู 
else
ฺฺ 
return
 "
scores
# )
;
) *
lugar
 
++
 
;
  
if
 
(
 
lugar
 !
==
" $
$num
% &
)
& '
return
฿฿ "
scores
฿฿# )
;
฿฿) *
}
เเ 
}
แแ 
}
โโ 
catch
ใใ 
(
ใใ 
	Exception
ใใ 
ex
ใใ 
)
ใใ  
{
ไไ 
throw
ๅๅ 
new
ๅๅ 
	Exception
ๅๅ #
(
ๅๅ# $
ex
ๅๅ$ &
.
ๅๅ& '
Message
ๅๅ' .
)
ๅๅ. /
;
ๅๅ/ 0
}
ๆๆ 
return
็็ 
scores
็็ 
;
็็ 
}
่่ 	
public
๊๊ 
bool
๊๊ 
RecoverPassword
๊๊ #
(
๊๊# $
string
๊๊$ *
email
๊๊+ 0
)
๊๊0 1
{
๋๋ 	
try
์์ 
{
ํํ 
using
๎๎ 
(
๎๎ 
DominoContext
๎๎ $
context
๎๎% ,
=
๎๎- .
new
๎๎/ 2
DominoContext
๎๎3 @
(
๎๎@ A
)
๎๎A B
)
๎๎B C
{
๏๏ 
var
๐๐ 
user
๐๐ 
=
๐๐ 
context
๐๐ &
.
๐๐& '
Usuario
๐๐' .
.
๐๐. /
FirstOrDefault
๐๐/ =
(
๐๐= >
u
๐๐> ?
=>
๐๐@ B
u
๐๐C D
.
๐๐D E
Correo
๐๐E K
==
๐๐L N
email
๐๐O T
)
๐๐T U
;
๐๐U V
if
๑๑ 
(
๑๑ 
user
๑๑ 
!=
๑๑ 
null
๑๑  $
)
๑๑$ %
{
๒๒ 
	SendEmail
๓๓ !
(
๓๓! "
user
๓๓" &
,
๓๓& '
false
๓๓( -
)
๓๓- .
;
๓๓. /
return
๔๔ 
true
๔๔ #
;
๔๔# $
}
๕๕ 
else
๖๖ 
return
๗๗ 
false
๗๗ $
;
๗๗$ %
}
๘๘ 
}
๙๙ 
catch
๚๚ 
(
๚๚ 
	Exception
๚๚ 
ex
๚๚ 
)
๚๚  
{
๛๛ 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
[
 	
Obsolete
	 
(
 
$str
 =
)
= >
]
> ?
public
 
bool
 
SignUp
 
(
 
string
 !
username
" *
,
* +
string
, 2
email
3 8
,
8 9
string
: @
password
A I
)
I J
{
 	
try
 
{
 
using
 
(
 
DominoContext
 $
context
% ,
=
- .
new
/ 2
DominoContext
3 @
(
@ A
)
A B
)
B C
{
 
var
 
existingUser
 $
=
% &
context
' .
.
. /
Usuario
/ 6
.
6 7
FirstOrDefault
7 E
(
E F
u
F G
=>
H J
u
K L
.
L M
Correo
M S
==
T V
email
W \
)
\ ]
;
] ^
if
 
(
 
existingUser
 $
==
% '
null
( ,
)
, -
{
 
existingUser
 $
=
% &
context
' .
.
. /
Usuario
/ 6
.
6 7
FirstOrDefault
7 E
(
E F
u
F G
=>
H J
u
K L
.
L M
Nombreusuario
M Z
==
[ ]
username
^ f
)
f g
;
g h
if
 
(
 
existingUser
 (
==
) +
null
, 0
)
0 1
{
 
password
 $
=
% &
password
' /
.
/ 0
GetHashCode
0 ;
(
; <
)
< =
.
= >
ToString
> F
(
F G
)
G H
;
H I
var
 
user
  $
=
% &
new
' *
Usuario
+ 2
{
 
Nombreusuario
  -
=
. /
username
0 8
,
8 9
Correo
  &
=
' (
email
) .
,
. /
Contraseรฑa
  *
=
+ ,
password
- 5
,
5 6
Puntajeacumulado
  0
=
1 2
$num
3 4
,
4 5
Estatus
  '
=
( )
$num
* +
,
+ ,
Token
  %
=
& '
ShortId
( /
.
/ 0
Generate
0 8
(
8 9
)
9 :
.
: ;
Trim
; ?
(
? @
)
@ A
}
 
;
 
context
 #
.
# $
Usuario
$ +
.
+ ,
Add
, /
(
/ 0
user
0 4
)
4 5
;
5 6
context
 #
.
# $
SaveChanges
$ /
(
/ 0
)
0 1
;
1 2
	SendEmail
 %
(
% &
user
& *
,
* +
true
, 0
)
0 1
;
1 2
Console
 #
.
# $
	WriteLine
$ -
(
- .
$str
. 9
+
: ;
username
< D
+
E F
$str
G t
+
u v
email
w |
)
| }
;
} ~
return
 "
true
# '
;
' (
}
 
}
 
}
กก 
}
ขข 
catch
ฃฃ 
(
ฃฃ )
DbEntityValidationException
ฃฃ .
e
ฃฃ/ 0
)
ฃฃ0 1
{
คค 
foreach
ฅฅ 
(
ฅฅ 
var
ฅฅ 
eve
ฅฅ  
in
ฅฅ! #
e
ฅฅ$ %
.
ฅฅ% &$
EntityValidationErrors
ฅฅ& <
)
ฅฅ< =
{
ฆฆ 
Console
งง 
.
งง 
	WriteLine
งง %
(
งง% &
$str
งง& t
,
งงt u
eve
จจ 
.
จจ 
Entry
จจ !
.
จจ! "
Entity
จจ" (
.
จจ( )
GetType
จจ) 0
(
จจ0 1
)
จจ1 2
.
จจ2 3
Name
จจ3 7
,
จจ7 8
eve
จจ9 <
.
จจ< =
Entry
จจ= B
.
จจB C
State
จจC H
)
จจH I
;
จจI J
foreach
ฉฉ 
(
ฉฉ 
var
ฉฉ  
ve
ฉฉ! #
in
ฉฉ$ &
eve
ฉฉ' *
.
ฉฉ* +
ValidationErrors
ฉฉ+ ;
)
ฉฉ; <
{
ชช 
Console
ซซ 
.
ซซ  
	WriteLine
ซซ  )
(
ซซ) *
$str
ซซ* O
,
ซซO P
ve
ฌฌ 
.
ฌฌ 
PropertyName
ฌฌ +
,
ฌฌ+ ,
ve
ฌฌ- /
.
ฌฌ/ 0
ErrorMessage
ฌฌ0 <
)
ฌฌ< =
;
ฌฌ= >
}
ญญ 
}
ฎฎ 
throw
ฏฏ 
;
ฏฏ 
}
ฐฐ 
return
ฑฑ 
false
ฑฑ 
;
ฑฑ 
}
ฒฒ 	
public
ดด 
bool
ดด 
VerificateUser
ดด "
(
ดด" #
string
ดด# )
username
ดด* 2
,
ดด2 3
string
ดด4 :
token
ดด; @
)
ดด@ A
{
ตต 	
try
ถถ 
{
ทท 
using
ธธ 
(
ธธ 
DominoContext
ธธ $
context
ธธ% ,
=
ธธ- .
new
ธธ/ 2
DominoContext
ธธ3 @
(
ธธ@ A
)
ธธA B
)
ธธB C
{
นน 
var
บบ 
user
บบ 
=
บบ 
context
บบ &
.
บบ& '
Usuario
บบ' .
.
บบ. /
FirstOrDefault
บบ/ =
(
บบ= >
u
บบ> ?
=>
บบ@ B
u
บบC D
.
บบD E
Nombreusuario
บบE R
==
บบS U
username
บบV ^
)
บบ^ _
;
บบ_ `
if
ปป 
(
ปป 
user
ปป 
!=
ปป 
null
ปป  $
)
ปป$ %
{
ผผ 
if
ฝฝ 
(
ฝฝ 
!
ฝฝ 

IsVerified
ฝฝ '
(
ฝฝ' (
user
ฝฝ( ,
.
ฝฝ, -
Nombreusuario
ฝฝ- :
)
ฝฝ: ;
)
ฝฝ; <
{
พพ 
if
ฟฟ 
(
ฟฟ  
user
ฟฟ  $
.
ฟฟ$ %
Token
ฟฟ% *
==
ฟฟ+ -
token
ฟฟ. 3
)
ฟฟ3 4
{
ภภ 
user
มม  $
.
มม$ %
Estatus
มม% ,
=
มม- .
$num
มม/ 0
;
มม0 1
context
ยย  '
.
ยย' (
SaveChanges
ยย( 3
(
ยย3 4
)
ยย4 5
;
ยย5 6
return
รร  &
true
รร' +
;
รร+ ,
}
ฤฤ 
else
ลล  
return
ฦฦ  &
false
ฦฦ' ,
;
ฦฦ, -
}
วว 
else
ศศ 
return
ษษ "
true
ษษ# '
;
ษษ' (
}
สส 
}
หห 
}
ฬฬ 
catch
ออ 
(
ออ 
	Exception
ออ 
ex
ออ 
)
ออ  
{
ฮฮ 
throw
ฯฯ 
new
ฯฯ 
	Exception
ฯฯ #
(
ฯฯ# $
ex
ฯฯ$ &
.
ฯฯ& '
Message
ฯฯ' .
)
ฯฯ. /
;
ฯฯ/ 0
}
ะะ 
return
ัั 
false
ัั 
;
ัั 
}
าา 	
public
ิิ 
bool
ิิ 

IsVerified
ิิ 
(
ิิ 
string
ิิ %
username
ิิ& .
)
ิิ. /
{
ีี 	
try
ึึ 
{
ืื 
using
ุุ 
(
ุุ 
DominoContext
ุุ $
context
ุุ% ,
=
ุุ- .
new
ุุ/ 2
DominoContext
ุุ3 @
(
ุุ@ A
)
ุุA B
)
ุุB C
{
ูู 
var
ฺฺ 
user
ฺฺ 
=
ฺฺ 
context
ฺฺ &
.
ฺฺ& '
Usuario
ฺฺ' .
.
ฺฺ. /
FirstOrDefault
ฺฺ/ =
(
ฺฺ= >
u
ฺฺ> ?
=>
ฺฺ@ B
u
ฺฺC D
.
ฺฺD E
Nombreusuario
ฺฺE R
==
ฺฺS U
username
ฺฺV ^
)
ฺฺ^ _
;
ฺฺ_ `
if
 
(
 
user
 
!=
 
null
  $
)
$ %
{
 
if
 
(
 
user
  
.
  !
Estatus
! (
==
) +
$num
, -
)
- .
return
 "
true
# '
;
' (
else
฿฿ 
return
เเ "
false
เเ# (
;
เเ( )
}
แแ 
}
โโ 
}
ใใ 
catch
ไไ 
(
ไไ 
	Exception
ไไ 
ex
ไไ 
)
ไไ  
{
ๅๅ 
throw
ๆๆ 
new
ๆๆ 
	Exception
ๆๆ #
(
ๆๆ# $
ex
ๆๆ$ &
.
ๆๆ& '
Message
ๆๆ' .
)
ๆๆ. /
;
ๆๆ/ 0
}
็็ 
return
่่ 
false
่่ 
;
่่ 
}
้้ 	
public
๋๋ 
string
๋๋ 
LogIn
๋๋ 
(
๋๋ 
string
๋๋ "
email
๋๋# (
,
๋๋( )
string
๋๋* 0
password
๋๋1 9
)
๋๋9 :
{
์์ 	
try
ํํ 
{
๎๎ 
using
๏๏ 
(
๏๏ 
DominoContext
๏๏ $
context
๏๏% ,
=
๏๏- .
new
๏๏/ 2
DominoContext
๏๏3 @
(
๏๏@ A
)
๏๏A B
)
๏๏B C
{
๐๐ 
var
๑๑ 
user
๑๑ 
=
๑๑ 
context
๑๑ &
.
๑๑& '
Usuario
๑๑' .
.
๑๑. /
FirstOrDefault
๑๑/ =
(
๑๑= >
u
๑๑> ?
=>
๑๑@ B
u
๑๑C D
.
๑๑D E
Correo
๑๑E K
==
๑๑L N
email
๑๑O T
)
๑๑T U
;
๑๑U V
if
๒๒ 
(
๒๒ 
user
๒๒ 
!=
๒๒ 
null
๒๒  $
)
๒๒$ %
{
๓๓ 
if
๔๔ 
(
๔๔ 
user
๔๔  
.
๔๔  !
Contraseรฑa
๔๔! +
==
๔๔, .
password
๔๔/ 7
.
๔๔7 8
GetHashCode
๔๔8 C
(
๔๔C D
)
๔๔D E
.
๔๔E F
ToString
๔๔F N
(
๔๔N O
)
๔๔O P
)
๔๔P Q
{
๕๕ 
Console
๖๖ #
.
๖๖# $
	WriteLine
๖๖$ -
(
๖๖- .
$str
๖๖. 9
+
๖๖: ;
user
๖๖< @
.
๖๖@ A
Nombreusuario
๖๖A N
+
๖๖O P
$str
๖๖Q f
)
๖๖f g
;
๖๖g h
return
๗๗ "
user
๗๗# '
.
๗๗' (
Nombreusuario
๗๗( 5
;
๗๗5 6
}
๘๘ 
}
๙๙ 
return
๚๚ 
(
๚๚ 
$str
๚๚ 
)
๚๚ 
;
๚๚  
}
๛๛ 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
private
 
void
 
	SendEmail
 
(
 
Usuario
 &
user
' +
,
+ ,
bool
- 1
isSignUp
2 :
)
: ;
{
 	
try
 
{
 
MailMessage
 
mail
  
=
! "
new
# &
MailMessage
' 2
(
2 3
)
3 4
;
4 5

SmtpClient
 

SmtpServer
 %
=
& '
new
( +

SmtpClient
, 6
(
6 7
$str
7 G
)
G H
;
H I
mail
 
.
 
From
 
=
 
new
 
MailAddress
  +
(
+ ,
$str
, G
,
G H
$str
I W
,
W X
System
Y _
.
_ `
Text
` d
.
d e
Encoding
e m
.
m n
UTF8
n r
)
r s
;
s t
mail
 
.
 
To
 
.
 
Add
 
(
 
user
  
.
  !
Correo
! '
)
' (
;
( )
if
 
(
 
isSignUp
 
)
 
{
 
mail
 
.
 
Subject
  
=
! "
$str
# C
;
C D
mail
 
.
 
Body
 
=
 
$str
  (
+
) *
user
+ /
.
/ 0
Nombreusuario
0 =
+
> ?
$str
@ z
+
{ |
user
 
.
 
Token
 "
;
" #
}
 
else
 
{
 
mail
 
.
 
Subject
  
=
! "
$str
# G
;
G H
mail
 
.
 
Body
 
=
 
$str
  (
+
) *
user
+ /
.
/ 0
Nombreusuario
0 =
+
> ?
$str@ 
+ 
user
 
.
 
Contraseรฑa
 '
+
( )
$str
* k
;
k l
}
 

SmtpServer
 
.
 
Port
 
=
  !
$num
" %
;
% &

SmtpServer
 
.
 
Credentials
 &
=
' (
new
) ,
System
- 3
.
3 4
Net
4 7
.
7 8
NetworkCredential
8 I
(
I J
$str
J e
,
e f
$str
g v
)
v w
;
w x

SmtpServer
 
.
 
	EnableSsl
 $
=
% &
true
' +
;
+ ,

SmtpServer
 
.
 
Send
 
(
  
mail
  $
)
$ %
;
% &
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
กก 
}
ขข 	
public
คค 
static
คค 
void
คค 
Shuffle
คค "
<
คค" #
T
คค# $
>
คค$ %
(
คค% &
IList
คค& +
<
คค+ ,
T
คค, -
>
คค- .
values
คค/ 5
)
คค5 6
{
ฅฅ 	
var
ฆฆ 
n
ฆฆ 
=
ฆฆ 
values
ฆฆ 
.
ฆฆ 
Count
ฆฆ  
;
ฆฆ  !
var
งง 
rnd
งง 
=
งง 
new
งง 
Random
งง  
(
งง  !
)
งง! "
;
งง" #
for
จจ 
(
จจ 
int
จจ 
i
จจ 
=
จจ 
n
จจ 
-
จจ 
$num
จจ 
;
จจ 
i
จจ  !
>
จจ" #
$num
จจ$ %
;
จจ% &
i
จจ' (
--
จจ( *
)
จจ* +
{
ฉฉ 
var
ชช 
j
ชช 
=
ชช 
rnd
ชช 
.
ชช 
Next
ชช  
(
ชช  !
$num
ชช! "
,
ชช" #
i
ชช$ %
)
ชช% &
;
ชช& '
var
ซซ 
temp
ซซ 
=
ซซ 
values
ซซ !
[
ซซ! "
i
ซซ" #
]
ซซ# $
;
ซซ$ %
values
ฌฌ 
[
ฌฌ 
i
ฌฌ 
]
ฌฌ 
=
ฌฌ 
values
ฌฌ "
[
ฌฌ" #
j
ฌฌ# $
]
ฌฌ$ %
;
ฌฌ% &
values
ญญ 
[
ญญ 
j
ญญ 
]
ญญ 
=
ญญ 
temp
ญญ  
;
ญญ  !
}
ฎฎ 
}
ฏฏ 	
}
ฐฐ 
}ฑฑ ื
>C:\Users\ricar\Documents\GitHub\domino\DominoServer\Program.cs
	namespace 	
DominoServer
 
{ 
static 

class 
Program 
{ 
static 
void 
Main 
( 
) 
{		 	
ServiceHost

 
host

 
=

 
new

 "
ServiceHost

# .
(

. /
typeof

/ 5
(

5 6
DominoService

6 C
)

C D
)

D E
;

E F
host 
. 
Open 
( 
) 
; 
Console 
. 
	WriteLine 
( 
$str 9
)9 :
;: ;
Console 
. 
ReadLine 
( 
) 
; 
host 
. 
Close 
( 
) 
; 
} 	
} 
} 