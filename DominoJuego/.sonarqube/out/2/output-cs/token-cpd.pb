พ๋
DC:\Users\ricar\Documents\GitHub\domino\DominoServer\DominoService.cs
	namespace 	
DominoServer
 
{ 
[ 
ServiceBehavior 
( 
ConcurrencyMode $
=% &
ConcurrencyMode' 6
.6 7
Single7 =
,= >
InstanceContextMode? R
=S T
InstanceContextModeU h
.h i
Singlei o
)o p
]p q
public 

partial 
class 
DominoService &
:' (
ILoginService) 6
,6 7
IMenuService8 D
,D E
IChatServiceF R
,R S
ILobbyServiceT a
,a b
IGameServicec o
{ 
readonly 

Dictionary 
< 
int 
,  

Dictionary! +
<+ ,
IGameClient, 7
,7 8
string9 ?
>? @
>@ A
_currentGamesB O
=P Q
newR U

DictionaryV `
<` a
inta d
,d e

Dictionaryf p
<p q
IGameClientq |
,| }
string	~ 
>
 
>
 
(
 
)
 
;
 
readonly 

Dictionary 
< 
int 
,  
string! '
[' (
]( )
>) *
	_dominoes+ 4
=5 6
new7 :

Dictionary; E
<E F
intF I
,I J
stringK Q
[Q R
]R S
>S T
(T U
)U V
;V W
public 
void 
JoinCurrentGame #
(# $
int$ '
idGame( .
,. /
string0 6
username7 ?
)? @
{ 	
var 

connection 
= 
OperationContext -
.- .
Current. 5
.5 6
GetCallbackChannel6 H
<H I
IGameClientI T
>T U
(U V
)V W
;W X
if 
( 
! 
_currentGames 
. 
TryGetValue *
(* +
idGame+ 1
,1 2
out3 6

Dictionary7 A
<A B
IGameClientB M
,M N
stringO U
>U V
_membersW _
)_ `
)` a
return 
; 
int 

nextMember 
= 
$num 
; 
string 
[ 
] 
members 
= 
new "
string# )
[) *
_members* 2
.2 3
Count3 8
]8 9
;9 :
foreach 
( 
var 
other 
in !
_members" *
)* +
{   
if!! 
(!! 
other!! 
.!! 
Key!! 
==!!  

connection!!! +
)!!+ ,
{"" 

nextMember## 
++##  
;##  !
continue$$ 
;$$ 
}%% 
members&& 
[&& 

nextMember&& "
]&&" #
=&&$ %
other&&& +
.&&+ ,
Value&&, 1
;&&1 2

nextMember'' 
++'' 
;'' 
other(( 
.(( 
Key(( 
.(( 
ReciveNewMember(( )
((() *
username((* 2
)((2 3
;((3 4
})) 
(** 
(** 

Dictionary** 
<** 
IGameClient** $
,**$ %
string**& ,
>**, -
)**- .
_currentGames**. ;
[**; <
idGame**< B
]**B C
)**C D
.**D E
Add**E H
(**H I

connection**I S
,**S T
username**U ]
)**] ^
;**^ _
try++ 
{,, 

connection-- 
.-- 
ReciveMembersInGame-- .
(--. /
members--/ 6
)--6 7
;--7 8
}.. 
catch// 
(// 
	Exception// 
ex// 
)//  
{00 
throw11 
new11 
FaultException11 (
(11( )
ex11) +
.11+ ,
Message11, 3
)113 4
;114 5
}22 
}33 	
public55 
void55 
GetFirstSevenTiles55 &
(55& '
int55' *
idGame55+ 1
)551 2
{66 	
var77 

connection77 
=77 
OperationContext77 -
.77- .
Current77. 5
.775 6
GetCallbackChannel776 H
<77H I
IGameClient77I T
>77T U
(77U V
)77V W
;77W X
string99 
[99 
]99 
dominoesPerPlayer99 &
=99' (
new99) ,
string99- 3
[993 4
$num994 6
]996 7
;997 8
if:: 
(:: 
!:: 
	_dominoes:: 
.:: 
TryGetValue:: &
(::& '
idGame::' -
,::- .
out::/ 2
string::3 9
[::9 :
]::: ;
dominoesInGame::< J
)::J K
)::K L
return;; 
;;; 
Array== 
.== 
Copy== 
(== 
dominoesInGame== %
,==% &
$num==' (
,==( )
dominoesPerPlayer==* ;
,==; <
$num=== >
,==> ?
$num==@ A
)==A B
;==B C
var?? 
myList?? 
=?? 
dominoesInGame?? '
.??' (
ToList??( .
(??. /
)??/ 0
;??0 1
myList@@ 
.@@ 
RemoveRange@@ 
(@@ 
$num@@  
,@@  !
$num@@" #
)@@# $
;@@$ %
dominoesInGameAA 
=AA 
myListAA #
.AA# $
ToArrayAA$ +
(AA+ ,
)AA, -
;AA- .
ShuffleCC 
(CC 
dominoesInGameCC "
)CC" #
;CC# $
	_dominoesEE 
.EE 
RemoveEE 
(EE 
idGameEE #
)EE# $
;EE$ %
	_dominoesFF 
.FF 
AddFF 
(FF 
idGameFF  
,FF  !
dominoesInGameFF" 0
)FF0 1
;FF1 2
tryHH 
{II 

connectionJJ 
.JJ 
GetDominoesJJ &
(JJ& '
dominoesPerPlayerJJ' 8
)JJ8 9
;JJ9 :
}KK 
catchLL 
(LL 
	ExceptionLL 
exLL 
)LL  
{MM 
throwNN 
newNN 
FaultExceptionNN (
(NN( )
exNN) +
.NN+ ,
MessageNN, 3
)NN3 4
;NN4 5
}OO 
}PP 	
publicRR 
voidRR 
GetPlayersNameRR "
(RR" #
intRR# &
idGameRR' -
)RR- .
{SS 	
varTT 

connectionTT 
=TT 
OperationContextTT -
.TT- .
CurrentTT. 5
.TT5 6
GetCallbackChannelTT6 H
<TTH I
IGameClientTTI T
>TTT U
(TTU V
)TTV W
;TTW X
ifVV 
(VV 
!VV 
_currentGamesVV 
.VV 
TryGetValueVV *
(VV* +
idGameVV+ 1
,VV1 2
outVV3 6

DictionaryVV7 A
<VVA B
IGameClientVVB M
,VVM N
stringVVO U
>VVU V
_membersVVW _
)VV_ `
)VV` a
returnWW 
;WW 
intYY 

nextMemberYY 
=YY 
$numYY 
;YY 
stringZZ 
[ZZ 
]ZZ 
membersZZ 
=ZZ 
newZZ "
stringZZ# )
[ZZ) *
_membersZZ* 2
.ZZ2 3
CountZZ3 8
-ZZ9 :
$numZZ; <
]ZZ< =
;ZZ= >
foreach[[ 
([[ 
var[[ 
other[[ 
in[[ !
_members[[" *
)[[* +
{\\ 
if]] 
(]] 
other]] 
.]] 
Key]] 
==]]  

connection]]! +
)]]+ ,
continue^^ 
;^^ 
members__ 
[__ 

nextMember__ "
]__" #
=__$ %
other__& +
.__+ ,
Value__, 1
;__1 2

nextMember`` 
++`` 
;`` 
}aa 
trybb 
{cc 

connectiondd 
.dd 
ReciveMembersInGamedd .
(dd. /
membersdd/ 6
)dd6 7
;dd7 8
}ee 
catchff 
(ff 
	Exceptionff 
exff 
)ff  
{gg 
throwhh 
newhh 
FaultExceptionhh (
(hh( )
exhh) +
.hh+ ,
Messagehh, 3
)hh3 4
;hh4 5
}ii 
}jj 	
publicll 
voidll 
GetHighestTilell "
(ll" #
intll# &
idGamell' -
,ll- .
stringll/ 5
hostHighestTilell6 E
)llE F
{mm 	
varnn 

connectionnn 
=nn 
OperationContextnn -
.nn- .
Currentnn. 5
.nn5 6
GetCallbackChannelnn6 H
<nnH I
IGameClientnnI T
>nnT U
(nnU V
)nnV W
;nnW X
ifoo 
(oo 
!oo 
_currentGamesoo 
.oo 
TryGetValueoo *
(oo* +
idGameoo+ 1
,oo1 2
outoo3 6

Dictionaryoo7 A
<ooA B
IGameClientooB M
,ooM N
stringooO U
>ooU V
_membersooW _
)oo_ `
)oo` a
returnpp 
;pp 
stringqq 
highestTileqq 
=qq  
nullqq! %
;qq% &
stringrr 
[rr 
]rr 
highestOfEachPlayerrr (
=rr) *
newrr+ .
stringrr/ 5
[rr5 6
$numrr6 7
]rr7 8
;rr8 9
intss 
countss 
=ss 
$numss 
;ss 
inttt 
whoIsGonnaStarttt 
=tt  !
$numtt" #
;tt# $
foreachuu 
(uu 
varuu 
otheruu 
inuu !
_membersuu" *
.uu* +
Keysuu+ /
)uu/ 0
{vv 
ifww 
(ww 
otherww 
==ww 

connectionww '
)ww' (
{xx 
highestOfEachPlayeryy '
[yy' (
countyy( -
]yy- .
=yy/ 0
hostHighestTileyy1 @
;yy@ A
countzz 
++zz 
;zz 
continue{{ 
;{{ 
}|| 
highestOfEachPlayer}} #
[}}# $
count}}$ )
]}}) *
=}}+ ,
other}}- 2
.}}2 3
SendHighestTile}}3 B
(}}B C
)}}C D
;}}D E
count~~ 
++~~ 
;~~ 
} 
for
 
(
 
int
 
i
 
=
 
$num
 
;
 
i
 
<
 
_members
  (
.
( )
Count
) .
;
. /
i
0 1
++
1 3
)
3 4
{
 
if
 
(
 
highestTile
 
==
  "
null
# '
)
' (
{
 
highestTile
 
=
  !!
highestOfEachPlayer
" 5
[
5 6
i
6 7
]
7 8
;
8 9
whoIsGonnaStart
 #
=
$ %
i
& '
;
' (
}
 
else
 
{
 
int
 
highestNumberOne
 (
=
) *
int
+ .
.
. /
Parse
/ 4
(
4 5
highestTile
5 @
.
@ A
	Substring
A J
(
J K
$num
K L
,
L M
$num
N O
)
O P
)
P Q
;
Q R
int
 
highestNumberTwo
 (
=
) *
int
+ .
.
. /
Parse
/ 4
(
4 5
highestTile
5 @
.
@ A
	Substring
A J
(
J K
$num
K L
,
L M
$num
N O
)
O P
)
P Q
;
Q R
bool
 
highestIsMule
 &
=
' (
highestNumberOne
) 9
==
: <
highestNumberTwo
= M
;
M N
int
 
	numberOne
 !
=
" #
int
$ '
.
' (
Parse
( -
(
- .!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
.
D E
	Substring
E N
(
N O
$num
O P
,
P Q
$num
R S
)
S T
)
T U
;
U V
int
 
	numberTwo
 !
=
" #
int
$ '
.
' (
Parse
( -
(
- .!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
.
D E
	Substring
E N
(
N O
$num
O P
,
P Q
$num
R S
)
S T
)
T U
;
U V
bool
 
isMule
 
=
  !
	numberOne
" +
==
, .
	numberTwo
/ 8
;
8 9
if
 
(
 
highestIsMule
 %
)
% &
{
 
if
 
(
 
isMule
 "
)
" #
{
 
if
 
(
  
	numberOne
  )
>
* +
highestNumberOne
, <
)
< =
{
 
highestTile
  +
=
, -!
highestOfEachPlayer
. A
[
A B
i
B C
]
C D
;
D E
whoIsGonnaStart
  /
=
0 1
i
2 3
;
3 4
}
 
}
 
}
 
else
 
{
 
if
 
(
 
isMule
 "
)
" #
{
 
highestTile
 '
=
( )!
highestOfEachPlayer
* =
[
= >
i
> ?
]
? @
;
@ A
whoIsGonnaStart
กก +
=
กก, -
i
กก. /
;
กก/ 0
}
ขข 
else
ฃฃ 
{
คค 
int
ฅฅ 
weight
ฅฅ  &
=
ฅฅ' (
	numberOne
ฅฅ) 2
+
ฅฅ3 4
	numberTwo
ฅฅ5 >
;
ฅฅ> ?
int
ฆฆ 
highestWeight
ฆฆ  -
=
ฆฆ. /
highestNumberOne
ฆฆ0 @
+
ฆฆA B
highestNumberTwo
ฆฆC S
;
ฆฆS T
if
งง 
(
งง  
weight
งง  &
>
งง' (
highestWeight
งง) 6
)
งง6 7
{
จจ 
highestTile
ฉฉ  +
=
ฉฉ, -!
highestOfEachPlayer
ฉฉ. A
[
ฉฉA B
i
ฉฉB C
]
ฉฉC D
;
ฉฉD E
whoIsGonnaStart
ชช  /
=
ชช0 1
i
ชช2 3
;
ชช3 4
}
ซซ 
}
ฌฌ 
}
ญญ 
}
ฎฎ 
}
ฏฏ 
count
ฐฐ 
=
ฐฐ 
$num
ฐฐ 
;
ฐฐ 
foreach
ฑฑ 
(
ฑฑ 
var
ฑฑ 
other
ฑฑ 
in
ฑฑ !
_members
ฑฑ" *
.
ฑฑ* +
Keys
ฑฑ+ /
)
ฑฑ/ 0
{
ฒฒ 
if
ณณ 
(
ณณ 
count
ณณ 
==
ณณ 
whoIsGonnaStart
ณณ ,
)
ณณ, -
{
ดด 
other
ตต 
.
ตต 

IsYourTurn
ตต $
(
ตต$ %
isFirstTurn
ตต% 0
:
ตต0 1
true
ตต2 6
)
ตต6 7
;
ตต7 8
break
ถถ 
;
ถถ 
}
ทท 
count
ธธ 
++
ธธ 
;
ธธ 
}
นน 
}
บบ 	
public
ผผ 
void
ผผ 
PutATile
ผผ 
(
ผผ 
int
ผผ  
idGame
ผผ! '
,
ผผ' (
string
ผผ) /
tile
ผผ0 4
)
ผผ4 5
{
ฝฝ 	
var
พพ 

connection
พพ 
=
พพ 
OperationContext
พพ -
.
พพ- .
Current
พพ. 5
.
พพ5 6 
GetCallbackChannel
พพ6 H
<
พพH I
IGameClient
พพI T
>
พพT U
(
พพU V
)
พพV W
;
พพW X
if
ฟฟ 
(
ฟฟ 
!
ฟฟ 
_currentGames
ฟฟ 
.
ฟฟ 
TryGetValue
ฟฟ *
(
ฟฟ* +
idGame
ฟฟ+ 1
,
ฟฟ1 2
out
ฟฟ3 6

Dictionary
ฟฟ7 A
<
ฟฟA B
IGameClient
ฟฟB M
,
ฟฟM N
string
ฟฟO U
>
ฟฟU V
_members
ฟฟW _
)
ฟฟ_ `
)
ฟฟ` a
return
ภภ 
;
ภภ 
if
มม 
(
มม 
!
มม 
_members
มม 
.
มม 
TryGetValue
มม %
(
มม% &

connection
มม& 0
,
มม0 1
out
มม2 5
string
มม6 <
whoPutTheTile
มม= J
)
มมJ K
)
มมK L
return
ยย 
;
ยย 
foreach
รร 
(
รร 
var
รร 
other
รร 
in
รร !
_members
รร" *
.
รร* +
Keys
รร+ /
)
รร/ 0
{
ฤฤ 
if
ฦฦ 
(
ฦฦ 
other
ฦฦ 
==
ฦฦ 

connection
ฦฦ '
)
ฦฦ' (
continue
วว 
;
วว 
other
ศศ 
.
ศศ 
SomeonePutATile
ศศ %
(
ศศ% &
whoPutTheTile
ศศ& 3
,
ศศ3 4
tile
ศศ5 9
)
ศศ9 :
;
ศศ: ;
}
ษษ 
}
สส 	
public
ฬฬ 
void
ฬฬ 
PassTurn
ฬฬ 
(
ฬฬ 
int
ฬฬ  
idGame
ฬฬ! '
)
ฬฬ' (
{
ออ 	
var
ฮฮ 

connection
ฮฮ 
=
ฮฮ 
OperationContext
ฮฮ -
.
ฮฮ- .
Current
ฮฮ. 5
.
ฮฮ5 6 
GetCallbackChannel
ฮฮ6 H
<
ฮฮH I
IGameClient
ฮฮI T
>
ฮฮT U
(
ฮฮU V
)
ฮฮV W
;
ฮฮW X
if
ฯฯ 
(
ฯฯ 
!
ฯฯ 
_currentGames
ฯฯ 
.
ฯฯ 
TryGetValue
ฯฯ *
(
ฯฯ* +
idGame
ฯฯ+ 1
,
ฯฯ1 2
out
ฯฯ3 6

Dictionary
ฯฯ7 A
<
ฯฯA B
IGameClient
ฯฯB M
,
ฯฯM N
string
ฯฯO U
>
ฯฯU V
_members
ฯฯW _
)
ฯฯ_ `
)
ฯฯ` a
return
ะะ 
;
ะะ 
bool
ัั 
nextTurn
ัั 
=
ัั 
false
ัั !
;
ัั! "
foreach
าา 
(
าา 
var
าา 
other
าา 
in
าา !
_members
าา" *
.
าา* +
Keys
าา+ /
)
าา/ 0
{
ำำ 
if
ิิ 
(
ิิ 
other
ิิ 
==
ิิ 

connection
ิิ '
)
ิิ' (
{
ีี 
nextTurn
ึึ 
=
ึึ 
true
ึึ #
;
ึึ# $
continue
ืื 
;
ืื 
}
ุุ 
if
ูู 
(
ูู 
nextTurn
ูู 
)
ูู 
{
ฺฺ 
other
 
.
 

IsYourTurn
 $
(
$ %
isFirstTurn
% 0
:
0 1
false
2 7
)
7 8
;
8 9
nextTurn
 
=
 
false
 $
;
$ %
}
 
}
 
if
฿฿ 
(
฿฿ 
nextTurn
฿฿ 
)
฿฿ 
_members
เเ 
.
เเ 
First
เเ 
(
เเ 
)
เเ  
.
เเ  !
Key
เเ! $
.
เเ$ %

IsYourTurn
เเ% /
(
เเ/ 0
isFirstTurn
เเ0 ;
:
เเ; <
false
เเ= B
)
เเB C
;
เเC D
}
แแ 	
public
ใใ 
void
ใใ 
TakeFromTheBank
ใใ #
(
ใใ# $
int
ใใ$ '
idGame
ใใ( .
)
ใใ. /
{
ไไ 	
var
ๅๅ 

connection
ๅๅ 
=
ๅๅ 
OperationContext
ๅๅ -
.
ๅๅ- .
Current
ๅๅ. 5
.
ๅๅ5 6 
GetCallbackChannel
ๅๅ6 H
<
ๅๅH I
IGameClient
ๅๅI T
>
ๅๅT U
(
ๅๅU V
)
ๅๅV W
;
ๅๅW X
if
ๆๆ 
(
ๆๆ 
!
ๆๆ 
	_dominoes
ๆๆ 
.
ๆๆ 
TryGetValue
ๆๆ &
(
ๆๆ& '
idGame
ๆๆ' -
,
ๆๆ- .
out
ๆๆ/ 2
string
ๆๆ3 9
[
ๆๆ9 :
]
ๆๆ: ;
dominoesInGame
ๆๆ< J
)
ๆๆJ K
)
ๆๆK L
return
็็ 
;
็็ 
string
้้ 
newTile
้้ 
=
้้ 
dominoesInGame
้้ +
[
้้+ ,
$num
้้, -
]
้้- .
;
้้. /
var
๋๋ 
myList
๋๋ 
=
๋๋ 
dominoesInGame
๋๋ '
.
๋๋' (
ToList
๋๋( .
(
๋๋. /
)
๋๋/ 0
;
๋๋0 1
myList
์์ 
.
์์ 
RemoveRange
์์ 
(
์์ 
$num
์์  
,
์์  !
$num
์์" #
)
์์# $
;
์์$ %
dominoesInGame
ํํ 
=
ํํ 
myList
ํํ #
.
ํํ# $
ToArray
ํํ$ +
(
ํํ+ ,
)
ํํ, -
;
ํํ- .
Shuffle
๏๏ 
(
๏๏ 
dominoesInGame
๏๏ "
)
๏๏" #
;
๏๏# $
	_dominoes
๑๑ 
.
๑๑ 
Remove
๑๑ 
(
๑๑ 
idGame
๑๑ #
)
๑๑# $
;
๑๑$ %
	_dominoes
๒๒ 
.
๒๒ 
Add
๒๒ 
(
๒๒ 
idGame
๒๒  
,
๒๒  !
dominoesInGame
๒๒" 0
)
๒๒0 1
;
๒๒1 2
if
๔๔ 
(
๔๔ 
!
๔๔ 
_currentGames
๔๔ 
.
๔๔ 
TryGetValue
๔๔ *
(
๔๔* +
idGame
๔๔+ 1
,
๔๔1 2
out
๔๔3 6

Dictionary
๔๔7 A
<
๔๔A B
IGameClient
๔๔B M
,
๔๔M N
string
๔๔O U
>
๔๔U V
_members
๔๔W _
)
๔๔_ `
)
๔๔` a
return
๕๕ 
;
๕๕ 
if
๖๖ 
(
๖๖ 
!
๖๖ 
_members
๖๖ 
.
๖๖ 
TryGetValue
๖๖ %
(
๖๖% &

connection
๖๖& 0
,
๖๖0 1
out
๖๖2 5
string
๖๖6 <
whoTookTheTile
๖๖= K
)
๖๖K L
)
๖๖L M
return
๗๗ 
;
๗๗ 
foreach
๘๘ 
(
๘๘ 
var
๘๘ 
other
๘๘ 
in
๘๘ !
_members
๘๘" *
)
๘๘* +
{
๙๙ 
if
๚๚ 
(
๚๚ 
other
๚๚ 
.
๚๚ 
Key
๚๚ 
==
๚๚  

connection
๚๚! +
)
๚๚+ ,
continue
๛๛ 
;
๛๛ 
other
 
.
 
Key
 
.
 
SomeoneTookATile
 *
(
* +
whoTookTheTile
+ 9
)
9 :
;
: ;
}
 
try
 
{
 

connection
 
.
 

GetTheTile
 %
(
% &
newTile
& -
)
- .
;
. /
}
 
catch
 
(
 &
IndexOutOfRangeException
 +
ex
, .
)
. /
{
 
throw
 
new
 
FaultException
 (
(
( )
ex
) +
.
+ ,
Message
, 3
)
3 4
;
4 5
}
 
}
 	
public
 
void
 
Win
 
(
 
int
 
idGame
 "
)
" #
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
IGameClient
I T
>
T U
(
U V
)
V W
;
W X
if
 
(
 
!
 
_currentGames
 
.
 
TryGetValue
 *
(
* +
idGame
+ 1
,
1 2
out
3 6

Dictionary
7 A
<
A B
IGameClient
B M
,
M N
string
O U
>
U V
_members
W _
)
_ `
)
` a
return
 
;
 
if
 
(
 
!
 
_members
 
.
 
TryGetValue
 %
(
% &

connection
& 0
,
0 1
out
2 5
string
6 <
	theWinner
= F
)
F G
)
G H
return
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
)
* +
{
 
if
 
(
 
other
 
.
 
Key
 
==
  

connection
! +
)
+ ,
continue
 
;
 
other
 
.
 
Key
 
.
  
SomeoneWonTheRound
 ,
(
, -
	theWinner
- 6
)
6 7
;
7 8
}
 
try
 
{
 
using
 
(
 
DominoContext
 $
context
% ,
=
- .
new
/ 2
DominoContext
3 @
(
@ A
)
A B
)
B C
{
 
var
 
round
 
=
 
context
  '
.
' (
Ronda
( -
.
- .
FirstOrDefault
. <
(
< =
r
= >
=>
? A
r
B C
.
C D
RondaID
D K
==
L N
idGame
O U
)
U V
;
V W
round
 
.
 
Ganador
 !
=
" #
	theWinner
$ -
;
- .
var
 
game
 
=
 
round
 $
.
$ %
Juego
% *
;
* +
game
 
.
 
Ganador
  
=
! "
	theWinner
# ,
;
, -
context
 
.
 
SaveChanges
 '
(
' (
)
( )
;
) *
}
 
}
กก 
catch
ขข 
(
ขข 
	Exception
ขข 
ex
ขข 
)
ขข  
{
ฃฃ 
throw
คค 
new
คค 
	Exception
คค #
(
คค# $
ex
คค$ &
.
คค& '
Message
คค' .
)
คค. /
;
คค/ 0
}
ฅฅ 
}
ฆฆ 	
public
จจ 
void
จจ 
UploadPoints
จจ  
(
จจ  !
int
จจ! $
idGame
จจ% +
,
จจ+ ,
int
จจ- 0
points
จจ1 7
)
จจ7 8
{
ฉฉ 	
var
ชช 

connection
ชช 
=
ชช 
OperationContext
ชช -
.
ชช- .
Current
ชช. 5
.
ชช5 6 
GetCallbackChannel
ชช6 H
<
ชชH I
IGameClient
ชชI T
>
ชชT U
(
ชชU V
)
ชชV W
;
ชชW X
if
ซซ 
(
ซซ 
!
ซซ 
_currentGames
ซซ 
.
ซซ 
TryGetValue
ซซ *
(
ซซ* +
idGame
ซซ+ 1
,
ซซ1 2
out
ซซ3 6

Dictionary
ซซ7 A
<
ซซA B
IGameClient
ซซB M
,
ซซM N
string
ซซO U
>
ซซU V
_members
ซซW _
)
ซซ_ `
)
ซซ` a
return
ฌฌ 
;
ฌฌ 
if
ญญ 
(
ญญ 
!
ญญ 
_members
ญญ 
.
ญญ 
TryGetValue
ญญ %
(
ญญ% &

connection
ญญ& 0
,
ญญ0 1
out
ญญ2 5
string
ญญ6 <
username
ญญ= E
)
ญญE F
)
ญญF G
return
ฎฎ 
;
ฎฎ 
try
ฏฏ 
{
ฐฐ 
using
ฑฑ 
(
ฑฑ 
DominoContext
ฑฑ $
context
ฑฑ% ,
=
ฑฑ- .
new
ฑฑ/ 2
DominoContext
ฑฑ3 @
(
ฑฑ@ A
)
ฑฑA B
)
ฑฑB C
{
ฒฒ 
var
ณณ 
player
ณณ 
=
ณณ  
context
ณณ! (
.
ณณ( )
Jugador
ณณ) 0
.
ณณ0 1
FirstOrDefault
ณณ1 ?
(
ณณ? @
p
ณณ@ A
=>
ณณB D
p
ณณE F
.
ณณF G
RondaID
ณณG N
==
ณณO Q
idGame
ณณR X
&&
ณณY [
p
ณณ\ ]
.
ณณ] ^
Usuario
ณณ^ e
.
ณณe f
Nombreusuario
ณณf s
==
ณณt v
username
ณณw 
)ณณ 
;ณณ 
player
ดด 
.
ดด 
Puntaje
ดด "
=
ดด# $
points
ดด% +
;
ดด+ ,
var
ตต 
user
ตต 
=
ตต 
player
ตต %
.
ตต% &
Usuario
ตต& -
;
ตต- .
user
ถถ 
.
ถถ 
Puntajeacumulado
ถถ )
+=
ถถ* ,
points
ถถ- 3
;
ถถ3 4
context
ทท 
.
ทท 
SaveChanges
ทท '
(
ทท' (
)
ทท( )
;
ทท) *
}
ธธ 
_members
นน 
.
นน 
Remove
นน 
(
นน  

connection
นน  *
)
นน* +
;
นน+ ,
if
บบ 
(
บบ 
_members
บบ 
.
บบ 
Count
บบ "
==
บบ# %
$num
บบ& '
)
บบ' (
{
ปป 
_rooms
ผผ 
.
ผผ 
Remove
ผผ !
(
ผผ! "
idGame
ผผ" (
)
ผผ( )
;
ผผ) *
_currentGames
ฝฝ !
.
ฝฝ! "
Remove
ฝฝ" (
(
ฝฝ( )
idGame
ฝฝ) /
)
ฝฝ/ 0
;
ฝฝ0 1
	_dominoes
พพ 
.
พพ 
Remove
พพ $
(
พพ$ %
idGame
พพ% +
)
พพ+ ,
;
พพ, -
}
ฟฟ 
}
ภภ 
catch
มม 
(
มม 
	Exception
มม 
ex
มม 
)
มม  
{
ยย 
throw
รร 
new
รร 
	Exception
รร #
(
รร# $
ex
รร$ &
.
รร& '
Message
รร' .
)
รร. /
;
รร/ 0
}
ฤฤ 
}
ลล 	
readonly
วว 

Dictionary
วว 
<
วว 
ILobbyClient
วว (
,
วว( )
string
วว* 0
>
วว0 1
_lobbies
วว2 :
=
วว; <
new
วว= @

Dictionary
ววA K
<
ววK L
ILobbyClient
ววL X
,
ววX Y
string
ววZ `
>
วว` a
(
ววa b
)
ววb c
;
ววc d
public
ศศ 
void
ศศ 
	JoinLobby
ศศ 
(
ศศ 
string
ศศ $
username
ศศ% -
)
ศศ- .
{
ษษ 	
var
สส 

connection
สส 
=
สส 
OperationContext
สส -
.
สส- .
Current
สส. 5
.
สส5 6 
GetCallbackChannel
สส6 H
<
สสH I
ILobbyClient
สสI U
>
สสU V
(
สสV W
)
สสW X
;
สสX Y
_lobbies
หห 
[
หห 

connection
หห 
]
หห  
=
หห! "
username
หห# +
;
หห+ ,
}
ฬฬ 	
public
ฮฮ 
void
ฮฮ 
GetGames
ฮฮ 
(
ฮฮ 
)
ฮฮ 
{
ฯฯ 	
var
ะะ 

connection
ะะ 
=
ะะ 
OperationContext
ะะ -
.
ะะ- .
Current
ะะ. 5
.
ะะ5 6 
GetCallbackChannel
ะะ6 H
<
ะะH I
ILobbyClient
ะะI U
>
ะะU V
(
ะะV W
)
ะะW X
;
ะะX Y
foreach
ัั 
(
ัั 
var
ัั 
other
ัั 
in
ัั !
_games
ัั" (
.
ัั( )
Keys
ัั) -
)
ัั- .
{
าา 

connection
ำำ 
.
ำำ 

ReciveGame
ำำ %
(
ำำ% &
other
ำำ& +
)
ำำ+ ,
;
ำำ, -
}
ิิ 
}
ีี 	
readonly
ืื 

Dictionary
ืื 
<
ืื 
string
ืื "
,
ืื" #

Dictionary
ืื$ .
<
ืื. /
ILobbyClient
ืื/ ;
,
ืื; <
string
ืื= C
>
ืืC D
>
ืืD E
_games
ืืF L
=
ืืM N
new
ืืO R

Dictionary
ืืS ]
<
ืื] ^
string
ืื^ d
,
ืืd e

Dictionary
ืืf p
<
ืืp q
ILobbyClient
ืืq }
,
ืื} ~
stringืื 
>ืื 
>ืื 
(ืื 
)ืื 
;ืื 
public
ุุ 
void
ุุ 

CreateGame
ุุ 
(
ุุ 
string
ุุ %
gameName
ุุ& .
)
ุุ. /
{
ูู 	
var
ฺฺ 

connection
ฺฺ 
=
ฺฺ 
OperationContext
ฺฺ -
.
ฺฺ- .
Current
ฺฺ. 5
.
ฺฺ5 6 
GetCallbackChannel
ฺฺ6 H
<
ฺฺH I
ILobbyClient
ฺฺI U
>
ฺฺU V
(
ฺฺV W
)
ฺฺW X
;
ฺฺX Y

Dictionary
 
<
 
ILobbyClient
 #
,
# $
string
% +
>
+ ,
_members
- 5
=
6 7
new
8 ;

Dictionary
< F
<
F G
ILobbyClient
G S
,
S T
string
U [
>
[ \
(
\ ]
)
] ^
;
^ _
_games
 
.
 
Add
 
(
 
gameName
 
,
  
_members
! )
)
) *
;
* +
if
 
(
 
!
 
_lobbies
 
.
 
TryGetValue
 %
(
% &

connection
& 0
,
0 1
out
2 5
string
6 <
host
= A
)
A B
)
B C
return
฿฿ 
;
฿฿ 
(
แแ 
(
แแ 

Dictionary
แแ 
<
แแ 
ILobbyClient
แแ %
,
แแ% &
string
แแ' -
>
แแ- .
)
แแ. /
_games
แแ/ 5
[
แแ5 6
gameName
แแ6 >
]
แแ> ?
)
แแ? @
.
แแ@ A
Add
แแA D
(
แแD E

connection
แแE O
,
แแO P
host
แแQ U
)
แแU V
;
แแV W
foreach
ใใ 
(
ใใ 
var
ใใ 
other
ใใ 
in
ใใ !
_lobbies
ใใ" *
.
ใใ* +
Keys
ใใ+ /
)
ใใ/ 0
{
ไไ 
if
ๅๅ 
(
ๅๅ 
other
ๅๅ 
==
ๅๅ 

connection
ๅๅ '
)
ๅๅ' (
continue
ๆๆ 
;
ๆๆ 
other
็็ 
.
็็ 

ReciveGame
็็  
(
็็  !
gameName
็็! )
)
็็) *
;
็็* +
}
่่ 
}
้้ 	
public
๋๋ 
void
๋๋ 
JoinGame
๋๋ 
(
๋๋ 
string
๋๋ #
gameName
๋๋$ ,
)
๋๋, -
{
์์ 	
var
ํํ 

connection
ํํ 
=
ํํ 
OperationContext
ํํ -
.
ํํ- .
Current
ํํ. 5
.
ํํ5 6 
GetCallbackChannel
ํํ6 H
<
ํํH I
ILobbyClient
ํํI U
>
ํํU V
(
ํํV W
)
ํํW X
;
ํํX Y
if
๎๎ 
(
๎๎ 
!
๎๎ 
_lobbies
๎๎ 
.
๎๎ 
TryGetValue
๎๎ %
(
๎๎% &

connection
๎๎& 0
,
๎๎0 1
out
๎๎2 5
string
๎๎6 <
	newMember
๎๎= F
)
๎๎F G
)
๎๎G H
return
๏๏ 
;
๏๏ 
if
๑๑ 
(
๑๑ 
!
๑๑ 
_games
๑๑ 
.
๑๑ 
TryGetValue
๑๑ #
(
๑๑# $
gameName
๑๑$ ,
,
๑๑, -
out
๑๑. 1

Dictionary
๑๑2 <
<
๑๑< =
ILobbyClient
๑๑= I
,
๑๑I J
string
๑๑K Q
>
๑๑Q R
_members
๑๑S [
)
๑๑[ \
)
๑๑\ ]
return
๒๒ 
;
๒๒ 
int
๔๔ 
numberOfPlayers
๔๔ 
=
๔๔  !
$num
๔๔" #
;
๔๔# $
bool
๕๕ 
canEnter
๕๕ 
=
๕๕ 
false
๕๕ !
;
๕๕! "
foreach
๗๗ 
(
๗๗ 
var
๗๗ 
other
๗๗ 
in
๗๗ !
_members
๗๗" *
.
๗๗* +
Keys
๗๗+ /
)
๗๗/ 0
{
๘๘ 
other
๙๙ 
.
๙๙ !
SendNumberOfPlayers
๙๙ )
(
๙๙) *
out
๙๙* -
numberOfPlayers
๙๙. =
)
๙๙= >
;
๙๙> ?
if
๚๚ 
(
๚๚ 
numberOfPlayers
๚๚ #
!=
๚๚$ &
$num
๚๚' (
)
๚๚( )
break
๛๛ 
;
๛๛ 
}
 
if
 
(
 
numberOfPlayers
 
>
  !
_members
" *
.
* +
Count
+ 0
)
0 1
canEnter
 
=
 
true
 
;
  
if
 
(
 
canEnter
 
)
 
{
 
int
 

nextMember
 
=
  
$num
! "
;
" #
string
 
[
 
]
 
members
  
=
! "
new
# &
string
' -
[
- .
_members
. 6
.
6 7
Count
7 <
]
< =
;
= >
foreach
 
(
 
var
 
other
 "
in
# %
_members
& .
.
. /
Keys
/ 3
)
3 4
{
 
if
 
(
 
other
 
==
  

connection
! +
)
+ ,
continue
  
;
  !
members
 
[
 

nextMember
 &
]
& '
=
( )
other
* /
.
/ 0
SendUsername
0 <
(
< =
)
= >
;
> ?

nextMember
 
++
  
;
  !
other
 
.
 
ReciveMember
 &
(
& '
	newMember
' 0
)
0 1
;
1 2
}
 
(
 
(
 

Dictionary
 
<
 
ILobbyClient
 )
,
) *
string
+ 1
>
1 2
)
2 3
_games
3 9
[
9 :
gameName
: B
]
B C
)
C D
.
D E
Add
E H
(
H I

connection
I S
,
S T
	newMember
U ^
)
^ _
;
_ `

connection
 
.
 
ReciveMembers
 (
(
( )
members
) 0
)
0 1
;
1 2
}
 
else
 

connection
 
.
 
GameFull
 #
(
# $
)
$ %
;
% &
}
 	
public
 
void
 
	BreakGame
 
(
 
string
 $
gameName
% -
)
- .
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
ILobbyClient
I U
>
U V
(
V W
)
W X
;
X Y
if
 
(
 
!
 
_games
 
.
 
TryGetValue
 #
(
# $
gameName
$ ,
,
, -
out
. 1

Dictionary
2 <
<
< =
ILobbyClient
= I
,
I J
string
K Q
>
Q R
_members
S [
)
[ \
)
\ ]
return
 
;
 
foreach
 
(
 
var
 
other
 
in
 !
_members
" *
.
* +
Keys
+ /
)
/ 0
{
 
if
 
(
 
other
 
==
 

connection
 '
)
' (
continue
 
;
 
bool
 
	kickedOut
 
=
  
false
! &
;
& '
other
 
.
 
	LeaveGame
 
(
  
	kickedOut
  )
)
) *
;
* +
}
กก 
_games
ฃฃ 
.
ฃฃ 
Remove
ฃฃ 
(
ฃฃ 
gameName
ฃฃ "
)
ฃฃ" #
;
ฃฃ# $
foreach
ฅฅ 
(
ฅฅ 
var
ฅฅ 
other
ฅฅ 
in
ฅฅ !
_lobbies
ฅฅ" *
.
ฅฅ* +
Keys
ฅฅ+ /
)
ฅฅ/ 0
{
ฆฆ 
if
งง 
(
งง 
other
งง 
==
งง 

connection
งง '
)
งง' (
continue
จจ 
;
จจ 
other
ฉฉ 
.
ฉฉ 
UpdateGames
ฉฉ !
(
ฉฉ! "
)
ฉฉ" #
;
ฉฉ# $
}
ชช 
}
ซซ 	
public
ญญ 
void
ญญ 
MemberLeftGame
ญญ "
(
ญญ" #
string
ญญ# )
gameName
ญญ* 2
)
ญญ2 3
{
ฎฎ 	
var
ฏฏ 

connection
ฏฏ 
=
ฏฏ 
OperationContext
ฏฏ -
.
ฏฏ- .
Current
ฏฏ. 5
.
ฏฏ5 6 
GetCallbackChannel
ฏฏ6 H
<
ฏฏH I
ILobbyClient
ฏฏI U
>
ฏฏU V
(
ฏฏV W
)
ฏฏW X
;
ฏฏX Y
if
ฐฐ 
(
ฐฐ 
!
ฐฐ 
_lobbies
ฐฐ 
.
ฐฐ 
TryGetValue
ฐฐ %
(
ฐฐ% &

connection
ฐฐ& 0
,
ฐฐ0 1
out
ฐฐ2 5
string
ฐฐ6 <
memberWhoLeft
ฐฐ= J
)
ฐฐJ K
)
ฐฐK L
return
ฑฑ 
;
ฑฑ 
(
ณณ 
(
ณณ 

Dictionary
ณณ 
<
ณณ 
ILobbyClient
ณณ %
,
ณณ% &
string
ณณ' -
>
ณณ- .
)
ณณ. /
_games
ณณ/ 5
[
ณณ5 6
gameName
ณณ6 >
]
ณณ> ?
)
ณณ? @
.
ณณ@ A
Remove
ณณA G
(
ณณG H

connection
ณณH R
)
ณณR S
;
ณณS T
if
ตต 
(
ตต 
!
ตต 
_games
ตต 
.
ตต 
TryGetValue
ตต #
(
ตต# $
gameName
ตต$ ,
,
ตต, -
out
ตต. 1

Dictionary
ตต2 <
<
ตต< =
ILobbyClient
ตต= I
,
ตตI J
string
ตตK Q
>
ตตQ R
_members
ตตS [
)
ตต[ \
)
ตต\ ]
return
ถถ 
;
ถถ 
foreach
ธธ 
(
ธธ 
var
ธธ 
other
ธธ 
in
ธธ !
_members
ธธ" *
.
ธธ* +
Keys
ธธ+ /
)
ธธ/ 0
{
นน 
if
บบ 
(
บบ 
other
บบ 
==
บบ 

connection
บบ '
)
บบ' (
continue
ปป 
;
ปป 
other
ผผ 
.
ผผ 
SomeoneLeftGame
ผผ %
(
ผผ% &
memberWhoLeft
ผผ& 3
)
ผผ3 4
;
ผผ4 5
}
ฝฝ 
}
พพ 	
public
ภภ 
void
ภภ 

KickPlayer
ภภ 
(
ภภ 
string
ภภ %
username
ภภ& .
,
ภภ. /
string
ภภ0 6
gameName
ภภ7 ?
)
ภภ? @
{
มม 	
var
ยย 

connection
ยย 
=
ยย 
OperationContext
ยย -
.
ยย- .
Current
ยย. 5
.
ยย5 6 
GetCallbackChannel
ยย6 H
<
ยยH I
ILobbyClient
ยยI U
>
ยยU V
(
ยยV W
)
ยยW X
;
ยยX Y
if
รร 
(
รร 
!
รร 
_games
รร 
.
รร 
TryGetValue
รร #
(
รร# $
gameName
รร$ ,
,
รร, -
out
รร. 1

Dictionary
รร2 <
<
รร< =
ILobbyClient
รร= I
,
รรI J
string
รรK Q
>
รรQ R
_members
รรS [
)
รร[ \
)
รร\ ]
return
ฤฤ 
;
ฤฤ 
bool
ลล 
	kickedOut
ลล 
=
ลล 
true
ลล !
;
ลล! "
foreach
ฦฦ 
(
ฦฦ 
var
ฦฦ 
other
ฦฦ 
in
ฦฦ !
_members
ฦฦ" *
.
ฦฦ* +
Keys
ฦฦ+ /
)
ฦฦ/ 0
{
วว 
if
ศศ 
(
ศศ 
other
ศศ 
==
ศศ 

connection
ศศ '
)
ศศ' (
continue
ษษ 
;
ษษ 
if
สส 
(
สส 
!
สส 
_members
สส 
.
สส 
TryGetValue
สส )
(
สส) *
other
สส* /
,
สส/ 0
out
สส1 4
string
สส5 ;
member
สส< B
)
สสB C
)
สสC D
return
หห 
;
หห 
if
ฬฬ 
(
ฬฬ 
member
ฬฬ 
==
ฬฬ 
username
ฬฬ &
)
ฬฬ& '
{
ออ 
other
ฮฮ 
.
ฮฮ 
	LeaveGame
ฮฮ #
(
ฮฮ# $
	kickedOut
ฮฮ$ -
)
ฮฮ- .
;
ฮฮ. /
break
ฯฯ 
;
ฯฯ 
}
ะะ 
}
ัั 
}
าา 	
public
ิิ 
void
ิิ 
	StartGame
ิิ 
(
ิิ 
string
ิิ $
gameName
ิิ% -
)
ิิ- .
{
ีี 	
try
ึึ 
{
ืื 
using
ุุ 
(
ุุ 
DominoContext
ุุ $
context
ุุ% ,
=
ุุ- .
new
ุุ/ 2
DominoContext
ุุ3 @
(
ุุ@ A
)
ุุA B
)
ุุB C
{
ูู 
if
ฺฺ 
(
ฺฺ 
!
ฺฺ 
_games
ฺฺ 
.
ฺฺ  
TryGetValue
ฺฺ  +
(
ฺฺ+ ,
gameName
ฺฺ, 4
,
ฺฺ4 5
out
ฺฺ6 9

Dictionary
ฺฺ: D
<
ฺฺD E
ILobbyClient
ฺฺE Q
,
ฺฺQ R
string
ฺฺS Y
>
ฺฺY Z
_members
ฺฺ[ c
)
ฺฺc d
)
ฺฺd e
return
 
;
 
var
 
game
 
=
 
new
 "
Juego
# (
{
 "
Condiciรณndevictoria
฿฿ +
=
฿฿, -
$str
฿฿. :
,
฿฿: ;
	Duraciรณn
เเ  
=
เเ! "
null
เเ# '
,
เเ' (
Ganador
แแ 
=
แแ  !
null
แแ" &
,
แแ& '
}
โโ 
;
โโ 
context
ใใ 
.
ใใ 
Juego
ใใ !
.
ใใ! "
Add
ใใ" %
(
ใใ% &
game
ใใ& *
)
ใใ* +
;
ใใ+ ,
context
ไไ 
.
ไไ 
SaveChanges
ไไ '
(
ไไ' (
)
ไไ( )
;
ไไ) *
var
ๆๆ 
round
ๆๆ 
=
ๆๆ 
new
ๆๆ  #
Ronda
ๆๆ$ )
{
็็ 
Ganador
่่ 
=
่่  !
null
่่" &
,
่่& '
Juego
้้ 
=
้้ 
game
้้  $
}
๊๊ 
;
๊๊ 
context
๋๋ 
.
๋๋ 
Ronda
๋๋ !
.
๋๋! "
Add
๋๋" %
(
๋๋% &
round
๋๋& +
)
๋๋+ ,
;
๋๋, -
context
์์ 
.
์์ 
SaveChanges
์์ '
(
์์' (
)
์์( )
;
์์) *
foreach
๎๎ 
(
๎๎ 
var
๎๎  
other
๎๎! &
in
๎๎' )
_members
๎๎* 2
.
๎๎2 3
Keys
๎๎3 7
)
๎๎7 8
{
๏๏ 
if
๐๐ 
(
๐๐ 
!
๐๐ 
_members
๐๐ %
.
๐๐% &
TryGetValue
๐๐& 1
(
๐๐1 2
other
๐๐2 7
,
๐๐7 8
out
๐๐9 <
string
๐๐= C
username
๐๐D L
)
๐๐L M
)
๐๐M N
return
๑๑ "
;
๑๑" #
var
๒๒ 
user
๒๒  
=
๒๒! "
context
๒๒# *
.
๒๒* +
Usuario
๒๒+ 2
.
๒๒2 3
FirstOrDefault
๒๒3 A
(
๒๒A B
u
๒๒B C
=>
๒๒D F
u
๒๒G H
.
๒๒H I
Nombreusuario
๒๒I V
==
๒๒W Y
username
๒๒Z b
)
๒๒b c
;
๒๒c d
var
๓๓ 
player
๓๓ "
=
๓๓# $
new
๓๓% (
Jugador
๓๓) 0
{
๔๔ 
Puntaje
๕๕ #
=
๕๕$ %
$num
๕๕& '
,
๕๕' (
Usuario
๖๖ #
=
๖๖$ %
user
๖๖& *
,
๖๖* +
Ronda
๗๗ !
=
๗๗" #
round
๗๗$ )
,
๗๗) *
}
๘๘ 
;
๘๘ 
context
๙๙ 
.
๙๙  
Jugador
๙๙  '
.
๙๙' (
Add
๙๙( +
(
๙๙+ ,
player
๙๙, 2
)
๙๙2 3
;
๙๙3 4
context
๚๚ 
.
๚๚  
SaveChanges
๚๚  +
(
๚๚+ ,
)
๚๚, -
;
๚๚- .
other
 
.
 

StartRound
 (
(
( )
round
) .
.
. /
RondaID
/ 6
)
6 7
;
7 8
}
 

Dictionary
 
<
 
IGameClient
 *
,
* +
string
, 2
>
2 3
_membersGame
4 @
=
A B
new
C F

Dictionary
G Q
<
Q R
IGameClient
R ]
,
] ^
string
_ e
>
e f
(
f g
)
g h
;
h i
_currentGames
 !
.
! "
Add
" %
(
% &
round
& +
.
+ ,
RondaID
, 3
,
3 4
_membersGame
5 A
)
A B
;
B C
string
 
[
 
]
 
dominoes
 %
=
& '
new
( +
string
, 2
[
2 3
]
3 4
{
5 6
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
U Y
,
Y Z
$str
[ _
,
_ `
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
U Y
,
Y Z
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
O S
,
S T
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
I M
,
M N
$str
7 ;
,
; <
$str
= A
,
A B
$str
C G
,
G H
$str
7 ;
,
; <
$str
= A
,
A B
$str
7 ;
,
; <
}
= >
;
> ?
Shuffle
 
(
 
dominoes
 $
)
$ %
;
% &
	_dominoes
 
.
 
Add
 !
(
! "
round
" '
.
' (
RondaID
( /
,
/ 0
dominoes
1 9
)
9 :
;
: ;

Dictionary
 
<
 
IChatClient
 *
,
* +
string
, 2
>
2 3
_membersRoomGame
4 D
=
E F
new
G J

Dictionary
K U
<
U V
IChatClient
V a
,
a b
string
c i
>
i j
(
j k
)
k l
;
l m
_rooms
 
.
 
Add
 
(
 
round
 $
.
$ %
RondaID
% ,
,
, -
_membersRoomGame
. >
)
> ?
;
? @
_games
 
.
 
Remove
 !
(
! "
gameName
" *
)
* +
;
+ ,
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
readonly
 

Dictionary
 
<
 
int
 
,
  

Dictionary
! +
<
+ ,
IChatClient
, 7
,
7 8
string
9 ?
>
? @
>
@ A
_rooms
B H
=
I J
new
K N

Dictionary
O Y
<
Y Z
int
Z ]
,
] ^

Dictionary
_ i
<
i j
IChatClient
j u
,
u v
string
w }
>
} ~
>
~ 
( 
) 
; 
public
 
void
 
JoinChat
 
(
 
int
  
room
! %
,
% &
string
' -
username
. 6
)
6 7
{
 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
IChatClient
I T
>
T U
(
U V
)
V W
;
W X
if
 
(
 
!
 
_rooms
 
.
 
TryGetValue
 #
(
# $
room
$ (
,
( )
out
* -
_
. /
)
/ 0
)
0 1
{
 

Dictionary
 
<
 
IChatClient
 &
,
& '
string
( .
>
. /
_membersRoom
0 <
=
= >
new
? B

Dictionary
C M
<
M N
IChatClient
N Y
,
Y Z
string
[ a
>
a b
(
b c
)
c d
;
d e
_rooms
 
.
 
Add
 
(
 
$num
 
,
 
_membersRoom
 *
)
* +
;
+ ,
}
 
(
 
(
 

Dictionary
 
<
 
IChatClient
 $
,
$ %
string
& ,
>
, -
)
- .
_rooms
. 4
[
4 5
room
5 9
]
9 :
)
: ;
.
; <
Add
< ?
(
? @

connection
@ J
,
J K
username
L T
)
T U
;
U V
}
กก 	
public
ฃฃ 
void
ฃฃ 
SendMessage
ฃฃ 
(
ฃฃ  
int
ฃฃ  #
room
ฃฃ$ (
,
ฃฃ( )
string
ฃฃ* 0
message
ฃฃ1 8
)
ฃฃ8 9
{
คค 	
var
ฅฅ 

connection
ฅฅ 
=
ฅฅ 
OperationContext
ฅฅ -
.
ฅฅ- .
Current
ฅฅ. 5
.
ฅฅ5 6 
GetCallbackChannel
ฅฅ6 H
<
ฅฅH I
IChatClient
ฅฅI T
>
ฅฅT U
(
ฅฅU V
)
ฅฅV W
;
ฅฅW X
if
ฆฆ 
(
ฆฆ 
!
ฆฆ 
_rooms
ฆฆ 
.
ฆฆ 
TryGetValue
ฆฆ #
(
ฆฆ# $
room
ฆฆ$ (
,
ฆฆ( )
out
ฆฆ* -

Dictionary
ฆฆ. 8
<
ฆฆ8 9
IChatClient
ฆฆ9 D
,
ฆฆD E
string
ฆฆF L
>
ฆฆL M
_membersRoom
ฆฆN Z
)
ฆฆZ [
)
ฆฆ[ \
return
งง 
;
งง 
if
จจ 
(
จจ 
!
จจ 
_membersRoom
จจ 
.
จจ 
TryGetValue
จจ )
(
จจ) *

connection
จจ* 4
,
จจ4 5
out
จจ6 9
string
จจ: @
user
จจA E
)
จจE F
)
จจF G
return
ฉฉ 
;
ฉฉ 
foreach
ซซ 
(
ซซ 
var
ซซ 
other
ซซ 
in
ซซ !
_membersRoom
ซซ" .
.
ซซ. /
Keys
ซซ/ 3
)
ซซ3 4
{
ฌฌ 
if
ญญ 
(
ญญ 
other
ญญ 
==
ญญ 

connection
ญญ '
)
ญญ' (
continue
ฎฎ 
;
ฎฎ 
other
ฏฏ 
.
ฏฏ 
ReciveMessage
ฏฏ #
(
ฏฏ# $
user
ฏฏ$ (
,
ฏฏ( )
message
ฏฏ* 1
)
ฏฏ1 2
;
ฏฏ2 3
}
ฐฐ 
}
ฑฑ 	
public
ณณ 
bool
ณณ 
ChangePassword
ณณ "
(
ณณ" #
string
ณณ# )
username
ณณ* 2
,
ณณ2 3
string
ณณ4 :
currentPassword
ณณ; J
,
ณณJ K
string
ณณL R
newPassword
ณณS ^
)
ณณ^ _
{
ดด 	
try
ตต 
{
ถถ 
using
ทท 
(
ทท 
DominoContext
ทท $
context
ทท% ,
=
ทท- .
new
ทท/ 2
DominoContext
ทท3 @
(
ทท@ A
)
ททA B
)
ททB C
{
ธธ 
var
นน 
user
นน 
=
นน 
context
นน &
.
นน& '
Usuario
นน' .
.
นน. /
FirstOrDefault
นน/ =
(
นน= >
u
นน> ?
=>
นน@ B
u
นนC D
.
นนD E
Nombreusuario
นนE R
==
นนS U
username
นนV ^
)
นน^ _
;
นน_ `
if
บบ 
(
บบ 
user
บบ 
!=
บบ 
null
บบ  $
)
บบ$ %
{
ปป 
if
ผผ 
(
ผผ 
user
ผผ  
.
ผผ  !
Contraseรฑa
ผผ! +
.
ผผ+ ,
Equals
ผผ, 2
(
ผผ2 3
currentPassword
ผผ3 B
)
ผผB C
)
ผผC D
{
ฝฝ 
user
พพ  
.
พพ  !
Contraseรฑa
พพ! +
=
พพ, -
newPassword
พพ. 9
;
พพ9 :
context
ฟฟ #
.
ฟฟ# $
SaveChanges
ฟฟ$ /
(
ฟฟ/ 0
)
ฟฟ0 1
;
ฟฟ1 2
return
ภภ "
true
ภภ# '
;
ภภ' (
}
มม 
}
ยย 
}
รร 
}
ฤฤ 
catch
ลล 
{
ฦฦ 
}
ศศ 
return
ษษ 
false
ษษ 
;
ษษ 
}
สส 	
public
ฬฬ "
ObservableCollection
ฬฬ #
<
ฬฬ# $
UsuarioPuntajes
ฬฬ$ 3
>
ฬฬ3 4
	GetScores
ฬฬ5 >
(
ฬฬ> ?
)
ฬฬ? @
{
ออ 	"
ObservableCollection
ฮฮ  
<
ฮฮ  !
UsuarioPuntajes
ฮฮ! 0
>
ฮฮ0 1
scores
ฮฮ2 8
=
ฮฮ9 :
new
ฮฮ; >"
ObservableCollection
ฮฮ? S
<
ฮฮS T
UsuarioPuntajes
ฮฮT c
>
ฮฮc d
(
ฮฮd e
)
ฮฮe f
;
ฮฮf g
try
ฯฯ 
{
ะะ 
using
ัั 
(
ัั 
DominoContext
ัั $
context
ัั% ,
=
ัั- .
new
ัั/ 2
DominoContext
ัั3 @
(
ัั@ A
)
ััA B
)
ััB C
{
าา 
var
ำำ 
usersByScore
ำำ $
=
ำำ% &
context
ำำ' .
.
ำำ. /
Usuario
ำำ/ 6
.
ำำ6 7
OrderByDescending
ำำ7 H
(
ำำH I
p
ำำI J
=>
ำำK M
p
ำำN O
.
ำำO P
Puntajeacumulado
ำำP `
)
ำำ` a
;
ำำa b
int
ิิ 
lugar
ิิ 
=
ิิ 
$num
ิิ  !
;
ิิ! "
foreach
ีี 
(
ีี 
Usuario
ีี $
user
ีี% )
in
ีี* ,
usersByScore
ีี- 9
)
ีี9 :
{
ึึ 
if
ืื 
(
ืื 
user
ืื  
!=
ืื! #
null
ืื$ (
)
ืื( )
{
ุุ 
scores
ูู "
.
ูู" #
Add
ูู# &
(
ูู& '
new
ูู' *
UsuarioPuntajes
ูู+ :
(
ูู: ;
lugar
ูู; @
,
ูู@ A
user
ููB F
.
ููF G
Nombreusuario
ููG T
,
ููT U
(
ููV W
int
ููW Z
)
ููZ [
user
ูู[ _
.
ูู_ `
Puntajeacumulado
ูู` p
)
ููp q
)
ููq r
;
ููr s
}
ฺฺ 
else
 
return
 "
scores
# )
;
) *
lugar
 
++
 
;
  
if
฿฿ 
(
฿฿ 
lugar
฿฿ !
==
฿฿" $
$num
฿฿% &
)
฿฿& '
return
เเ "
scores
เเ# )
;
เเ) *
}
แแ 
}
โโ 
}
ใใ 
catch
ไไ 
(
ไไ 
	Exception
ไไ 
ex
ไไ 
)
ไไ  
{
ๅๅ 
throw
ๆๆ 
new
ๆๆ 
	Exception
ๆๆ #
(
ๆๆ# $
ex
ๆๆ$ &
.
ๆๆ& '
Message
ๆๆ' .
)
ๆๆ. /
;
ๆๆ/ 0
}
็็ 
return
่่ 
scores
่่ 
;
่่ 
}
้้ 	
public
๋๋ 
bool
๋๋ 
RecoverPassword
๋๋ #
(
๋๋# $
string
๋๋$ *
email
๋๋+ 0
)
๋๋0 1
{
์์ 	
try
ํํ 
{
๎๎ 
using
๏๏ 
(
๏๏ 
DominoContext
๏๏ $
context
๏๏% ,
=
๏๏- .
new
๏๏/ 2
DominoContext
๏๏3 @
(
๏๏@ A
)
๏๏A B
)
๏๏B C
{
๐๐ 
var
๑๑ 
user
๑๑ 
=
๑๑ 
context
๑๑ &
.
๑๑& '
Usuario
๑๑' .
.
๑๑. /
FirstOrDefault
๑๑/ =
(
๑๑= >
u
๑๑> ?
=>
๑๑@ B
u
๑๑C D
.
๑๑D E
Correo
๑๑E K
==
๑๑L N
email
๑๑O T
)
๑๑T U
;
๑๑U V
if
๒๒ 
(
๒๒ 
user
๒๒ 
!=
๒๒ 
null
๒๒  $
)
๒๒$ %
{
๓๓ 
	SendEmail
๔๔ !
(
๔๔! "
user
๔๔" &
,
๔๔& '
false
๔๔( -
)
๔๔- .
;
๔๔. /
return
๕๕ 
true
๕๕ #
;
๕๕# $
}
๖๖ 
else
๗๗ 
return
๘๘ 
false
๘๘ $
;
๘๘$ %
}
๙๙ 
}
๚๚ 
catch
๛๛ 
(
๛๛ 
	Exception
๛๛ 
ex
๛๛ 
)
๛๛  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
[
 	
Obsolete
	 
]
 
public
 
bool
 
SignUp
 
(
 
string
 !
username
" *
,
* +
string
, 2
email
3 8
,
8 9
string
: @
password
A I
)
I J
{
 	
try
 
{
 
using
 
(
 
DominoContext
 $
context
% ,
=
- .
new
/ 2
DominoContext
3 @
(
@ A
)
A B
)
B C
{
 
var
 
existingUser
 $
=
% &
context
' .
.
. /
Usuario
/ 6
.
6 7
FirstOrDefault
7 E
(
E F
u
F G
=>
H J
u
K L
.
L M
Correo
M S
==
T V
email
W \
)
\ ]
;
] ^
if
 
(
 
existingUser
 $
==
% '
null
( ,
)
, -
{
 
existingUser
 $
=
% &
context
' .
.
. /
Usuario
/ 6
.
6 7
FirstOrDefault
7 E
(
E F
u
F G
=>
H J
u
K L
.
L M
Nombreusuario
M Z
==
[ ]
username
^ f
)
f g
;
g h
if
 
(
 
existingUser
 (
==
) +
null
, 0
)
0 1
{
 
password
 $
=
% &
password
' /
.
/ 0
GetHashCode
0 ;
(
; <
)
< =
.
= >
ToString
> F
(
F G
)
G H
;
H I
var
 
user
  $
=
% &
new
' *
Usuario
+ 2
{
 
Nombreusuario
  -
=
. /
username
0 8
,
8 9
Correo
  &
=
' (
email
) .
,
. /
Contraseรฑa
  *
=
+ ,
password
- 5
,
5 6
Puntajeacumulado
  0
=
1 2
$num
3 4
,
4 5
Estatus
  '
=
( )
$num
* +
,
+ ,
Token
  %
=
& '
ShortId
( /
.
/ 0
Generate
0 8
(
8 9
)
9 :
.
: ;
Trim
; ?
(
? @
)
@ A
}
 
;
 
context
 #
.
# $
Usuario
$ +
.
+ ,
Add
, /
(
/ 0
user
0 4
)
4 5
;
5 6
context
 #
.
# $
SaveChanges
$ /
(
/ 0
)
0 1
;
1 2
	SendEmail
 %
(
% &
user
& *
,
* +
true
, 0
)
0 1
;
1 2
Console
 #
.
# $
	WriteLine
$ -
(
- .
$str
. 9
+
: ;
username
< D
+
E F
$str
G t
+
u v
email
w |
)
| }
;
} ~
return
 "
true
# '
;
' (
}
 
}
กก 
}
ขข 
}
ฃฃ 
catch
คค 
(
คค )
DbEntityValidationException
คค .
e
คค/ 0
)
คค0 1
{
ฅฅ 
foreach
ฆฆ 
(
ฆฆ 
var
ฆฆ 
eve
ฆฆ  
in
ฆฆ! #
e
ฆฆ$ %
.
ฆฆ% &$
EntityValidationErrors
ฆฆ& <
)
ฆฆ< =
{
งง 
Console
จจ 
.
จจ 
	WriteLine
จจ %
(
จจ% &
$str
จจ& t
,
จจt u
eve
ฉฉ 
.
ฉฉ 
Entry
ฉฉ !
.
ฉฉ! "
Entity
ฉฉ" (
.
ฉฉ( )
GetType
ฉฉ) 0
(
ฉฉ0 1
)
ฉฉ1 2
.
ฉฉ2 3
Name
ฉฉ3 7
,
ฉฉ7 8
eve
ฉฉ9 <
.
ฉฉ< =
Entry
ฉฉ= B
.
ฉฉB C
State
ฉฉC H
)
ฉฉH I
;
ฉฉI J
foreach
ชช 
(
ชช 
var
ชช  
ve
ชช! #
in
ชช$ &
eve
ชช' *
.
ชช* +
ValidationErrors
ชช+ ;
)
ชช; <
{
ซซ 
Console
ฌฌ 
.
ฌฌ  
	WriteLine
ฌฌ  )
(
ฌฌ) *
$str
ฌฌ* O
,
ฌฌO P
ve
ญญ 
.
ญญ 
PropertyName
ญญ +
,
ญญ+ ,
ve
ญญ- /
.
ญญ/ 0
ErrorMessage
ญญ0 <
)
ญญ< =
;
ญญ= >
}
ฎฎ 
}
ฏฏ 
throw
ฐฐ 
;
ฐฐ 
}
ฑฑ 
return
ฒฒ 
false
ฒฒ 
;
ฒฒ 
}
ณณ 	
public
ตต 
bool
ตต 
VerificateUser
ตต "
(
ตต" #
string
ตต# )
username
ตต* 2
,
ตต2 3
string
ตต4 :
token
ตต; @
)
ตต@ A
{
ถถ 	
try
ทท 
{
ธธ 
using
นน 
(
นน 
DominoContext
นน $
context
นน% ,
=
นน- .
new
นน/ 2
DominoContext
นน3 @
(
นน@ A
)
นนA B
)
นนB C
{
บบ 
var
ปป 
user
ปป 
=
ปป 
context
ปป &
.
ปป& '
Usuario
ปป' .
.
ปป. /
FirstOrDefault
ปป/ =
(
ปป= >
u
ปป> ?
=>
ปป@ B
u
ปปC D
.
ปปD E
Nombreusuario
ปปE R
==
ปปS U
username
ปปV ^
)
ปป^ _
;
ปป_ `
if
ผผ 
(
ผผ 
user
ผผ 
!=
ผผ 
null
ผผ  $
)
ผผ$ %
{
ฝฝ 
if
พพ 
(
พพ 
!
พพ 

IsVerified
พพ '
(
พพ' (
user
พพ( ,
.
พพ, -
Nombreusuario
พพ- :
)
พพ: ;
)
พพ; <
{
ฟฟ 
if
ภภ 
(
ภภ  
user
ภภ  $
.
ภภ$ %
Token
ภภ% *
==
ภภ+ -
token
ภภ. 3
)
ภภ3 4
{
มม 
user
ยย  $
.
ยย$ %
Estatus
ยย% ,
=
ยย- .
$num
ยย/ 0
;
ยย0 1
context
รร  '
.
รร' (
SaveChanges
รร( 3
(
รร3 4
)
รร4 5
;
รร5 6
return
ฤฤ  &
true
ฤฤ' +
;
ฤฤ+ ,
}
ลล 
else
ฦฦ  
return
วว  &
false
วว' ,
;
วว, -
}
ศศ 
else
ษษ 
return
สส "
true
สส# '
;
สส' (
}
หห 
}
ฬฬ 
}
ออ 
catch
ฮฮ 
(
ฮฮ 
	Exception
ฮฮ 
ex
ฮฮ 
)
ฮฮ  
{
ฯฯ 
throw
ะะ 
new
ะะ 
	Exception
ะะ #
(
ะะ# $
ex
ะะ$ &
.
ะะ& '
Message
ะะ' .
)
ะะ. /
;
ะะ/ 0
}
ัั 
return
าา 
false
าา 
;
าา 
}
ำำ 	
public
ีี 
bool
ีี 

IsVerified
ีี 
(
ีี 
string
ีี %
username
ีี& .
)
ีี. /
{
ึึ 	
try
ืื 
{
ุุ 
using
ูู 
(
ูู 
DominoContext
ูู $
context
ูู% ,
=
ูู- .
new
ูู/ 2
DominoContext
ูู3 @
(
ูู@ A
)
ููA B
)
ููB C
{
ฺฺ 
var
 
user
 
=
 
context
 &
.
& '
Usuario
' .
.
. /
FirstOrDefault
/ =
(
= >
u
> ?
=>
@ B
u
C D
.
D E
Nombreusuario
E R
==
S U
username
V ^
)
^ _
;
_ `
if
 
(
 
user
 
!=
 
null
  $
)
$ %
{
 
if
 
(
 
user
  
.
  !
Estatus
! (
==
) +
$num
, -
)
- .
return
฿฿ "
true
฿฿# '
;
฿฿' (
else
เเ 
return
แแ "
false
แแ# (
;
แแ( )
}
โโ 
}
ใใ 
}
ไไ 
catch
ๅๅ 
(
ๅๅ 
	Exception
ๅๅ 
ex
ๅๅ 
)
ๅๅ  
{
ๆๆ 
throw
็็ 
new
็็ 
	Exception
็็ #
(
็็# $
ex
็็$ &
.
็็& '
Message
็็' .
)
็็. /
;
็็/ 0
}
่่ 
return
้้ 
false
้้ 
;
้้ 
}
๊๊ 	
public
์์ 
string
์์ 
LogIn
์์ 
(
์์ 
string
์์ "
email
์์# (
,
์์( )
string
์์* 0
password
์์1 9
)
์์9 :
{
ํํ 	
try
๎๎ 
{
๏๏ 
using
๐๐ 
(
๐๐ 
DominoContext
๐๐ $
context
๐๐% ,
=
๐๐- .
new
๐๐/ 2
DominoContext
๐๐3 @
(
๐๐@ A
)
๐๐A B
)
๐๐B C
{
๑๑ 
var
๒๒ 
user
๒๒ 
=
๒๒ 
context
๒๒ &
.
๒๒& '
Usuario
๒๒' .
.
๒๒. /
FirstOrDefault
๒๒/ =
(
๒๒= >
u
๒๒> ?
=>
๒๒@ B
u
๒๒C D
.
๒๒D E
Correo
๒๒E K
==
๒๒L N
email
๒๒O T
)
๒๒T U
;
๒๒U V
if
๓๓ 
(
๓๓ 
user
๓๓ 
!=
๓๓ 
null
๓๓  $
)
๓๓$ %
{
๔๔ 
string
๕๕ 
userPassword
๕๕ +
=
๕๕, -
user
๕๕. 2
.
๕๕2 3
Contraseรฑa
๕๕3 =
;
๕๕= >
if
๖๖ 
(
๖๖ 
user
๖๖  
.
๖๖  !
Contraseรฑa
๖๖! +
==
๖๖, .
password
๖๖/ 7
.
๖๖7 8
GetHashCode
๖๖8 C
(
๖๖C D
)
๖๖D E
.
๖๖E F
ToString
๖๖F N
(
๖๖N O
)
๖๖O P
)
๖๖P Q
{
๗๗ 
Console
๘๘ #
.
๘๘# $
	WriteLine
๘๘$ -
(
๘๘- .
$str
๘๘. 9
+
๘๘: ;
user
๘๘< @
.
๘๘@ A
Nombreusuario
๘๘A N
+
๘๘O P
$str
๘๘Q f
)
๘๘f g
;
๘๘g h
return
๙๙ "
user
๙๙# '
.
๙๙' (
Nombreusuario
๙๙( 5
;
๙๙5 6
}
๚๚ 
}
๛๛ 
return
 
(
 
$str
 
)
 
;
  
}
 
}
 
catch
 
(
 
	Exception
 
ex
 
)
  
{
 
throw
 
new
 
	Exception
 #
(
# $
ex
$ &
.
& '
Message
' .
)
. /
;
/ 0
}
 
}
 	
private
 
bool
 
	SendEmail
 
(
 
Usuario
 &
user
' +
,
+ ,
bool
- 1
isSignUp
2 :
)
: ;
{
 	
try
 
{
 
MailMessage
 
mail
  
=
! "
new
# &
MailMessage
' 2
(
2 3
)
3 4
;
4 5

SmtpClient
 

SmtpServer
 %
=
& '
new
( +

SmtpClient
, 6
(
6 7
$str
7 G
)
G H
;
H I
mail
 
.
 
From
 
=
 
new
 
MailAddress
  +
(
+ ,
$str
, G
,
G H
$str
I W
,
W X
System
Y _
.
_ `
Text
` d
.
d e
Encoding
e m
.
m n
UTF8
n r
)
r s
;
s t
mail
 
.
 
To
 
.
 
Add
 
(
 
user
  
.
  !
Correo
! '
)
' (
;
( )
if
 
(
 
isSignUp
 
)
 
{
 
mail
 
.
 
Subject
  
=
! "
$str
# C
;
C D
mail
 
.
 
Body
 
=
 
$str
  (
+
) *
user
+ /
.
/ 0
Nombreusuario
0 =
+
> ?
$str
@ z
+
{ |
user
 
.
 
Token
 "
;
" #
}
 
else
 
{
 
mail
 
.
 
Subject
  
=
! "
$str
# G
;
G H
mail
 
.
 
Body
 
=
 
$str
  (
+
) *
user
+ /
.
/ 0
Nombreusuario
0 =
+
> ?
$str@ 
+ 
user
 
.
 
Contraseรฑa
 '
+
( )
$str
* k
;
k l
}
 

SmtpServer
 
.
 
Port
 
=
  !
$num
" %
;
% &

SmtpServer
 
.
 
Credentials
 &
=
' (
new
) ,
System
- 3
.
3 4
Net
4 7
.
7 8
NetworkCredential
8 I
(
I J
$str
J e
,
e f
$str
g v
)
v w
;
w x

SmtpServer
 
.
 
	EnableSsl
 $
=
% &
true
' +
;
+ ,

SmtpServer
 
.
 
Send
 
(
  
mail
  $
)
$ %
;
% &
return
 
true
 
;
 
}
 
catch
กก 
(
กก 
	Exception
กก 
ex
กก 
)
กก  
{
ขข 
throw
ฃฃ 
new
ฃฃ 
	Exception
ฃฃ #
(
ฃฃ# $
ex
ฃฃ$ &
.
ฃฃ& '
Message
ฃฃ' .
)
ฃฃ. /
;
ฃฃ/ 0
}
คค 
}
ฅฅ 	
public
งง 
static
งง 
void
งง 
Shuffle
งง "
<
งง" #
T
งง# $
>
งง$ %
(
งง% &
IList
งง& +
<
งง+ ,
T
งง, -
>
งง- .
values
งง/ 5
)
งง5 6
{
จจ 	
var
ฉฉ 
n
ฉฉ 
=
ฉฉ 
values
ฉฉ 
.
ฉฉ 
Count
ฉฉ  
;
ฉฉ  !
var
ชช 
rnd
ชช 
=
ชช 
new
ชช 
Random
ชช  
(
ชช  !
)
ชช! "
;
ชช" #
for
ซซ 
(
ซซ 
int
ซซ 
i
ซซ 
=
ซซ 
n
ซซ 
-
ซซ 
$num
ซซ 
;
ซซ 
i
ซซ  !
>
ซซ" #
$num
ซซ$ %
;
ซซ% &
i
ซซ' (
--
ซซ( *
)
ซซ* +
{
ฌฌ 
var
ญญ 
j
ญญ 
=
ญญ 
rnd
ญญ 
.
ญญ 
Next
ญญ  
(
ญญ  !
$num
ญญ! "
,
ญญ" #
i
ญญ$ %
)
ญญ% &
;
ญญ& '
var
ฎฎ 
temp
ฎฎ 
=
ฎฎ 
values
ฎฎ !
[
ฎฎ! "
i
ฎฎ" #
]
ฎฎ# $
;
ฎฎ$ %
values
ฏฏ 
[
ฏฏ 
i
ฏฏ 
]
ฏฏ 
=
ฏฏ 
values
ฏฏ "
[
ฏฏ" #
j
ฏฏ# $
]
ฏฏ$ %
;
ฏฏ% &
values
ฐฐ 
[
ฐฐ 
j
ฐฐ 
]
ฐฐ 
=
ฐฐ 
temp
ฐฐ  
;
ฐฐ  !
}
ฑฑ 
}
ฒฒ 	
}
ณณ 
}ดด ร
>C:\Users\ricar\Documents\GitHub\domino\DominoServer\Program.cs
	namespace 	
DominoServer
 
{ 
class 	
Program
 
{ 
static 
void 
Main 
( 
) 
{		 	
ServiceHost

 
host

 
=

 
new

 "
ServiceHost

# .
(

. /
typeof

/ 5
(

5 6
DominoService

6 C
)

C D
)

D E
;

E F
host 
. 
Open 
( 
) 
; 
Console 
. 
	WriteLine 
( 
$str 9
)9 :
;: ;
Console 
. 
ReadLine 
( 
) 
; 
host 
. 
Close 
( 
) 
; 
} 	
} 
} 