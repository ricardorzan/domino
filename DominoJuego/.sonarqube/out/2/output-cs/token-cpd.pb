≠À
DC:\Users\ricar\Documents\GitHub\domino\DominoServer\DominoService.cs
	namespace 	
DominoServer
 
{ 
[ 
ServiceBehavior 
( 
ConcurrencyMode $
=% &
ConcurrencyMode' 6
.6 7
Single7 =
,= >
InstanceContextMode? R
=S T
InstanceContextModeU h
.h i
Singlei o
)o p
]p q
public 

partial 
class 
DominoService &
:' (
ILoginService) 6
,6 7
IMenuService8 D
,D E
IChatServiceF R
,R S
ILobbyServiceT a
,a b
IGameServicec o
{ 
public 
void 

JustToTest 
( 
)  
{ 	
} 	
readonly 

Dictionary 
< 
ILobbyClient (
,( )
string* 0
>0 1
_lobbies2 :
=; <
new= @

DictionaryA K
<K L
ILobbyClientL X
,X Y
stringZ `
>` a
(a b
)b c
;c d
public 
void 
	JoinLobby 
( 
string $
username% -
)- .
{ 	
var 

connection 
= 
OperationContext -
.- .
Current. 5
.5 6
GetCallbackChannel6 H
<H I
ILobbyClientI U
>U V
(V W
)W X
;X Y
_lobbies 
[ 

connection 
]  
=! "
username# +
;+ ,
} 	
public 
void 
GetGames 
( 
) 
{ 	
var 

connection 
= 
OperationContext -
.- .
Current. 5
.5 6
GetCallbackChannel6 H
<H I
ILobbyClientI U
>U V
(V W
)W X
;X Y
foreach 
( 
var 
other 
in !
_games" (
.( )
Keys) -
)- .
{   

connection!! 
.!! 

ReciveGame!! %
(!!% &
other!!& +
)!!+ ,
;!!, -
}"" 
}## 	
readonly%% 

Dictionary%% 
<%% 
string%% "
,%%" #

Dictionary%%$ .
<%%. /
ILobbyClient%%/ ;
,%%; <
string%%= C
>%%C D
>%%D E
_games%%F L
=%%M N
new%%O R

Dictionary%%S ]
<%%] ^
string%%^ d
,%%d e

Dictionary%%f p
<%%p q
ILobbyClient%%q }
,%%} ~
string	%% Ö
>
%%Ö Ü
>
%%Ü á
(
%%á à
)
%%à â
;
%%â ä
public&& 
void&& 

CreateGame&& 
(&& 
string&& %
gameName&&& .
)&&. /
{'' 	
var(( 

connection(( 
=(( 
OperationContext(( -
.((- .
Current((. 5
.((5 6
GetCallbackChannel((6 H
<((H I
ILobbyClient((I U
>((U V
(((V W
)((W X
;((X Y

Dictionary)) 
<)) 
ILobbyClient)) #
,))# $
string))% +
>))+ ,
_members))- 5
=))6 7
new))8 ;

Dictionary))< F
<))F G
ILobbyClient))G S
,))S T
string))U [
>))[ \
())\ ]
)))] ^
;))^ _
_games** 
.** 
Add** 
(** 
gameName** 
,**  
_members**! )
)**) *
;*** +
if,, 
(,, 
!,, 
_lobbies,, 
.,, 
TryGetValue,, %
(,,% &

connection,,& 0
,,,0 1
out,,2 5
string,,6 <
host,,= A
),,A B
),,B C
return-- 
;-- 
(// 
(// 

Dictionary// 
<// 
ILobbyClient// %
,//% &
string//' -
>//- .
)//. /
_games/// 5
[//5 6
gameName//6 >
]//> ?
)//? @
.//@ A
Add//A D
(//D E

connection//E O
,//O P
host//Q U
)//U V
;//V W
foreach11 
(11 
var11 
other11 
in11 !
_lobbies11" *
.11* +
Keys11+ /
)11/ 0
{22 
if33 
(33 
other33 
==33 

connection33 '
)33' (
continue44 
;44 
other55 
.55 

ReciveGame55  
(55  !
gameName55! )
)55) *
;55* +
}66 
}77 	
public99 
void99 
JoinGame99 
(99 
string99 #
gameName99$ ,
)99, -
{:: 	
var;; 

connection;; 
=;; 
OperationContext;; -
.;;- .
Current;;. 5
.;;5 6
GetCallbackChannel;;6 H
<;;H I
ILobbyClient;;I U
>;;U V
(;;V W
);;W X
;;;X Y
if<< 
(<< 
!<< 
_lobbies<< 
.<< 
TryGetValue<< %
(<<% &

connection<<& 0
,<<0 1
out<<2 5
string<<6 <
	newMember<<= F
)<<F G
)<<G H
return== 
;== 
if?? 
(?? 
!?? 
_games?? 
.?? 
TryGetValue?? #
(??# $
gameName??$ ,
,??, -
out??. 1

Dictionary??2 <
<??< =
ILobbyClient??= I
,??I J
string??K Q
>??Q R
_members??S [
)??[ \
)??\ ]
return@@ 
;@@ 
intBB 
numberOfPlayersBB 
=BB  !
$numBB" #
;BB# $
boolCC 
canEnterCC 
=CC 
falseCC !
;CC! "
foreachEE 
(EE 
varEE 
otherEE 
inEE !
_membersEE" *
.EE* +
KeysEE+ /
)EE/ 0
{FF 
otherGG 
.GG 
SendNumberOfPlayersGG )
(GG) *
outGG* -
numberOfPlayersGG. =
)GG= >
;GG> ?
ifHH 
(HH 
numberOfPlayersHH #
!=HH$ &
$numHH' (
)HH( )
breakII 
;II 
}JJ 
ifLL 
(LL 
numberOfPlayersLL 
>LL  !
_membersLL" *
.LL* +
CountLL+ 0
)LL0 1
canEnterMM 
=MM 
trueMM 
;MM  
ifOO 
(OO 
canEnterOO 
)OO 
{PP 
intQQ 

nextMemberQQ 
=QQ  
$numQQ! "
;QQ" #
stringRR 
[RR 
]RR 
membersRR  
=RR! "
newRR# &
stringRR' -
[RR- .
_membersRR. 6
.RR6 7
CountRR7 <
]RR< =
;RR= >
foreachSS 
(SS 
varSS 
otherSS "
inSS# %
_membersSS& .
.SS. /
KeysSS/ 3
)SS3 4
{TT 
ifUU 
(UU 
otherUU 
==UU  

connectionUU! +
)UU+ ,
continueVV  
;VV  !
membersWW 
[WW 

nextMemberWW &
]WW& '
=WW( )
otherWW* /
.WW/ 0
SendUsernameWW0 <
(WW< =
)WW= >
;WW> ?

nextMemberXX 
++XX  
;XX  !
otherYY 
.YY 
ReciveMemberYY &
(YY& '
	newMemberYY' 0
)YY0 1
;YY1 2
}ZZ 
([[ 
([[ 

Dictionary[[ 
<[[ 
ILobbyClient[[ )
,[[) *
string[[+ 1
>[[1 2
)[[2 3
_games[[3 9
[[[9 :
gameName[[: B
][[B C
)[[C D
.[[D E
Add[[E H
([[H I

connection[[I S
,[[S T
	newMember[[U ^
)[[^ _
;[[_ `

connection\\ 
.\\ 
ReciveMembers\\ (
(\\( )
members\\) 0
)\\0 1
;\\1 2
}]] 
else^^ 

connection__ 
.__ 
GameFull__ #
(__# $
)__$ %
;__% &
}`` 	
publicbb 
voidbb 
	BreakGamebb 
(bb 
stringbb $
gameNamebb% -
)bb- .
{cc 	
vardd 

connectiondd 
=dd 
OperationContextdd -
.dd- .
Currentdd. 5
.dd5 6
GetCallbackChanneldd6 H
<ddH I
ILobbyClientddI U
>ddU V
(ddV W
)ddW X
;ddX Y
ifff 
(ff 
!ff 
_gamesff 
.ff 
TryGetValueff #
(ff# $
gameNameff$ ,
,ff, -
outff. 1

Dictionaryff2 <
<ff< =
ILobbyClientff= I
,ffI J
stringffK Q
>ffQ R
_membersffS [
)ff[ \
)ff\ ]
returngg 
;gg 
foreachii 
(ii 
varii 
otherii 
inii !
_membersii" *
.ii* +
Keysii+ /
)ii/ 0
{jj 
ifkk 
(kk 
otherkk 
==kk 

connectionkk '
)kk' (
continuell 
;ll 
boolmm 
	kickedOutmm 
=mm  
falsemm! &
;mm& '
othernn 
.nn 
	LeaveGamenn 
(nn  
	kickedOutnn  )
)nn) *
;nn* +
}oo 
_gamesqq 
.qq 
Removeqq 
(qq 
gameNameqq "
)qq" #
;qq# $
foreachss 
(ss 
varss 
otherss 
inss !
_lobbiesss" *
.ss* +
Keysss+ /
)ss/ 0
{tt 
ifuu 
(uu 
otheruu 
==uu 

connectionuu '
)uu' (
continuevv 
;vv 
otherww 
.ww 
UpdateGamesww !
(ww! "
)ww" #
;ww# $
}xx 
}yy 	
public{{ 
void{{ 
MemberLeftGame{{ "
({{" #
string{{# )
gameName{{* 2
){{2 3
{|| 	
var}} 

connection}} 
=}} 
OperationContext}} -
.}}- .
Current}}. 5
.}}5 6
GetCallbackChannel}}6 H
<}}H I
ILobbyClient}}I U
>}}U V
(}}V W
)}}W X
;}}X Y
if~~ 
(~~ 
!~~ 
_lobbies~~ 
.~~ 
TryGetValue~~ %
(~~% &

connection~~& 0
,~~0 1
out~~2 5
string~~6 <
memberWhoLeft~~= J
)~~J K
)~~K L
return 
; 
(
ÅÅ 
(
ÅÅ 

Dictionary
ÅÅ 
<
ÅÅ 
ILobbyClient
ÅÅ %
,
ÅÅ% &
string
ÅÅ' -
>
ÅÅ- .
)
ÅÅ. /
_games
ÅÅ/ 5
[
ÅÅ5 6
gameName
ÅÅ6 >
]
ÅÅ> ?
)
ÅÅ? @
.
ÅÅ@ A
Remove
ÅÅA G
(
ÅÅG H

connection
ÅÅH R
)
ÅÅR S
;
ÅÅS T
if
ÉÉ 
(
ÉÉ 
!
ÉÉ 
_games
ÉÉ 
.
ÉÉ 
TryGetValue
ÉÉ #
(
ÉÉ# $
gameName
ÉÉ$ ,
,
ÉÉ, -
out
ÉÉ. 1

Dictionary
ÉÉ2 <
<
ÉÉ< =
ILobbyClient
ÉÉ= I
,
ÉÉI J
string
ÉÉK Q
>
ÉÉQ R
_members
ÉÉS [
)
ÉÉ[ \
)
ÉÉ\ ]
return
ÑÑ 
;
ÑÑ 
foreach
ÜÜ 
(
ÜÜ 
var
ÜÜ 
other
ÜÜ 
in
ÜÜ !
_members
ÜÜ" *
.
ÜÜ* +
Keys
ÜÜ+ /
)
ÜÜ/ 0
{
áá 
if
àà 
(
àà 
other
àà 
==
àà 

connection
àà '
)
àà' (
continue
ââ 
;
ââ 
other
ää 
.
ää 
SomeoneLeftGame
ää %
(
ää% &
memberWhoLeft
ää& 3
)
ää3 4
;
ää4 5
}
ãã 
}
åå 	
public
éé 
void
éé 

KickPlayer
éé 
(
éé 
string
éé %
username
éé& .
,
éé. /
string
éé0 6
gameName
éé7 ?
)
éé? @
{
èè 	
var
êê 

connection
êê 
=
êê 
OperationContext
êê -
.
êê- .
Current
êê. 5
.
êê5 6 
GetCallbackChannel
êê6 H
<
êêH I
ILobbyClient
êêI U
>
êêU V
(
êêV W
)
êêW X
;
êêX Y
if
ëë 
(
ëë 
!
ëë 
_games
ëë 
.
ëë 
TryGetValue
ëë #
(
ëë# $
gameName
ëë$ ,
,
ëë, -
out
ëë. 1

Dictionary
ëë2 <
<
ëë< =
ILobbyClient
ëë= I
,
ëëI J
string
ëëK Q
>
ëëQ R
_members
ëëS [
)
ëë[ \
)
ëë\ ]
return
íí 
;
íí 
bool
ìì 
	kickedOut
ìì 
=
ìì 
true
ìì !
;
ìì! "
foreach
îî 
(
îî 
var
îî 
other
îî 
in
îî !
_members
îî" *
.
îî* +
Keys
îî+ /
)
îî/ 0
{
ïï 
if
ññ 
(
ññ 
other
ññ 
==
ññ 

connection
ññ '
)
ññ' (
continue
óó 
;
óó 
if
òò 
(
òò 
!
òò 
_members
òò 
.
òò 
TryGetValue
òò )
(
òò) *
other
òò* /
,
òò/ 0
out
òò1 4
string
òò5 ;
member
òò< B
)
òòB C
)
òòC D
return
ôô 
;
ôô 
if
öö 
(
öö 
member
öö 
==
öö 
username
öö &
)
öö& '
{
õõ 
other
úú 
.
úú 
	LeaveGame
úú #
(
úú# $
	kickedOut
úú$ -
)
úú- .
;
úú. /
break
ùù 
;
ùù 
}
ûû 
}
üü 
}
†† 	
public
¢¢ 
void
¢¢ #
PlayerChangedHisReady
¢¢ )
(
¢¢) *
string
¢¢* 0
gameName
¢¢1 9
)
¢¢9 :
{
££ 	
var
§§ 

connection
§§ 
=
§§ 
OperationContext
§§ -
.
§§- .
Current
§§. 5
.
§§5 6 
GetCallbackChannel
§§6 H
<
§§H I
ILobbyClient
§§I U
>
§§U V
(
§§V W
)
§§W X
;
§§X Y
if
•• 
(
•• 
!
•• 
_lobbies
•• 
.
•• 
TryGetValue
•• %
(
••% &

connection
••& 0
,
••0 1
out
••2 5
string
••6 <&
memberWhoChangedHisReady
••= U
)
••U V
)
••V W
return
¶¶ 
;
¶¶ 
if
®® 
(
®® 
!
®® 
_games
®® 
.
®® 
TryGetValue
®® #
(
®®# $
gameName
®®$ ,
,
®®, -
out
®®. 1

Dictionary
®®2 <
<
®®< =
ILobbyClient
®®= I
,
®®I J
string
®®K Q
>
®®Q R
_members
®®S [
)
®®[ \
)
®®\ ]
return
©© 
;
©© 
foreach
´´ 
(
´´ 
var
´´ 
other
´´ 
in
´´ !
_members
´´" *
.
´´* +
Keys
´´+ /
)
´´/ 0
{
¨¨ 
if
≠≠ 
(
≠≠ 
other
≠≠ 
==
≠≠ 

connection
≠≠ '
)
≠≠' (
continue
ÆÆ 
;
ÆÆ 
other
ØØ 
.
ØØ $
SomeoneChangedHisReady
ØØ ,
(
ØØ, -&
memberWhoChangedHisReady
ØØ- E
)
ØØE F
;
ØØF G
}
∞∞ 
}
≤≤ 	
public
¥¥ 
void
¥¥ 
	StartGame
¥¥ 
(
¥¥ 
string
¥¥ $
gameName
¥¥% -
)
¥¥- .
{
µµ 	
try
∂∂ 
{
∑∑ 
using
∏∏ 
(
∏∏ 
DominoContext
∏∏ $
context
∏∏% ,
=
∏∏- .
new
∏∏/ 2
DominoContext
∏∏3 @
(
∏∏@ A
)
∏∏A B
)
∏∏B C
{
ππ 
if
∫∫ 
(
∫∫ 
!
∫∫ 
_games
∫∫ 
.
∫∫  
TryGetValue
∫∫  +
(
∫∫+ ,
gameName
∫∫, 4
,
∫∫4 5
out
∫∫6 9

Dictionary
∫∫: D
<
∫∫D E
ILobbyClient
∫∫E Q
,
∫∫Q R
string
∫∫S Y
>
∫∫Y Z
_members
∫∫[ c
)
∫∫c d
)
∫∫d e
return
ªª 
;
ªª 
var
ΩΩ 
game
ΩΩ 
=
ΩΩ 
new
ΩΩ "
Juego
ΩΩ# (
{
ææ "
Condici√≥ndevictoria
øø +
=
øø, -
$str
øø. :
,
øø: ;
	Duraci√≥n
¿¿  
=
¿¿! "
null
¿¿# '
,
¿¿' (
Ganador
¡¡ 
=
¡¡  !
null
¡¡" &
,
¡¡& '
}
¬¬ 
;
¬¬ 
context
√√ 
.
√√ 
Juego
√√ !
.
√√! "
Add
√√" %
(
√√% &
game
√√& *
)
√√* +
;
√√+ ,
context
ƒƒ 
.
ƒƒ 
SaveChanges
ƒƒ '
(
ƒƒ' (
)
ƒƒ( )
;
ƒƒ) *
var
«« 
round
«« 
=
«« 
new
««  #
Ronda
««$ )
{
»» 
Ganador
…… 
=
……  !
null
……" &
,
……& '
Valorfichaderecha
   )
=
  * +
null
  , 0
,
  0 1!
Valorfichaizquierda
ÀÀ +
=
ÀÀ, -
null
ÀÀ. 2
,
ÀÀ2 3
Juego
ÃÃ 
=
ÃÃ 
game
ÃÃ  $
,
ÃÃ$ %
}
ÕÕ 
;
ÕÕ 
context
ŒŒ 
.
ŒŒ 
Ronda
ŒŒ !
.
ŒŒ! "
Add
ŒŒ" %
(
ŒŒ% &
round
ŒŒ& +
)
ŒŒ+ ,
;
ŒŒ, -
context
œœ 
.
œœ 
SaveChanges
œœ '
(
œœ' (
)
œœ( )
;
œœ) *
foreach
““ 
(
““ 
var
““  
other
““! &
in
““' )
_members
““* 2
.
““2 3
Keys
““3 7
)
““7 8
{
”” 
if
‘‘ 
(
‘‘ 
!
‘‘ 
_members
‘‘ %
.
‘‘% &
TryGetValue
‘‘& 1
(
‘‘1 2
other
‘‘2 7
,
‘‘7 8
out
‘‘9 <
string
‘‘= C
username
‘‘D L
)
‘‘L M
)
‘‘M N
return
’’ "
;
’’" #
var
÷÷ 
user
÷÷  
=
÷÷! "
context
÷÷# *
.
÷÷* +
Usuario
÷÷+ 2
.
÷÷2 3
FirstOrDefault
÷÷3 A
(
÷÷A B
u
÷÷B C
=>
÷÷D F
u
÷÷G H
.
÷÷H I
Nombreusuario
÷÷I V
==
÷÷W Y
username
÷÷Z b
)
÷÷b c
;
÷÷c d
var
◊◊ 
player
◊◊ "
=
◊◊# $
new
◊◊% (
Jugador
◊◊) 0
{
ÿÿ 
Enturno
ŸŸ #
=
ŸŸ$ %
$num
ŸŸ& '
,
ŸŸ' (
Fichasenmano
⁄⁄ (
=
⁄⁄) *
$num
⁄⁄+ ,
,
⁄⁄, -
Puntaje
€€ #
=
€€$ %
$num
€€& '
,
€€' (
Usuario
‹‹ #
=
‹‹$ %
user
‹‹& *
,
‹‹* +
Ronda
›› !
=
››" #
round
››$ )
,
››) *
}
ﬁﬁ 
;
ﬁﬁ 
context
ﬂﬂ 
.
ﬂﬂ  
Jugador
ﬂﬂ  '
.
ﬂﬂ' (
Add
ﬂﬂ( +
(
ﬂﬂ+ ,
player
ﬂﬂ, 2
)
ﬂﬂ2 3
;
ﬂﬂ3 4
context
‡‡ 
.
‡‡  
SaveChanges
‡‡  +
(
‡‡+ ,
)
‡‡, -
;
‡‡- .
other
‚‚ 
.
‚‚ 

StartRound
‚‚ (
(
‚‚( )
round
‚‚) .
.
‚‚. /
RondaID
‚‚/ 6
)
‚‚6 7
;
‚‚7 8
}
„„ 
_games
‰‰ 
.
‰‰ 
Remove
‰‰ !
(
‰‰! "
gameName
‰‰" *
)
‰‰* +
;
‰‰+ ,
}
ÂÂ 
}
ÊÊ 
catch
ÁÁ 
(
ÁÁ 
	Exception
ÁÁ 
ex
ÁÁ 
)
ÁÁ  
{
ËË 
throw
ÈÈ 
new
ÈÈ 
	Exception
ÈÈ #
(
ÈÈ# $
ex
ÈÈ$ &
.
ÈÈ& '
Message
ÈÈ' .
)
ÈÈ. /
;
ÈÈ/ 0
}
ÍÍ 
}
ÎÎ 	
readonly
ÌÌ 

Dictionary
ÌÌ 
<
ÌÌ 
IChatClient
ÌÌ '
,
ÌÌ' (
string
ÌÌ) /
>
ÌÌ/ 0
_users
ÌÌ1 7
=
ÌÌ8 9
new
ÌÌ: =

Dictionary
ÌÌ> H
<
ÌÌH I
IChatClient
ÌÌI T
,
ÌÌT U
string
ÌÌV \
>
ÌÌ\ ]
(
ÌÌ] ^
)
ÌÌ^ _
;
ÌÌ_ `
public
ÓÓ 
void
ÓÓ 
JoinChat
ÓÓ 
(
ÓÓ 
string
ÓÓ #
username
ÓÓ$ ,
)
ÓÓ, -
{
ÔÔ 	
var
 

connection
 
=
 
OperationContext
 -
.
- .
Current
. 5
.
5 6 
GetCallbackChannel
6 H
<
H I
IChatClient
I T
>
T U
(
U V
)
V W
;
W X
_users
ÒÒ 
[
ÒÒ 

connection
ÒÒ 
]
ÒÒ 
=
ÒÒ  
username
ÒÒ! )
;
ÒÒ) *
}
ÚÚ 	
public
ÙÙ 
void
ÙÙ 
SendMessage
ÙÙ 
(
ÙÙ  
string
ÙÙ  &
message
ÙÙ' .
)
ÙÙ. /
{
ıı 	
var
ˆˆ 

connection
ˆˆ 
=
ˆˆ 
OperationContext
ˆˆ -
.
ˆˆ- .
Current
ˆˆ. 5
.
ˆˆ5 6 
GetCallbackChannel
ˆˆ6 H
<
ˆˆH I
IChatClient
ˆˆI T
>
ˆˆT U
(
ˆˆU V
)
ˆˆV W
;
ˆˆW X
if
˜˜ 
(
˜˜ 
!
˜˜ 
_users
˜˜ 
.
˜˜ 
TryGetValue
˜˜ #
(
˜˜# $

connection
˜˜$ .
,
˜˜. /
out
˜˜0 3
string
˜˜4 :
user
˜˜; ?
)
˜˜? @
)
˜˜@ A
return
¯¯ 
;
¯¯ 
foreach
˘˘ 
(
˘˘ 
var
˘˘ 
other
˘˘ 
in
˘˘ !
_users
˘˘" (
.
˘˘( )
Keys
˘˘) -
)
˘˘- .
{
˙˙ 
if
˚˚ 
(
˚˚ 
other
˚˚ 
==
˚˚ 

connection
˚˚ '
)
˚˚' (
continue
¸¸ 
;
¸¸ 
other
˝˝ 
.
˝˝ 
ReciveMessage
˝˝ #
(
˝˝# $
user
˝˝$ (
,
˝˝( )
message
˝˝* 1
)
˝˝1 2
;
˝˝2 3
}
˛˛ 
}
ˇˇ 	
public
ÅÅ 
bool
ÅÅ 
ChangePassword
ÅÅ "
(
ÅÅ" #
string
ÅÅ# )
username
ÅÅ* 2
,
ÅÅ2 3
string
ÅÅ4 :
currentPassword
ÅÅ; J
,
ÅÅJ K
string
ÅÅL R
newPassword
ÅÅS ^
)
ÅÅ^ _
{
ÇÇ 	
try
ÉÉ 
{
ÑÑ 
using
ÖÖ 
(
ÖÖ 
DominoContext
ÖÖ $
context
ÖÖ% ,
=
ÖÖ- .
new
ÖÖ/ 2
DominoContext
ÖÖ3 @
(
ÖÖ@ A
)
ÖÖA B
)
ÖÖB C
{
ÜÜ 
var
áá 
user
áá 
=
áá 
context
áá &
.
áá& '
Usuario
áá' .
.
áá. /
FirstOrDefault
áá/ =
(
áá= >
u
áá> ?
=>
áá@ B
u
ááC D
.
ááD E
Nombreusuario
ááE R
==
ááS U
username
ááV ^
)
áá^ _
;
áá_ `
if
àà 
(
àà 
user
àà 
!=
àà 
null
àà  $
)
àà$ %
{
ââ 
if
ää 
(
ää 
user
ää  
.
ää  !
Contrase√±a
ää! +
.
ää+ ,
Equals
ää, 2
(
ää2 3
currentPassword
ää3 B
)
ääB C
)
ääC D
{
ãã 
user
åå  
.
åå  !
Contrase√±a
åå! +
=
åå, -
newPassword
åå. 9
;
åå9 :
context
çç #
.
çç# $
SaveChanges
çç$ /
(
çç/ 0
)
çç0 1
;
çç1 2
return
éé "
true
éé# '
;
éé' (
}
èè 
}
êê 
}
ëë 
}
íí 
catch
ìì 
{
îî 
}
ññ 
return
óó 
false
óó 
;
óó 
}
òò 	
public
öö "
ObservableCollection
öö #
<
öö# $
UsuarioPuntajes
öö$ 3
>
öö3 4
	GetScores
öö5 >
(
öö> ?
)
öö? @
{
õõ 	"
ObservableCollection
úú  
<
úú  !
UsuarioPuntajes
úú! 0
>
úú0 1
scores
úú2 8
=
úú9 :
new
úú; >"
ObservableCollection
úú? S
<
úúS T
UsuarioPuntajes
úúT c
>
úúc d
(
úúd e
)
úúe f
;
úúf g
try
ùù 
{
ûû 
using
üü 
(
üü 
DominoContext
üü $
context
üü% ,
=
üü- .
new
üü/ 2
DominoContext
üü3 @
(
üü@ A
)
üüA B
)
üüB C
{
†† 
var
°° 
usersByScore
°° $
=
°°% &
context
°°' .
.
°°. /
Usuario
°°/ 6
.
°°6 7
OrderByDescending
°°7 H
(
°°H I
p
°°I J
=>
°°K M
p
°°N O
.
°°O P
Puntajeacumulado
°°P `
)
°°` a
;
°°a b
int
¢¢ 
lugar
¢¢ 
=
¢¢ 
$num
¢¢  !
;
¢¢! "
foreach
££ 
(
££ 
Usuario
££ $
user
££% )
in
££* ,
usersByScore
££- 9
)
££9 :
{
§§ 
if
•• 
(
•• 
user
••  
!=
••! #
null
••$ (
)
••( )
{
¶¶ 
scores
ßß "
.
ßß" #
Add
ßß# &
(
ßß& '
new
ßß' *
UsuarioPuntajes
ßß+ :
(
ßß: ;
lugar
ßß; @
,
ßß@ A
user
ßßB F
.
ßßF G
Nombreusuario
ßßG T
,
ßßT U
(
ßßV W
int
ßßW Z
)
ßßZ [
user
ßß[ _
.
ßß_ `
Puntajeacumulado
ßß` p
)
ßßp q
)
ßßq r
;
ßßr s
}
®® 
else
©© 
return
™™ "
scores
™™# )
;
™™) *
lugar
´´ 
++
´´ 
;
´´  
if
≠≠ 
(
≠≠ 
lugar
≠≠ !
==
≠≠" $
$num
≠≠% &
)
≠≠& '
return
ÆÆ "
scores
ÆÆ# )
;
ÆÆ) *
}
ØØ 
}
∞∞ 
}
±± 
catch
≤≤ 
(
≤≤ 
	Exception
≤≤ 
ex
≤≤ 
)
≤≤  
{
≥≥ 
throw
¥¥ 
new
¥¥ 
	Exception
¥¥ #
(
¥¥# $
ex
¥¥$ &
.
¥¥& '
Message
¥¥' .
)
¥¥. /
;
¥¥/ 0
}
µµ 
return
∂∂ 
scores
∂∂ 
;
∂∂ 
}
∑∑ 	
public
ππ 
bool
ππ 
RecoverPassword
ππ #
(
ππ# $
string
ππ$ *
email
ππ+ 0
)
ππ0 1
{
∫∫ 	
try
ªª 
{
ºº 
using
ΩΩ 
(
ΩΩ 
DominoContext
ΩΩ $
context
ΩΩ% ,
=
ΩΩ- .
new
ΩΩ/ 2
DominoContext
ΩΩ3 @
(
ΩΩ@ A
)
ΩΩA B
)
ΩΩB C
{
ææ 
var
øø 
user
øø 
=
øø 
context
øø &
.
øø& '
Usuario
øø' .
.
øø. /
FirstOrDefault
øø/ =
(
øø= >
u
øø> ?
=>
øø@ B
u
øøC D
.
øøD E
Correo
øøE K
==
øøL N
email
øøO T
)
øøT U
;
øøU V
if
¿¿ 
(
¿¿ 
user
¿¿ 
!=
¿¿ 
null
¿¿  $
)
¿¿$ %
{
¡¡ 
	SendEmail
¬¬ !
(
¬¬! "
user
¬¬" &
,
¬¬& '
false
¬¬( -
)
¬¬- .
;
¬¬. /
return
√√ 
true
√√ #
;
√√# $
}
ƒƒ 
else
≈≈ 
return
∆∆ 
false
∆∆ $
;
∆∆$ %
}
«« 
}
»» 
catch
…… 
(
…… 
	Exception
…… 
ex
…… 
)
……  
{
   
throw
ÀÀ 
new
ÀÀ 
	Exception
ÀÀ #
(
ÀÀ# $
ex
ÀÀ$ &
.
ÀÀ& '
Message
ÀÀ' .
)
ÀÀ. /
;
ÀÀ/ 0
}
ÃÃ 
}
ÕÕ 	
[
œœ 	
Obsolete
œœ	 
]
œœ 
public
–– 
bool
–– 
SignUp
–– 
(
–– 
string
–– !
username
––" *
,
––* +
string
––, 2
email
––3 8
,
––8 9
string
––: @
password
––A I
)
––I J
{
—— 	
try
““ 
{
”” 
using
‘‘ 
(
‘‘ 
DominoContext
‘‘ $
context
‘‘% ,
=
‘‘- .
new
‘‘/ 2
DominoContext
‘‘3 @
(
‘‘@ A
)
‘‘A B
)
‘‘B C
{
’’ 
var
÷÷ 
existingUser
÷÷ $
=
÷÷% &
context
÷÷' .
.
÷÷. /
Usuario
÷÷/ 6
.
÷÷6 7
FirstOrDefault
÷÷7 E
(
÷÷E F
u
÷÷F G
=>
÷÷H J
u
÷÷K L
.
÷÷L M
Correo
÷÷M S
==
÷÷T V
email
÷÷W \
)
÷÷\ ]
;
÷÷] ^
if
◊◊ 
(
◊◊ 
existingUser
◊◊ $
==
◊◊% '
null
◊◊( ,
)
◊◊, -
{
ÿÿ 
existingUser
ŸŸ $
=
ŸŸ% &
context
ŸŸ' .
.
ŸŸ. /
Usuario
ŸŸ/ 6
.
ŸŸ6 7
FirstOrDefault
ŸŸ7 E
(
ŸŸE F
u
ŸŸF G
=>
ŸŸH J
u
ŸŸK L
.
ŸŸL M
Nombreusuario
ŸŸM Z
==
ŸŸ[ ]
username
ŸŸ^ f
)
ŸŸf g
;
ŸŸg h
if
⁄⁄ 
(
⁄⁄ 
existingUser
⁄⁄ (
==
⁄⁄) +
null
⁄⁄, 0
)
⁄⁄0 1
{
€€ 
var
‹‹ 
user
‹‹  $
=
‹‹% &
new
‹‹' *
Usuario
‹‹+ 2
{
›› 
Nombreusuario
ﬁﬁ  -
=
ﬁﬁ. /
username
ﬁﬁ0 8
,
ﬁﬁ8 9
Correo
ﬂﬂ  &
=
ﬂﬂ' (
email
ﬂﬂ) .
,
ﬂﬂ. /
Contrase√±a
‡‡  *
=
‡‡+ ,
password
‡‡- 5
,
‡‡5 6
Puntajeacumulado
··  0
=
··1 2
$num
··3 4
,
··4 5
Estatus
‚‚  '
=
‚‚( )
$num
‚‚* +
,
‚‚+ ,
Token
„„  %
=
„„& '
ShortId
„„( /
.
„„/ 0
Generate
„„0 8
(
„„8 9
)
„„9 :
.
„„: ;
Trim
„„; ?
(
„„? @
)
„„@ A
}
‰‰ 
;
‰‰ 
context
ÂÂ #
.
ÂÂ# $
Usuario
ÂÂ$ +
.
ÂÂ+ ,
Add
ÂÂ, /
(
ÂÂ/ 0
user
ÂÂ0 4
)
ÂÂ4 5
;
ÂÂ5 6
context
ÊÊ #
.
ÊÊ# $
SaveChanges
ÊÊ$ /
(
ÊÊ/ 0
)
ÊÊ0 1
;
ÊÊ1 2
	SendEmail
ËË %
(
ËË% &
user
ËË& *
,
ËË* +
true
ËË, 0
)
ËË0 1
;
ËË1 2
Console
ÍÍ #
.
ÍÍ# $
	WriteLine
ÍÍ$ -
(
ÍÍ- .
$str
ÍÍ. 9
+
ÍÍ: ;
username
ÍÍ< D
+
ÍÍE F
$str
ÍÍG t
+
ÍÍu v
email
ÍÍw |
)
ÍÍ| }
;
ÍÍ} ~
return
ÎÎ "
true
ÎÎ# '
;
ÎÎ' (
}
ÏÏ 
}
ÌÌ 
}
ÓÓ 
}
ÔÔ 
catch
 
(
 
	Exception
 
ex
 
)
  
{
ÒÒ 
throw
ÚÚ 
new
ÚÚ 
	Exception
ÚÚ #
(
ÚÚ# $
ex
ÚÚ$ &
.
ÚÚ& '
Message
ÚÚ' .
)
ÚÚ. /
;
ÚÚ/ 0
}
ÛÛ 
return
ÙÙ 
false
ÙÙ 
;
ÙÙ 
}
ıı 	
public
˜˜ 
bool
˜˜ 
VerificateUser
˜˜ "
(
˜˜" #
string
˜˜# )
username
˜˜* 2
,
˜˜2 3
string
˜˜4 :
token
˜˜; @
)
˜˜@ A
{
¯¯ 	
try
˘˘ 
{
˙˙ 
using
˚˚ 
(
˚˚ 
DominoContext
˚˚ $
context
˚˚% ,
=
˚˚- .
new
˚˚/ 2
DominoContext
˚˚3 @
(
˚˚@ A
)
˚˚A B
)
˚˚B C
{
¸¸ 
var
˝˝ 
user
˝˝ 
=
˝˝ 
context
˝˝ &
.
˝˝& '
Usuario
˝˝' .
.
˝˝. /
FirstOrDefault
˝˝/ =
(
˝˝= >
u
˝˝> ?
=>
˝˝@ B
u
˝˝C D
.
˝˝D E
Nombreusuario
˝˝E R
==
˝˝S U
username
˝˝V ^
)
˝˝^ _
;
˝˝_ `
if
˛˛ 
(
˛˛ 
user
˛˛ 
!=
˛˛ 
null
˛˛  $
)
˛˛$ %
{
ˇˇ 
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 

IsVerified
ÄÄ '
(
ÄÄ' (
user
ÄÄ( ,
.
ÄÄ, -
Nombreusuario
ÄÄ- :
)
ÄÄ: ;
)
ÄÄ; <
{
ÅÅ 
if
ÇÇ 
(
ÇÇ  
user
ÇÇ  $
.
ÇÇ$ %
Token
ÇÇ% *
==
ÇÇ+ -
token
ÇÇ. 3
)
ÇÇ3 4
{
ÉÉ 
user
ÑÑ  $
.
ÑÑ$ %
Estatus
ÑÑ% ,
=
ÑÑ- .
$num
ÑÑ/ 0
;
ÑÑ0 1
context
ÖÖ  '
.
ÖÖ' (
SaveChanges
ÖÖ( 3
(
ÖÖ3 4
)
ÖÖ4 5
;
ÖÖ5 6
return
ÜÜ  &
true
ÜÜ' +
;
ÜÜ+ ,
}
áá 
else
àà  
return
ââ  &
false
ââ' ,
;
ââ, -
}
ää 
else
ãã 
return
åå "
true
åå# '
;
åå' (
}
çç 
}
éé 
}
èè 
catch
êê 
(
êê 
	Exception
êê 
ex
êê 
)
êê  
{
ëë 
throw
íí 
new
íí 
	Exception
íí #
(
íí# $
ex
íí$ &
.
íí& '
Message
íí' .
)
íí. /
;
íí/ 0
}
ìì 
return
îî 
false
îî 
;
îî 
}
ïï 	
public
óó 
bool
óó 

IsVerified
óó 
(
óó 
string
óó %
username
óó& .
)
óó. /
{
òò 	
try
ôô 
{
öö 
using
õõ 
(
õõ 
DominoContext
õõ $
context
õõ% ,
=
õõ- .
new
õõ/ 2
DominoContext
õõ3 @
(
õõ@ A
)
õõA B
)
õõB C
{
úú 
var
ùù 
user
ùù 
=
ùù 
context
ùù &
.
ùù& '
Usuario
ùù' .
.
ùù. /
FirstOrDefault
ùù/ =
(
ùù= >
u
ùù> ?
=>
ùù@ B
u
ùùC D
.
ùùD E
Nombreusuario
ùùE R
==
ùùS U
username
ùùV ^
)
ùù^ _
;
ùù_ `
if
ûû 
(
ûû 
user
ûû 
!=
ûû 
null
ûû  $
)
ûû$ %
{
üü 
if
†† 
(
†† 
user
††  
.
††  !
Estatus
††! (
==
††) +
$num
††, -
)
††- .
return
°° "
true
°°# '
;
°°' (
else
¢¢ 
return
££ "
false
££# (
;
££( )
}
§§ 
}
•• 
}
¶¶ 
catch
ßß 
(
ßß 
	Exception
ßß 
ex
ßß 
)
ßß  
{
®® 
throw
©© 
new
©© 
	Exception
©© #
(
©©# $
ex
©©$ &
.
©©& '
Message
©©' .
)
©©. /
;
©©/ 0
}
™™ 
return
´´ 
false
´´ 
;
´´ 
}
¨¨ 	
public
ÆÆ 
string
ÆÆ 
LogIn
ÆÆ 
(
ÆÆ 
string
ÆÆ "
email
ÆÆ# (
,
ÆÆ( )
string
ÆÆ* 0
password
ÆÆ1 9
)
ÆÆ9 :
{
ØØ 	
try
∞∞ 
{
±± 
using
≤≤ 
(
≤≤ 
DominoContext
≤≤ $
context
≤≤% ,
=
≤≤- .
new
≤≤/ 2
DominoContext
≤≤3 @
(
≤≤@ A
)
≤≤A B
)
≤≤B C
{
≥≥ 
var
¥¥ 
user
¥¥ 
=
¥¥ 
context
¥¥ &
.
¥¥& '
Usuario
¥¥' .
.
¥¥. /
FirstOrDefault
¥¥/ =
(
¥¥= >
u
¥¥> ?
=>
¥¥@ B
u
¥¥C D
.
¥¥D E
Correo
¥¥E K
==
¥¥L N
email
¥¥O T
)
¥¥T U
;
¥¥U V
if
µµ 
(
µµ 
user
µµ 
!=
µµ 
null
µµ  $
)
µµ$ %
{
∂∂ 
if
∑∑ 
(
∑∑ 
user
∑∑  
.
∑∑  !
Contrase√±a
∑∑! +
==
∑∑, .
password
∑∑/ 7
)
∑∑7 8
{
∏∏ 
Console
ππ #
.
ππ# $
	WriteLine
ππ$ -
(
ππ- .
$str
ππ. 9
+
ππ: ;
user
ππ< @
.
ππ@ A
Nombreusuario
ππA N
+
ππO P
$str
ππQ f
)
ππf g
;
ππg h
return
∫∫ "
user
∫∫# '
.
∫∫' (
Nombreusuario
∫∫( 5
;
∫∫5 6
}
ºº 
}
ΩΩ 
return
ææ 
(
ææ 
$str
ææ 
)
ææ 
;
ææ  
}
øø 
}
¿¿ 
catch
¡¡ 
(
¡¡ 
	Exception
¡¡ 
ex
¡¡ 
)
¡¡  
{
¬¬ 
throw
√√ 
new
√√ 
	Exception
√√ #
(
√√# $
ex
√√$ &
.
√√& '
Message
√√' .
)
√√. /
;
√√/ 0
}
ƒƒ 
}
≈≈ 	
private
«« 
bool
«« 
	SendEmail
«« 
(
«« 
Usuario
«« &
user
««' +
,
««+ ,
bool
««- 1
isSignUp
««2 :
)
««: ;
{
»» 	
try
…… 
{
   
MailMessage
ÀÀ 
mail
ÀÀ  
=
ÀÀ! "
new
ÀÀ# &
MailMessage
ÀÀ' 2
(
ÀÀ2 3
)
ÀÀ3 4
;
ÀÀ4 5

SmtpClient
ÃÃ 

SmtpServer
ÃÃ %
=
ÃÃ& '
new
ÃÃ( +

SmtpClient
ÃÃ, 6
(
ÃÃ6 7
$str
ÃÃ7 G
)
ÃÃG H
;
ÃÃH I
mail
ŒŒ 
.
ŒŒ 
From
ŒŒ 
=
ŒŒ 
new
ŒŒ 
MailAddress
ŒŒ  +
(
ŒŒ+ ,
$str
ŒŒ, G
,
ŒŒG H
$str
ŒŒI W
,
ŒŒW X
System
ŒŒY _
.
ŒŒ_ `
Text
ŒŒ` d
.
ŒŒd e
Encoding
ŒŒe m
.
ŒŒm n
UTF8
ŒŒn r
)
ŒŒr s
;
ŒŒs t
mail
œœ 
.
œœ 
To
œœ 
.
œœ 
Add
œœ 
(
œœ 
user
œœ  
.
œœ  !
Correo
œœ! '
)
œœ' (
;
œœ( )
if
–– 
(
–– 
isSignUp
–– 
)
–– 
{
—— 
mail
““ 
.
““ 
Subject
““  
=
““! "
$str
““# C
;
““C D
mail
”” 
.
”” 
Body
”” 
=
”” 
$str
””  (
+
””) *
user
””+ /
.
””/ 0
Nombreusuario
””0 =
+
””> ?
$str
””@ z
+
””{ |
user
‘‘ 
.
‘‘ 
Token
‘‘ "
;
‘‘" #
}
’’ 
else
÷÷ 
{
◊◊ 
mail
ÿÿ 
.
ÿÿ 
Subject
ÿÿ  
=
ÿÿ! "
$str
ÿÿ# G
;
ÿÿG H
mail
ŸŸ 
.
ŸŸ 
Body
ŸŸ 
=
ŸŸ 
$str
ŸŸ  (
+
ŸŸ) *
user
ŸŸ+ /
.
ŸŸ/ 0
Nombreusuario
ŸŸ0 =
+
ŸŸ> ?
$strŸŸ@ Ä
+ŸŸÅ Ç
user
⁄⁄ 
.
⁄⁄ 
Contrase√±a
⁄⁄ '
+
⁄⁄( )
$str
⁄⁄* k
;
⁄⁄k l
}
€€ 

SmtpServer
‹‹ 
.
‹‹ 
Port
‹‹ 
=
‹‹  !
$num
‹‹" %
;
‹‹% &

SmtpServer
›› 
.
›› 
Credentials
›› &
=
››' (
new
››) ,
System
››- 3
.
››3 4
Net
››4 7
.
››7 8
NetworkCredential
››8 I
(
››I J
$str
››J e
,
››e f
$str
››g v
)
››v w
;
››w x

SmtpServer
ﬁﬁ 
.
ﬁﬁ 
	EnableSsl
ﬁﬁ $
=
ﬁﬁ% &
true
ﬁﬁ' +
;
ﬁﬁ+ ,

SmtpServer
ﬂﬂ 
.
ﬂﬂ 
Send
ﬂﬂ 
(
ﬂﬂ  
mail
ﬂﬂ  $
)
ﬂﬂ$ %
;
ﬂﬂ% &
return
‡‡ 
true
‡‡ 
;
‡‡ 
}
‚‚ 
catch
„„ 
(
„„ 
	Exception
„„ 
ex
„„ 
)
„„  
{
‰‰ 
throw
ÂÂ 
new
ÂÂ 
	Exception
ÂÂ #
(
ÂÂ# $
ex
ÂÂ$ &
.
ÂÂ& '
Message
ÂÂ' .
)
ÂÂ. /
;
ÂÂ/ 0
}
ÊÊ 
}
ÁÁ 	
}
ËË 
}ÈÈ √
>C:\Users\ricar\Documents\GitHub\domino\DominoServer\Program.cs
	namespace 	
DominoServer
 
{ 
class 	
Program
 
{ 
static 
void 
Main 
( 
) 
{		 	
ServiceHost

 
host

 
=

 
new

 "
ServiceHost

# .
(

. /
typeof

/ 5
(

5 6
DominoService

6 C
)

C D
)

D E
;

E F
host 
. 
Open 
( 
) 
; 
Console 
. 
	WriteLine 
( 
$str 9
)9 :
;: ;
Console 
. 
ReadLine 
( 
) 
; 
host 
. 
Close 
( 
) 
; 
} 	
} 
} 